<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=prev href=index.html><link rel=next href=data_structures.html><link rel=icon href=../../../../img/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.22"><title>control - ayon-launcher</title><link rel=stylesheet href=../../../../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><script src=https://unpkg.com/iframe-worker/shim></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../css/custom.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#common.ayon_common.distribution.control class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../index.html title=ayon-launcher class="md-header__button md-logo" aria-label=ayon-launcher data-md-component=logo> <img src=../../../../img/ay-symbol-blackw-full.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ayon-launcher </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> control </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ynput/ayon-launcher title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../index.html title=ayon-launcher class="md-nav__button md-logo" aria-label=ayon-launcher data-md-component=logo> <img src=../../../../img/ay-symbol-blackw-full.png alt=logo> </a> ayon-launcher </label> <div class=md-nav__source> <a href=https://github.com/ynput/ayon-launcher title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../index.html class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../../license.html class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Build Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Build Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../build_guides/windows.html class=md-nav__link> <span class=md-ellipsis> Windows </span> </a> </li> <li class=md-nav__item> <a href=../../../../build_guides/linux.html class=md-nav__link> <span class=md-ellipsis> Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../../build_guides/macos.html class=md-nav__link> <span class=md-ellipsis> Mac OS </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../app_launcher.html class=md-nav__link> <span class=md-ellipsis> app_launcher </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2 checked> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> common </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=true> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> common </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_1 checked> <label class=md-nav__link for=__nav_4_2_1 id=__nav_4_2_1_label tabindex=0> <span class=md-ellipsis> ayon_common </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_1_label aria-expanded=true> <label class=md-nav__title for=__nav_4_2_1> <span class="md-nav__icon md-icon"></span> ayon_common </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../_windows_register_scheme.html class=md-nav__link> <span class=md-ellipsis> _windows_register_scheme </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../connection/credentials.html class=md-nav__link> <span class=md-ellipsis> connection </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_1_3 checked> <label class=md-nav__link for=__nav_4_2_1_3 id=__nav_4_2_1_3_label tabindex=0> <span class=md-ellipsis> distribution </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_4_2_1_3_label aria-expanded=true> <label class=md-nav__title for=__nav_4_2_1_3> <span class="md-nav__icon md-icon"></span> distribution </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> control </span> <span class="md-nav__icon md-icon"></span> </label> <a href=control.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> control </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control class=md-nav__link> <span class=md-ellipsis> control </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution class=md-nav__link> <span class=md-ellipsis> AYONDistribution </span> </a> <nav class=md-nav aria-label=AYONDistribution> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.addon_items class=md-nav__link> <span class=md-ellipsis> addon_items </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.addons_info class=md-nav__link> <span class=md-ellipsis> addons_info </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.bundle_items class=md-nav__link> <span class=md-ellipsis> bundle_items </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.bundles_info class=md-nav__link> <span class=md-ellipsis> bundles_info </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.dependency_package_item class=md-nav__link> <span class=md-ellipsis> dependency_package_item </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.dependency_packages_info class=md-nav__link> <span class=md-ellipsis> dependency_packages_info </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.dependency_packages_items class=md-nav__link> <span class=md-ellipsis> dependency_packages_items </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.expected_installer_version class=md-nav__link> <span class=md-ellipsis> expected_installer_version </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.installer_dist_error class=md-nav__link> <span class=md-ellipsis> installer_dist_error </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.installer_executable class=md-nav__link> <span class=md-ellipsis> installer_executable </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.installer_filepath class=md-nav__link> <span class=md-ellipsis> installer_filepath </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.installer_item class=md-nav__link> <span class=md-ellipsis> installer_item </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.installer_items class=md-nav__link> <span class=md-ellipsis> installer_items </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.installers_info class=md-nav__link> <span class=md-ellipsis> installers_info </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.log class=md-nav__link> <span class=md-ellipsis> log </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.need_distribution class=md-nav__link> <span class=md-ellipsis> need_distribution </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.need_installer_change class=md-nav__link> <span class=md-ellipsis> need_installer_change </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.need_installer_distribution class=md-nav__link> <span class=md-ellipsis> need_installer_distribution </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.project_bundle_name_to_use class=md-nav__link> <span class=md-ellipsis> project_bundle_name_to_use </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.project_bundle_to_use class=md-nav__link> <span class=md-ellipsis> project_bundle_to_use </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.studio_bundle_to_use class=md-nav__link> <span class=md-ellipsis> studio_bundle_to_use </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.studio_dev_bundle class=md-nav__link> <span class=md-ellipsis> studio_dev_bundle </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.studio_production_bundle class=md-nav__link> <span class=md-ellipsis> studio_production_bundle </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.studio_staging_bundle class=md-nav__link> <span class=md-ellipsis> studio_staging_bundle </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.use_dev class=md-nav__link> <span class=md-ellipsis> use_dev </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.use_staging class=md-nav__link> <span class=md-ellipsis> use_staging </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.distribute class=md-nav__link> <span class=md-ellipsis> distribute </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.distribute_installer class=md-nav__link> <span class=md-ellipsis> distribute_installer </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.finish_distribution class=md-nav__link> <span class=md-ellipsis> finish_distribution </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_addon_dist_items class=md-nav__link> <span class=md-ellipsis> get_addon_dist_items </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_addons_metadata_filepath class=md-nav__link> <span class=md-ellipsis> get_addons_metadata_filepath </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_all_distribution_items class=md-nav__link> <span class=md-ellipsis> get_all_distribution_items </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_dependency_dist_item class=md-nav__link> <span class=md-ellipsis> get_dependency_dist_item </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_dependency_metadata_filepath class=md-nav__link> <span class=md-ellipsis> get_dependency_metadata_filepath </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_python_paths class=md-nav__link> <span class=md-ellipsis> get_python_paths </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_sys_paths class=md-nav__link> <span class=md-ellipsis> get_sys_paths </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.read_metadata_file class=md-nav__link> <span class=md-ellipsis> read_metadata_file </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.save_metadata_file class=md-nav__link> <span class=md-ellipsis> save_metadata_file </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.validate_distribution class=md-nav__link> <span class=md-ellipsis> validate_distribution </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem class=md-nav__link> <span class=md-ellipsis> BaseDistributionItem </span> </a> <nav class=md-nav aria-label=BaseDistributionItem> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.current_source_progress class=md-nav__link> <span class=md-ellipsis> current_source_progress </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.error_detail class=md-nav__link> <span class=md-ellipsis> error_detail </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.error_message class=md-nav__link> <span class=md-ellipsis> error_message </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.need_distribution class=md-nav__link> <span class=md-ellipsis> need_distribution </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.used_source class=md-nav__link> <span class=md-ellipsis> used_source </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.used_source_progress class=md-nav__link> <span class=md-ellipsis> used_source_progress </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.distribute class=md-nav__link> <span class=md-ellipsis> distribute </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress class=md-nav__link> <span class=md-ellipsis> DistributeTransferProgress </span> </a> <nav class=md-nav aria-label=DistributeTransferProgress> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.is_running class=md-nav__link> <span class=md-ellipsis> is_running </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.transfer_progress class=md-nav__link> <span class=md-ellipsis> transfer_progress </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.set_failed class=md-nav__link> <span class=md-ellipsis> set_failed </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.set_hash_check_finished class=md-nav__link> <span class=md-ellipsis> set_hash_check_finished </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.set_hash_check_started class=md-nav__link> <span class=md-ellipsis> set_hash_check_started </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.set_started class=md-nav__link> <span class=md-ellipsis> set_started </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.set_unzip_finished class=md-nav__link> <span class=md-ellipsis> set_unzip_finished </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.set_unzip_started class=md-nav__link> <span class=md-ellipsis> set_unzip_started </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributionItem class=md-nav__link> <span class=md-ellipsis> DistributionItem </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.InstallerDistributionItem class=md-nav__link> <span class=md-ellipsis> InstallerDistributionItem </span> </a> <nav class=md-nav aria-label=InstallerDistributionItem> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.InstallerDistributionItem.executable class=md-nav__link> <span class=md-ellipsis> executable </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.InstallerDistributionItem.installer_error class=md-nav__link> <span class=md-ellipsis> installer_error </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.InstallerDistributionItem.installer_path class=md-nav__link> <span class=md-ellipsis> installer_path </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=data_structures.html class=md-nav__link> <span class=md-ellipsis> data_structures </span> </a> </li> <li class=md-nav__item> <a href=downloaders.html class=md-nav__link> <span class=md-ellipsis> downloaders </span> </a> </li> <li class=md-nav__item> <a href=exceptions.html class=md-nav__link> <span class=md-ellipsis> exceptions </span> </a> </li> <li class=md-nav__item> <a href=file_handler.html class=md-nav__link> <span class=md-ellipsis> file_handler </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=ui/distribution_error.html class=md-nav__link> <span class=md-ellipsis> ui </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=utils.html class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../resources/index.html class=md-nav__link> <span class=md-ellipsis> resources </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../startup/ui/startup_error.html class=md-nav__link> <span class=md-ellipsis> startup </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../ui_utils.html class=md-nav__link> <span class=md-ellipsis> ui_utils </span> </a> </li> <li class=md-nav__item> <a href=../utils.html class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../setup.html class=md-nav__link> <span class=md-ellipsis> setup </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../shim/macos_start.html class=md-nav__link> <span class=md-ellipsis> shim </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../../start.html class=md-nav__link> <span class=md-ellipsis> start </span> </a> </li> <li class=md-nav__item> <a href=../../../version.html class=md-nav__link> <span class=md-ellipsis> version </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control class=md-nav__link> <span class=md-ellipsis> control </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution class=md-nav__link> <span class=md-ellipsis> AYONDistribution </span> </a> <nav class=md-nav aria-label=AYONDistribution> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.addon_items class=md-nav__link> <span class=md-ellipsis> addon_items </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.addons_info class=md-nav__link> <span class=md-ellipsis> addons_info </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.bundle_items class=md-nav__link> <span class=md-ellipsis> bundle_items </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.bundles_info class=md-nav__link> <span class=md-ellipsis> bundles_info </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.dependency_package_item class=md-nav__link> <span class=md-ellipsis> dependency_package_item </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.dependency_packages_info class=md-nav__link> <span class=md-ellipsis> dependency_packages_info </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.dependency_packages_items class=md-nav__link> <span class=md-ellipsis> dependency_packages_items </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.expected_installer_version class=md-nav__link> <span class=md-ellipsis> expected_installer_version </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.installer_dist_error class=md-nav__link> <span class=md-ellipsis> installer_dist_error </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.installer_executable class=md-nav__link> <span class=md-ellipsis> installer_executable </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.installer_filepath class=md-nav__link> <span class=md-ellipsis> installer_filepath </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.installer_item class=md-nav__link> <span class=md-ellipsis> installer_item </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.installer_items class=md-nav__link> <span class=md-ellipsis> installer_items </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.installers_info class=md-nav__link> <span class=md-ellipsis> installers_info </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.log class=md-nav__link> <span class=md-ellipsis> log </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.need_distribution class=md-nav__link> <span class=md-ellipsis> need_distribution </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.need_installer_change class=md-nav__link> <span class=md-ellipsis> need_installer_change </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.need_installer_distribution class=md-nav__link> <span class=md-ellipsis> need_installer_distribution </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.project_bundle_name_to_use class=md-nav__link> <span class=md-ellipsis> project_bundle_name_to_use </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.project_bundle_to_use class=md-nav__link> <span class=md-ellipsis> project_bundle_to_use </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.studio_bundle_to_use class=md-nav__link> <span class=md-ellipsis> studio_bundle_to_use </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.studio_dev_bundle class=md-nav__link> <span class=md-ellipsis> studio_dev_bundle </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.studio_production_bundle class=md-nav__link> <span class=md-ellipsis> studio_production_bundle </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.studio_staging_bundle class=md-nav__link> <span class=md-ellipsis> studio_staging_bundle </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.use_dev class=md-nav__link> <span class=md-ellipsis> use_dev </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.use_staging class=md-nav__link> <span class=md-ellipsis> use_staging </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.distribute class=md-nav__link> <span class=md-ellipsis> distribute </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.distribute_installer class=md-nav__link> <span class=md-ellipsis> distribute_installer </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.finish_distribution class=md-nav__link> <span class=md-ellipsis> finish_distribution </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_addon_dist_items class=md-nav__link> <span class=md-ellipsis> get_addon_dist_items </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_addons_metadata_filepath class=md-nav__link> <span class=md-ellipsis> get_addons_metadata_filepath </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_all_distribution_items class=md-nav__link> <span class=md-ellipsis> get_all_distribution_items </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_dependency_dist_item class=md-nav__link> <span class=md-ellipsis> get_dependency_dist_item </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_dependency_metadata_filepath class=md-nav__link> <span class=md-ellipsis> get_dependency_metadata_filepath </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_python_paths class=md-nav__link> <span class=md-ellipsis> get_python_paths </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.get_sys_paths class=md-nav__link> <span class=md-ellipsis> get_sys_paths </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.read_metadata_file class=md-nav__link> <span class=md-ellipsis> read_metadata_file </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.save_metadata_file class=md-nav__link> <span class=md-ellipsis> save_metadata_file </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.AYONDistribution.validate_distribution class=md-nav__link> <span class=md-ellipsis> validate_distribution </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem class=md-nav__link> <span class=md-ellipsis> BaseDistributionItem </span> </a> <nav class=md-nav aria-label=BaseDistributionItem> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.current_source_progress class=md-nav__link> <span class=md-ellipsis> current_source_progress </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.error_detail class=md-nav__link> <span class=md-ellipsis> error_detail </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.error_message class=md-nav__link> <span class=md-ellipsis> error_message </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.need_distribution class=md-nav__link> <span class=md-ellipsis> need_distribution </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.used_source class=md-nav__link> <span class=md-ellipsis> used_source </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.used_source_progress class=md-nav__link> <span class=md-ellipsis> used_source_progress </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.BaseDistributionItem.distribute class=md-nav__link> <span class=md-ellipsis> distribute </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress class=md-nav__link> <span class=md-ellipsis> DistributeTransferProgress </span> </a> <nav class=md-nav aria-label=DistributeTransferProgress> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.is_running class=md-nav__link> <span class=md-ellipsis> is_running </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.transfer_progress class=md-nav__link> <span class=md-ellipsis> transfer_progress </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.set_failed class=md-nav__link> <span class=md-ellipsis> set_failed </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.set_hash_check_finished class=md-nav__link> <span class=md-ellipsis> set_hash_check_finished </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.set_hash_check_started class=md-nav__link> <span class=md-ellipsis> set_hash_check_started </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.set_started class=md-nav__link> <span class=md-ellipsis> set_started </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.set_unzip_finished class=md-nav__link> <span class=md-ellipsis> set_unzip_finished </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributeTransferProgress.set_unzip_started class=md-nav__link> <span class=md-ellipsis> set_unzip_started </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.DistributionItem class=md-nav__link> <span class=md-ellipsis> DistributionItem </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.InstallerDistributionItem class=md-nav__link> <span class=md-ellipsis> InstallerDistributionItem </span> </a> <nav class=md-nav aria-label=InstallerDistributionItem> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.InstallerDistributionItem.executable class=md-nav__link> <span class=md-ellipsis> executable </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.InstallerDistributionItem.installer_error class=md-nav__link> <span class=md-ellipsis> installer_error </span> </a> </li> <li class=md-nav__item> <a href=#common.ayon_common.distribution.control.InstallerDistributionItem.installer_path class=md-nav__link> <span class=md-ellipsis> installer_path </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>control</h1> <div class="doc doc-object doc-module"> <a id=common.ayon_common.distribution.control></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=common.ayon_common.distribution.control.AYONDistribution class="doc doc-heading"> <code>AYONDistribution</code> </h2> <div class="doc doc-contents "> <p>Distribution control.</p> <p>Receive information from server what addons and dependency packages should be available locally and prepare/validate their distribution.</p> <p>Arguments are available for testing of the class.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>addon_dirpath</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Where addons will be stored.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>dependency_dirpath</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Where dependencies will be stored.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>dist_factory</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<a class="autorefs autorefs-internal" title="DownloadFactory (common.ayon_common.distribution.downloaders.DownloadFactory)" href=downloaders.html#common.ayon_common.distribution.downloaders.DownloadFactory>DownloadFactory</a>]</code> </td> <td> <div class=doc-md-description> <p>Factory which cares about downloading of items based on source type.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>installers_info</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=list>list</span>[<span title=dict>dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]]</code> </td> <td> <div class=doc-md-description> <p>List of prepared installers' info.</p> </div> </td> <td> <code><span title=common.ayon_common.distribution.control.NOT_SET>NOT_SET</span></code> </td> </tr> <tr class=doc-section-item> <td> <code>addons_info</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=list>list</span>[<span title=dict>dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]]</code> </td> <td> <div class=doc-md-description> <p>List of prepared addons' info.</p> </div> </td> <td> <code><span title=common.ayon_common.distribution.control.NOT_SET>NOT_SET</span></code> </td> </tr> <tr class=doc-section-item> <td> <code>dependency_packages_info</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=list>list</span>[<span title=dict>dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]]</code> </td> <td> <div class=doc-md-description> <p>Info about packages from server.</p> </div> </td> <td> <code><span title=common.ayon_common.distribution.control.NOT_SET>NOT_SET</span></code> </td> </tr> <tr class=doc-section-item> <td> <code>bundles_info</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=dict>dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Info about bundles.</p> </div> </td> <td> <code><span title=common.ayon_common.distribution.control.NOT_SET>NOT_SET</span></code> </td> </tr> <tr class=doc-section-item> <td> <code>studio_bundle_name</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Name of studio bundle to use.</p> </div> </td> <td> <code><span title=common.ayon_common.distribution.control.NOT_SET>NOT_SET</span></code> </td> </tr> <tr class=doc-section-item> <td> <code>project_bundle_name</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Name of project bundle to use.</p> </div> </td> <td> <code><span title=common.ayon_common.distribution.control.NOT_SET>NOT_SET</span></code> </td> </tr> <tr class=doc-section-item> <td> <code>project_name</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Name of project for which project bundle can be auto-detected.</p> </div> </td> <td> <code><span title=common.ayon_common.distribution.control.NOT_SET>NOT_SET</span></code> </td> </tr> <tr class=doc-section-item> <td> <code>use_staging</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=bool>bool</span>]</code> </td> <td> <div class=doc-md-description> <p>Use staging versions of an addon. If not passed, 'is_staging_enabled' is used as default value.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>use_dev</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=bool>bool</span>]</code> </td> <td> <div class=doc-md-description> <p>Use develop versions of an addon. If not passed, 'is_dev_mode_enabled' is used as default value.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>skip_installer_dist</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Skip installer distribution. This is for testing purposes and for running from code.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1451</span>
<span class=normal>1452</span>
<span class=normal>1453</span>
<span class=normal>1454</span>
<span class=normal>1455</span>
<span class=normal>1456</span>
<span class=normal>1457</span>
<span class=normal>1458</span>
<span class=normal>1459</span>
<span class=normal>1460</span>
<span class=normal>1461</span>
<span class=normal>1462</span>
<span class=normal>1463</span>
<span class=normal>1464</span>
<span class=normal>1465</span>
<span class=normal>1466</span>
<span class=normal>1467</span>
<span class=normal>1468</span>
<span class=normal>1469</span>
<span class=normal>1470</span>
<span class=normal>1471</span>
<span class=normal>1472</span>
<span class=normal>1473</span>
<span class=normal>1474</span>
<span class=normal>1475</span>
<span class=normal>1476</span>
<span class=normal>1477</span>
<span class=normal>1478</span>
<span class=normal>1479</span>
<span class=normal>1480</span>
<span class=normal>1481</span>
<span class=normal>1482</span>
<span class=normal>1483</span>
<span class=normal>1484</span>
<span class=normal>1485</span>
<span class=normal>1486</span>
<span class=normal>1487</span>
<span class=normal>1488</span>
<span class=normal>1489</span>
<span class=normal>1490</span>
<span class=normal>1491</span>
<span class=normal>1492</span>
<span class=normal>1493</span>
<span class=normal>1494</span>
<span class=normal>1495</span>
<span class=normal>1496</span>
<span class=normal>1497</span>
<span class=normal>1498</span>
<span class=normal>1499</span>
<span class=normal>1500</span>
<span class=normal>1501</span>
<span class=normal>1502</span>
<span class=normal>1503</span>
<span class=normal>1504</span>
<span class=normal>1505</span>
<span class=normal>1506</span>
<span class=normal>1507</span>
<span class=normal>1508</span>
<span class=normal>1509</span>
<span class=normal>1510</span>
<span class=normal>1511</span>
<span class=normal>1512</span>
<span class=normal>1513</span>
<span class=normal>1514</span>
<span class=normal>1515</span>
<span class=normal>1516</span>
<span class=normal>1517</span>
<span class=normal>1518</span>
<span class=normal>1519</span>
<span class=normal>1520</span>
<span class=normal>1521</span>
<span class=normal>1522</span>
<span class=normal>1523</span>
<span class=normal>1524</span>
<span class=normal>1525</span>
<span class=normal>1526</span>
<span class=normal>1527</span>
<span class=normal>1528</span>
<span class=normal>1529</span>
<span class=normal>1530</span>
<span class=normal>1531</span>
<span class=normal>1532</span>
<span class=normal>1533</span>
<span class=normal>1534</span>
<span class=normal>1535</span>
<span class=normal>1536</span>
<span class=normal>1537</span>
<span class=normal>1538</span>
<span class=normal>1539</span>
<span class=normal>1540</span>
<span class=normal>1541</span>
<span class=normal>1542</span>
<span class=normal>1543</span>
<span class=normal>1544</span>
<span class=normal>1545</span>
<span class=normal>1546</span>
<span class=normal>1547</span>
<span class=normal>1548</span>
<span class=normal>1549</span>
<span class=normal>1550</span>
<span class=normal>1551</span>
<span class=normal>1552</span>
<span class=normal>1553</span>
<span class=normal>1554</span>
<span class=normal>1555</span>
<span class=normal>1556</span>
<span class=normal>1557</span>
<span class=normal>1558</span>
<span class=normal>1559</span>
<span class=normal>1560</span>
<span class=normal>1561</span>
<span class=normal>1562</span>
<span class=normal>1563</span>
<span class=normal>1564</span>
<span class=normal>1565</span>
<span class=normal>1566</span>
<span class=normal>1567</span>
<span class=normal>1568</span>
<span class=normal>1569</span>
<span class=normal>1570</span>
<span class=normal>1571</span>
<span class=normal>1572</span>
<span class=normal>1573</span>
<span class=normal>1574</span>
<span class=normal>1575</span>
<span class=normal>1576</span>
<span class=normal>1577</span>
<span class=normal>1578</span>
<span class=normal>1579</span>
<span class=normal>1580</span>
<span class=normal>1581</span>
<span class=normal>1582</span>
<span class=normal>1583</span>
<span class=normal>1584</span>
<span class=normal>1585</span>
<span class=normal>1586</span>
<span class=normal>1587</span>
<span class=normal>1588</span>
<span class=normal>1589</span>
<span class=normal>1590</span>
<span class=normal>1591</span>
<span class=normal>1592</span>
<span class=normal>1593</span>
<span class=normal>1594</span>
<span class=normal>1595</span>
<span class=normal>1596</span>
<span class=normal>1597</span>
<span class=normal>1598</span>
<span class=normal>1599</span>
<span class=normal>1600</span>
<span class=normal>1601</span>
<span class=normal>1602</span>
<span class=normal>1603</span>
<span class=normal>1604</span>
<span class=normal>1605</span>
<span class=normal>1606</span>
<span class=normal>1607</span>
<span class=normal>1608</span>
<span class=normal>1609</span>
<span class=normal>1610</span>
<span class=normal>1611</span>
<span class=normal>1612</span>
<span class=normal>1613</span>
<span class=normal>1614</span>
<span class=normal>1615</span>
<span class=normal>1616</span>
<span class=normal>1617</span>
<span class=normal>1618</span>
<span class=normal>1619</span>
<span class=normal>1620</span>
<span class=normal>1621</span>
<span class=normal>1622</span>
<span class=normal>1623</span>
<span class=normal>1624</span>
<span class=normal>1625</span>
<span class=normal>1626</span>
<span class=normal>1627</span>
<span class=normal>1628</span>
<span class=normal>1629</span>
<span class=normal>1630</span>
<span class=normal>1631</span>
<span class=normal>1632</span>
<span class=normal>1633</span>
<span class=normal>1634</span>
<span class=normal>1635</span>
<span class=normal>1636</span>
<span class=normal>1637</span>
<span class=normal>1638</span>
<span class=normal>1639</span>
<span class=normal>1640</span>
<span class=normal>1641</span>
<span class=normal>1642</span>
<span class=normal>1643</span>
<span class=normal>1644</span>
<span class=normal>1645</span>
<span class=normal>1646</span>
<span class=normal>1647</span>
<span class=normal>1648</span>
<span class=normal>1649</span>
<span class=normal>1650</span>
<span class=normal>1651</span>
<span class=normal>1652</span>
<span class=normal>1653</span>
<span class=normal>1654</span>
<span class=normal>1655</span>
<span class=normal>1656</span>
<span class=normal>1657</span>
<span class=normal>1658</span>
<span class=normal>1659</span>
<span class=normal>1660</span>
<span class=normal>1661</span>
<span class=normal>1662</span>
<span class=normal>1663</span>
<span class=normal>1664</span>
<span class=normal>1665</span>
<span class=normal>1666</span>
<span class=normal>1667</span>
<span class=normal>1668</span>
<span class=normal>1669</span>
<span class=normal>1670</span>
<span class=normal>1671</span>
<span class=normal>1672</span>
<span class=normal>1673</span>
<span class=normal>1674</span>
<span class=normal>1675</span>
<span class=normal>1676</span>
<span class=normal>1677</span>
<span class=normal>1678</span>
<span class=normal>1679</span>
<span class=normal>1680</span>
<span class=normal>1681</span>
<span class=normal>1682</span>
<span class=normal>1683</span>
<span class=normal>1684</span>
<span class=normal>1685</span>
<span class=normal>1686</span>
<span class=normal>1687</span>
<span class=normal>1688</span>
<span class=normal>1689</span>
<span class=normal>1690</span>
<span class=normal>1691</span>
<span class=normal>1692</span>
<span class=normal>1693</span>
<span class=normal>1694</span>
<span class=normal>1695</span>
<span class=normal>1696</span>
<span class=normal>1697</span>
<span class=normal>1698</span>
<span class=normal>1699</span>
<span class=normal>1700</span>
<span class=normal>1701</span>
<span class=normal>1702</span>
<span class=normal>1703</span>
<span class=normal>1704</span>
<span class=normal>1705</span>
<span class=normal>1706</span>
<span class=normal>1707</span>
<span class=normal>1708</span>
<span class=normal>1709</span>
<span class=normal>1710</span>
<span class=normal>1711</span>
<span class=normal>1712</span>
<span class=normal>1713</span>
<span class=normal>1714</span>
<span class=normal>1715</span>
<span class=normal>1716</span>
<span class=normal>1717</span>
<span class=normal>1718</span>
<span class=normal>1719</span>
<span class=normal>1720</span>
<span class=normal>1721</span>
<span class=normal>1722</span>
<span class=normal>1723</span>
<span class=normal>1724</span>
<span class=normal>1725</span>
<span class=normal>1726</span>
<span class=normal>1727</span>
<span class=normal>1728</span>
<span class=normal>1729</span>
<span class=normal>1730</span>
<span class=normal>1731</span>
<span class=normal>1732</span>
<span class=normal>1733</span>
<span class=normal>1734</span>
<span class=normal>1735</span>
<span class=normal>1736</span>
<span class=normal>1737</span>
<span class=normal>1738</span>
<span class=normal>1739</span>
<span class=normal>1740</span>
<span class=normal>1741</span>
<span class=normal>1742</span>
<span class=normal>1743</span>
<span class=normal>1744</span>
<span class=normal>1745</span>
<span class=normal>1746</span>
<span class=normal>1747</span>
<span class=normal>1748</span>
<span class=normal>1749</span>
<span class=normal>1750</span>
<span class=normal>1751</span>
<span class=normal>1752</span>
<span class=normal>1753</span>
<span class=normal>1754</span>
<span class=normal>1755</span>
<span class=normal>1756</span>
<span class=normal>1757</span>
<span class=normal>1758</span>
<span class=normal>1759</span>
<span class=normal>1760</span>
<span class=normal>1761</span>
<span class=normal>1762</span>
<span class=normal>1763</span>
<span class=normal>1764</span>
<span class=normal>1765</span>
<span class=normal>1766</span>
<span class=normal>1767</span>
<span class=normal>1768</span>
<span class=normal>1769</span>
<span class=normal>1770</span>
<span class=normal>1771</span>
<span class=normal>1772</span>
<span class=normal>1773</span>
<span class=normal>1774</span>
<span class=normal>1775</span>
<span class=normal>1776</span>
<span class=normal>1777</span>
<span class=normal>1778</span>
<span class=normal>1779</span>
<span class=normal>1780</span>
<span class=normal>1781</span>
<span class=normal>1782</span>
<span class=normal>1783</span>
<span class=normal>1784</span>
<span class=normal>1785</span>
<span class=normal>1786</span>
<span class=normal>1787</span>
<span class=normal>1788</span>
<span class=normal>1789</span>
<span class=normal>1790</span>
<span class=normal>1791</span>
<span class=normal>1792</span>
<span class=normal>1793</span>
<span class=normal>1794</span>
<span class=normal>1795</span>
<span class=normal>1796</span>
<span class=normal>1797</span>
<span class=normal>1798</span>
<span class=normal>1799</span>
<span class=normal>1800</span>
<span class=normal>1801</span>
<span class=normal>1802</span>
<span class=normal>1803</span>
<span class=normal>1804</span>
<span class=normal>1805</span>
<span class=normal>1806</span>
<span class=normal>1807</span>
<span class=normal>1808</span>
<span class=normal>1809</span>
<span class=normal>1810</span>
<span class=normal>1811</span>
<span class=normal>1812</span>
<span class=normal>1813</span>
<span class=normal>1814</span>
<span class=normal>1815</span>
<span class=normal>1816</span>
<span class=normal>1817</span>
<span class=normal>1818</span>
<span class=normal>1819</span>
<span class=normal>1820</span>
<span class=normal>1821</span>
<span class=normal>1822</span>
<span class=normal>1823</span>
<span class=normal>1824</span>
<span class=normal>1825</span>
<span class=normal>1826</span>
<span class=normal>1827</span>
<span class=normal>1828</span>
<span class=normal>1829</span>
<span class=normal>1830</span>
<span class=normal>1831</span>
<span class=normal>1832</span>
<span class=normal>1833</span>
<span class=normal>1834</span>
<span class=normal>1835</span>
<span class=normal>1836</span>
<span class=normal>1837</span>
<span class=normal>1838</span>
<span class=normal>1839</span>
<span class=normal>1840</span>
<span class=normal>1841</span>
<span class=normal>1842</span>
<span class=normal>1843</span>
<span class=normal>1844</span>
<span class=normal>1845</span>
<span class=normal>1846</span>
<span class=normal>1847</span>
<span class=normal>1848</span>
<span class=normal>1849</span>
<span class=normal>1850</span>
<span class=normal>1851</span>
<span class=normal>1852</span>
<span class=normal>1853</span>
<span class=normal>1854</span>
<span class=normal>1855</span>
<span class=normal>1856</span>
<span class=normal>1857</span>
<span class=normal>1858</span>
<span class=normal>1859</span>
<span class=normal>1860</span>
<span class=normal>1861</span>
<span class=normal>1862</span>
<span class=normal>1863</span>
<span class=normal>1864</span>
<span class=normal>1865</span>
<span class=normal>1866</span>
<span class=normal>1867</span>
<span class=normal>1868</span>
<span class=normal>1869</span>
<span class=normal>1870</span>
<span class=normal>1871</span>
<span class=normal>1872</span>
<span class=normal>1873</span>
<span class=normal>1874</span>
<span class=normal>1875</span>
<span class=normal>1876</span>
<span class=normal>1877</span>
<span class=normal>1878</span>
<span class=normal>1879</span>
<span class=normal>1880</span>
<span class=normal>1881</span>
<span class=normal>1882</span>
<span class=normal>1883</span>
<span class=normal>1884</span>
<span class=normal>1885</span>
<span class=normal>1886</span>
<span class=normal>1887</span>
<span class=normal>1888</span>
<span class=normal>1889</span>
<span class=normal>1890</span>
<span class=normal>1891</span>
<span class=normal>1892</span>
<span class=normal>1893</span>
<span class=normal>1894</span>
<span class=normal>1895</span>
<span class=normal>1896</span>
<span class=normal>1897</span>
<span class=normal>1898</span>
<span class=normal>1899</span>
<span class=normal>1900</span>
<span class=normal>1901</span>
<span class=normal>1902</span>
<span class=normal>1903</span>
<span class=normal>1904</span>
<span class=normal>1905</span>
<span class=normal>1906</span>
<span class=normal>1907</span>
<span class=normal>1908</span>
<span class=normal>1909</span>
<span class=normal>1910</span>
<span class=normal>1911</span>
<span class=normal>1912</span>
<span class=normal>1913</span>
<span class=normal>1914</span>
<span class=normal>1915</span>
<span class=normal>1916</span>
<span class=normal>1917</span>
<span class=normal>1918</span>
<span class=normal>1919</span>
<span class=normal>1920</span>
<span class=normal>1921</span>
<span class=normal>1922</span>
<span class=normal>1923</span>
<span class=normal>1924</span>
<span class=normal>1925</span>
<span class=normal>1926</span>
<span class=normal>1927</span>
<span class=normal>1928</span>
<span class=normal>1929</span>
<span class=normal>1930</span>
<span class=normal>1931</span>
<span class=normal>1932</span>
<span class=normal>1933</span>
<span class=normal>1934</span>
<span class=normal>1935</span>
<span class=normal>1936</span>
<span class=normal>1937</span>
<span class=normal>1938</span>
<span class=normal>1939</span>
<span class=normal>1940</span>
<span class=normal>1941</span>
<span class=normal>1942</span>
<span class=normal>1943</span>
<span class=normal>1944</span>
<span class=normal>1945</span>
<span class=normal>1946</span>
<span class=normal>1947</span>
<span class=normal>1948</span>
<span class=normal>1949</span>
<span class=normal>1950</span>
<span class=normal>1951</span>
<span class=normal>1952</span>
<span class=normal>1953</span>
<span class=normal>1954</span>
<span class=normal>1955</span>
<span class=normal>1956</span>
<span class=normal>1957</span>
<span class=normal>1958</span>
<span class=normal>1959</span>
<span class=normal>1960</span>
<span class=normal>1961</span>
<span class=normal>1962</span>
<span class=normal>1963</span>
<span class=normal>1964</span>
<span class=normal>1965</span>
<span class=normal>1966</span>
<span class=normal>1967</span>
<span class=normal>1968</span>
<span class=normal>1969</span>
<span class=normal>1970</span>
<span class=normal>1971</span>
<span class=normal>1972</span>
<span class=normal>1973</span>
<span class=normal>1974</span>
<span class=normal>1975</span>
<span class=normal>1976</span>
<span class=normal>1977</span>
<span class=normal>1978</span>
<span class=normal>1979</span>
<span class=normal>1980</span>
<span class=normal>1981</span>
<span class=normal>1982</span>
<span class=normal>1983</span>
<span class=normal>1984</span>
<span class=normal>1985</span>
<span class=normal>1986</span>
<span class=normal>1987</span>
<span class=normal>1988</span>
<span class=normal>1989</span>
<span class=normal>1990</span>
<span class=normal>1991</span>
<span class=normal>1992</span>
<span class=normal>1993</span>
<span class=normal>1994</span>
<span class=normal>1995</span>
<span class=normal>1996</span>
<span class=normal>1997</span>
<span class=normal>1998</span>
<span class=normal>1999</span>
<span class=normal>2000</span>
<span class=normal>2001</span>
<span class=normal>2002</span>
<span class=normal>2003</span>
<span class=normal>2004</span>
<span class=normal>2005</span>
<span class=normal>2006</span>
<span class=normal>2007</span>
<span class=normal>2008</span>
<span class=normal>2009</span>
<span class=normal>2010</span>
<span class=normal>2011</span>
<span class=normal>2012</span>
<span class=normal>2013</span>
<span class=normal>2014</span>
<span class=normal>2015</span>
<span class=normal>2016</span>
<span class=normal>2017</span>
<span class=normal>2018</span>
<span class=normal>2019</span>
<span class=normal>2020</span>
<span class=normal>2021</span>
<span class=normal>2022</span>
<span class=normal>2023</span>
<span class=normal>2024</span>
<span class=normal>2025</span>
<span class=normal>2026</span>
<span class=normal>2027</span>
<span class=normal>2028</span>
<span class=normal>2029</span>
<span class=normal>2030</span>
<span class=normal>2031</span>
<span class=normal>2032</span>
<span class=normal>2033</span>
<span class=normal>2034</span>
<span class=normal>2035</span>
<span class=normal>2036</span>
<span class=normal>2037</span>
<span class=normal>2038</span>
<span class=normal>2039</span>
<span class=normal>2040</span>
<span class=normal>2041</span>
<span class=normal>2042</span>
<span class=normal>2043</span>
<span class=normal>2044</span>
<span class=normal>2045</span>
<span class=normal>2046</span>
<span class=normal>2047</span>
<span class=normal>2048</span>
<span class=normal>2049</span>
<span class=normal>2050</span>
<span class=normal>2051</span>
<span class=normal>2052</span>
<span class=normal>2053</span>
<span class=normal>2054</span>
<span class=normal>2055</span>
<span class=normal>2056</span>
<span class=normal>2057</span>
<span class=normal>2058</span>
<span class=normal>2059</span>
<span class=normal>2060</span>
<span class=normal>2061</span>
<span class=normal>2062</span>
<span class=normal>2063</span>
<span class=normal>2064</span>
<span class=normal>2065</span>
<span class=normal>2066</span>
<span class=normal>2067</span>
<span class=normal>2068</span>
<span class=normal>2069</span>
<span class=normal>2070</span>
<span class=normal>2071</span>
<span class=normal>2072</span>
<span class=normal>2073</span>
<span class=normal>2074</span>
<span class=normal>2075</span>
<span class=normal>2076</span>
<span class=normal>2077</span>
<span class=normal>2078</span>
<span class=normal>2079</span>
<span class=normal>2080</span>
<span class=normal>2081</span>
<span class=normal>2082</span>
<span class=normal>2083</span>
<span class=normal>2084</span>
<span class=normal>2085</span>
<span class=normal>2086</span>
<span class=normal>2087</span>
<span class=normal>2088</span>
<span class=normal>2089</span>
<span class=normal>2090</span>
<span class=normal>2091</span>
<span class=normal>2092</span>
<span class=normal>2093</span>
<span class=normal>2094</span>
<span class=normal>2095</span>
<span class=normal>2096</span>
<span class=normal>2097</span>
<span class=normal>2098</span>
<span class=normal>2099</span>
<span class=normal>2100</span>
<span class=normal>2101</span>
<span class=normal>2102</span>
<span class=normal>2103</span>
<span class=normal>2104</span>
<span class=normal>2105</span>
<span class=normal>2106</span>
<span class=normal>2107</span>
<span class=normal>2108</span>
<span class=normal>2109</span>
<span class=normal>2110</span>
<span class=normal>2111</span>
<span class=normal>2112</span>
<span class=normal>2113</span>
<span class=normal>2114</span>
<span class=normal>2115</span>
<span class=normal>2116</span>
<span class=normal>2117</span>
<span class=normal>2118</span>
<span class=normal>2119</span>
<span class=normal>2120</span>
<span class=normal>2121</span>
<span class=normal>2122</span>
<span class=normal>2123</span>
<span class=normal>2124</span>
<span class=normal>2125</span>
<span class=normal>2126</span>
<span class=normal>2127</span>
<span class=normal>2128</span>
<span class=normal>2129</span>
<span class=normal>2130</span>
<span class=normal>2131</span>
<span class=normal>2132</span>
<span class=normal>2133</span>
<span class=normal>2134</span>
<span class=normal>2135</span>
<span class=normal>2136</span>
<span class=normal>2137</span>
<span class=normal>2138</span>
<span class=normal>2139</span>
<span class=normal>2140</span>
<span class=normal>2141</span>
<span class=normal>2142</span>
<span class=normal>2143</span>
<span class=normal>2144</span>
<span class=normal>2145</span>
<span class=normal>2146</span>
<span class=normal>2147</span>
<span class=normal>2148</span>
<span class=normal>2149</span>
<span class=normal>2150</span>
<span class=normal>2151</span>
<span class=normal>2152</span>
<span class=normal>2153</span>
<span class=normal>2154</span>
<span class=normal>2155</span>
<span class=normal>2156</span>
<span class=normal>2157</span>
<span class=normal>2158</span>
<span class=normal>2159</span>
<span class=normal>2160</span>
<span class=normal>2161</span>
<span class=normal>2162</span>
<span class=normal>2163</span>
<span class=normal>2164</span>
<span class=normal>2165</span>
<span class=normal>2166</span>
<span class=normal>2167</span>
<span class=normal>2168</span>
<span class=normal>2169</span>
<span class=normal>2170</span>
<span class=normal>2171</span>
<span class=normal>2172</span>
<span class=normal>2173</span>
<span class=normal>2174</span>
<span class=normal>2175</span>
<span class=normal>2176</span>
<span class=normal>2177</span>
<span class=normal>2178</span>
<span class=normal>2179</span>
<span class=normal>2180</span>
<span class=normal>2181</span>
<span class=normal>2182</span>
<span class=normal>2183</span>
<span class=normal>2184</span>
<span class=normal>2185</span>
<span class=normal>2186</span>
<span class=normal>2187</span>
<span class=normal>2188</span>
<span class=normal>2189</span>
<span class=normal>2190</span>
<span class=normal>2191</span>
<span class=normal>2192</span>
<span class=normal>2193</span>
<span class=normal>2194</span>
<span class=normal>2195</span>
<span class=normal>2196</span>
<span class=normal>2197</span>
<span class=normal>2198</span>
<span class=normal>2199</span>
<span class=normal>2200</span>
<span class=normal>2201</span>
<span class=normal>2202</span>
<span class=normal>2203</span>
<span class=normal>2204</span>
<span class=normal>2205</span>
<span class=normal>2206</span>
<span class=normal>2207</span>
<span class=normal>2208</span>
<span class=normal>2209</span>
<span class=normal>2210</span>
<span class=normal>2211</span>
<span class=normal>2212</span>
<span class=normal>2213</span>
<span class=normal>2214</span>
<span class=normal>2215</span>
<span class=normal>2216</span>
<span class=normal>2217</span>
<span class=normal>2218</span>
<span class=normal>2219</span>
<span class=normal>2220</span>
<span class=normal>2221</span>
<span class=normal>2222</span>
<span class=normal>2223</span>
<span class=normal>2224</span>
<span class=normal>2225</span>
<span class=normal>2226</span>
<span class=normal>2227</span>
<span class=normal>2228</span>
<span class=normal>2229</span>
<span class=normal>2230</span>
<span class=normal>2231</span>
<span class=normal>2232</span>
<span class=normal>2233</span>
<span class=normal>2234</span>
<span class=normal>2235</span>
<span class=normal>2236</span>
<span class=normal>2237</span>
<span class=normal>2238</span>
<span class=normal>2239</span>
<span class=normal>2240</span>
<span class=normal>2241</span>
<span class=normal>2242</span>
<span class=normal>2243</span>
<span class=normal>2244</span>
<span class=normal>2245</span>
<span class=normal>2246</span>
<span class=normal>2247</span>
<span class=normal>2248</span>
<span class=normal>2249</span>
<span class=normal>2250</span>
<span class=normal>2251</span>
<span class=normal>2252</span>
<span class=normal>2253</span>
<span class=normal>2254</span>
<span class=normal>2255</span>
<span class=normal>2256</span>
<span class=normal>2257</span>
<span class=normal>2258</span>
<span class=normal>2259</span>
<span class=normal>2260</span>
<span class=normal>2261</span>
<span class=normal>2262</span>
<span class=normal>2263</span>
<span class=normal>2264</span>
<span class=normal>2265</span>
<span class=normal>2266</span>
<span class=normal>2267</span>
<span class=normal>2268</span>
<span class=normal>2269</span>
<span class=normal>2270</span>
<span class=normal>2271</span>
<span class=normal>2272</span>
<span class=normal>2273</span>
<span class=normal>2274</span>
<span class=normal>2275</span>
<span class=normal>2276</span>
<span class=normal>2277</span>
<span class=normal>2278</span>
<span class=normal>2279</span>
<span class=normal>2280</span>
<span class=normal>2281</span>
<span class=normal>2282</span>
<span class=normal>2283</span>
<span class=normal>2284</span>
<span class=normal>2285</span>
<span class=normal>2286</span>
<span class=normal>2287</span>
<span class=normal>2288</span>
<span class=normal>2289</span>
<span class=normal>2290</span>
<span class=normal>2291</span>
<span class=normal>2292</span>
<span class=normal>2293</span>
<span class=normal>2294</span>
<span class=normal>2295</span>
<span class=normal>2296</span>
<span class=normal>2297</span>
<span class=normal>2298</span>
<span class=normal>2299</span>
<span class=normal>2300</span>
<span class=normal>2301</span>
<span class=normal>2302</span>
<span class=normal>2303</span>
<span class=normal>2304</span>
<span class=normal>2305</span>
<span class=normal>2306</span>
<span class=normal>2307</span>
<span class=normal>2308</span>
<span class=normal>2309</span>
<span class=normal>2310</span>
<span class=normal>2311</span>
<span class=normal>2312</span>
<span class=normal>2313</span>
<span class=normal>2314</span>
<span class=normal>2315</span>
<span class=normal>2316</span>
<span class=normal>2317</span>
<span class=normal>2318</span>
<span class=normal>2319</span>
<span class=normal>2320</span>
<span class=normal>2321</span>
<span class=normal>2322</span>
<span class=normal>2323</span>
<span class=normal>2324</span>
<span class=normal>2325</span>
<span class=normal>2326</span>
<span class=normal>2327</span>
<span class=normal>2328</span>
<span class=normal>2329</span>
<span class=normal>2330</span>
<span class=normal>2331</span>
<span class=normal>2332</span>
<span class=normal>2333</span>
<span class=normal>2334</span>
<span class=normal>2335</span>
<span class=normal>2336</span>
<span class=normal>2337</span>
<span class=normal>2338</span>
<span class=normal>2339</span>
<span class=normal>2340</span>
<span class=normal>2341</span>
<span class=normal>2342</span>
<span class=normal>2343</span>
<span class=normal>2344</span>
<span class=normal>2345</span>
<span class=normal>2346</span>
<span class=normal>2347</span>
<span class=normal>2348</span>
<span class=normal>2349</span>
<span class=normal>2350</span>
<span class=normal>2351</span>
<span class=normal>2352</span>
<span class=normal>2353</span>
<span class=normal>2354</span>
<span class=normal>2355</span>
<span class=normal>2356</span>
<span class=normal>2357</span>
<span class=normal>2358</span>
<span class=normal>2359</span>
<span class=normal>2360</span>
<span class=normal>2361</span>
<span class=normal>2362</span>
<span class=normal>2363</span>
<span class=normal>2364</span>
<span class=normal>2365</span>
<span class=normal>2366</span>
<span class=normal>2367</span>
<span class=normal>2368</span>
<span class=normal>2369</span>
<span class=normal>2370</span>
<span class=normal>2371</span>
<span class=normal>2372</span>
<span class=normal>2373</span>
<span class=normal>2374</span>
<span class=normal>2375</span>
<span class=normal>2376</span>
<span class=normal>2377</span>
<span class=normal>2378</span>
<span class=normal>2379</span>
<span class=normal>2380</span>
<span class=normal>2381</span>
<span class=normal>2382</span>
<span class=normal>2383</span>
<span class=normal>2384</span>
<span class=normal>2385</span>
<span class=normal>2386</span>
<span class=normal>2387</span>
<span class=normal>2388</span>
<span class=normal>2389</span>
<span class=normal>2390</span>
<span class=normal>2391</span>
<span class=normal>2392</span>
<span class=normal>2393</span>
<span class=normal>2394</span>
<span class=normal>2395</span>
<span class=normal>2396</span>
<span class=normal>2397</span>
<span class=normal>2398</span>
<span class=normal>2399</span>
<span class=normal>2400</span>
<span class=normal>2401</span>
<span class=normal>2402</span>
<span class=normal>2403</span>
<span class=normal>2404</span>
<span class=normal>2405</span>
<span class=normal>2406</span>
<span class=normal>2407</span>
<span class=normal>2408</span>
<span class=normal>2409</span>
<span class=normal>2410</span>
<span class=normal>2411</span>
<span class=normal>2412</span>
<span class=normal>2413</span>
<span class=normal>2414</span>
<span class=normal>2415</span>
<span class=normal>2416</span>
<span class=normal>2417</span>
<span class=normal>2418</span>
<span class=normal>2419</span>
<span class=normal>2420</span>
<span class=normal>2421</span>
<span class=normal>2422</span>
<span class=normal>2423</span>
<span class=normal>2424</span>
<span class=normal>2425</span>
<span class=normal>2426</span>
<span class=normal>2427</span>
<span class=normal>2428</span>
<span class=normal>2429</span>
<span class=normal>2430</span>
<span class=normal>2431</span>
<span class=normal>2432</span>
<span class=normal>2433</span>
<span class=normal>2434</span>
<span class=normal>2435</span>
<span class=normal>2436</span>
<span class=normal>2437</span>
<span class=normal>2438</span>
<span class=normal>2439</span>
<span class=normal>2440</span>
<span class=normal>2441</span>
<span class=normal>2442</span>
<span class=normal>2443</span>
<span class=normal>2444</span>
<span class=normal>2445</span>
<span class=normal>2446</span>
<span class=normal>2447</span>
<span class=normal>2448</span>
<span class=normal>2449</span>
<span class=normal>2450</span>
<span class=normal>2451</span>
<span class=normal>2452</span>
<span class=normal>2453</span>
<span class=normal>2454</span>
<span class=normal>2455</span>
<span class=normal>2456</span>
<span class=normal>2457</span>
<span class=normal>2458</span>
<span class=normal>2459</span>
<span class=normal>2460</span>
<span class=normal>2461</span>
<span class=normal>2462</span>
<span class=normal>2463</span>
<span class=normal>2464</span>
<span class=normal>2465</span>
<span class=normal>2466</span>
<span class=normal>2467</span>
<span class=normal>2468</span>
<span class=normal>2469</span>
<span class=normal>2470</span>
<span class=normal>2471</span>
<span class=normal>2472</span>
<span class=normal>2473</span>
<span class=normal>2474</span>
<span class=normal>2475</span>
<span class=normal>2476</span>
<span class=normal>2477</span>
<span class=normal>2478</span>
<span class=normal>2479</span>
<span class=normal>2480</span>
<span class=normal>2481</span>
<span class=normal>2482</span>
<span class=normal>2483</span>
<span class=normal>2484</span>
<span class=normal>2485</span>
<span class=normal>2486</span>
<span class=normal>2487</span>
<span class=normal>2488</span>
<span class=normal>2489</span>
<span class=normal>2490</span>
<span class=normal>2491</span>
<span class=normal>2492</span>
<span class=normal>2493</span>
<span class=normal>2494</span>
<span class=normal>2495</span>
<span class=normal>2496</span>
<span class=normal>2497</span>
<span class=normal>2498</span>
<span class=normal>2499</span>
<span class=normal>2500</span>
<span class=normal>2501</span>
<span class=normal>2502</span>
<span class=normal>2503</span>
<span class=normal>2504</span>
<span class=normal>2505</span>
<span class=normal>2506</span>
<span class=normal>2507</span>
<span class=normal>2508</span>
<span class=normal>2509</span>
<span class=normal>2510</span>
<span class=normal>2511</span>
<span class=normal>2512</span>
<span class=normal>2513</span>
<span class=normal>2514</span>
<span class=normal>2515</span>
<span class=normal>2516</span>
<span class=normal>2517</span>
<span class=normal>2518</span>
<span class=normal>2519</span>
<span class=normal>2520</span>
<span class=normal>2521</span>
<span class=normal>2522</span>
<span class=normal>2523</span>
<span class=normal>2524</span>
<span class=normal>2525</span>
<span class=normal>2526</span>
<span class=normal>2527</span>
<span class=normal>2528</span>
<span class=normal>2529</span>
<span class=normal>2530</span>
<span class=normal>2531</span>
<span class=normal>2532</span>
<span class=normal>2533</span>
<span class=normal>2534</span>
<span class=normal>2535</span>
<span class=normal>2536</span>
<span class=normal>2537</span>
<span class=normal>2538</span>
<span class=normal>2539</span>
<span class=normal>2540</span>
<span class=normal>2541</span>
<span class=normal>2542</span>
<span class=normal>2543</span>
<span class=normal>2544</span>
<span class=normal>2545</span>
<span class=normal>2546</span>
<span class=normal>2547</span>
<span class=normal>2548</span>
<span class=normal>2549</span>
<span class=normal>2550</span>
<span class=normal>2551</span>
<span class=normal>2552</span>
<span class=normal>2553</span>
<span class=normal>2554</span>
<span class=normal>2555</span>
<span class=normal>2556</span>
<span class=normal>2557</span>
<span class=normal>2558</span>
<span class=normal>2559</span>
<span class=normal>2560</span>
<span class=normal>2561</span>
<span class=normal>2562</span>
<span class=normal>2563</span>
<span class=normal>2564</span>
<span class=normal>2565</span>
<span class=normal>2566</span>
<span class=normal>2567</span>
<span class=normal>2568</span>
<span class=normal>2569</span>
<span class=normal>2570</span>
<span class=normal>2571</span>
<span class=normal>2572</span>
<span class=normal>2573</span>
<span class=normal>2574</span>
<span class=normal>2575</span>
<span class=normal>2576</span>
<span class=normal>2577</span>
<span class=normal>2578</span>
<span class=normal>2579</span>
<span class=normal>2580</span>
<span class=normal>2581</span>
<span class=normal>2582</span>
<span class=normal>2583</span>
<span class=normal>2584</span>
<span class=normal>2585</span>
<span class=normal>2586</span>
<span class=normal>2587</span>
<span class=normal>2588</span>
<span class=normal>2589</span>
<span class=normal>2590</span>
<span class=normal>2591</span>
<span class=normal>2592</span>
<span class=normal>2593</span>
<span class=normal>2594</span>
<span class=normal>2595</span>
<span class=normal>2596</span>
<span class=normal>2597</span>
<span class=normal>2598</span>
<span class=normal>2599</span>
<span class=normal>2600</span>
<span class=normal>2601</span>
<span class=normal>2602</span>
<span class=normal>2603</span>
<span class=normal>2604</span>
<span class=normal>2605</span>
<span class=normal>2606</span>
<span class=normal>2607</span>
<span class=normal>2608</span>
<span class=normal>2609</span>
<span class=normal>2610</span>
<span class=normal>2611</span>
<span class=normal>2612</span>
<span class=normal>2613</span>
<span class=normal>2614</span>
<span class=normal>2615</span>
<span class=normal>2616</span>
<span class=normal>2617</span>
<span class=normal>2618</span>
<span class=normal>2619</span>
<span class=normal>2620</span>
<span class=normal>2621</span>
<span class=normal>2622</span>
<span class=normal>2623</span>
<span class=normal>2624</span>
<span class=normal>2625</span>
<span class=normal>2626</span>
<span class=normal>2627</span>
<span class=normal>2628</span>
<span class=normal>2629</span>
<span class=normal>2630</span>
<span class=normal>2631</span>
<span class=normal>2632</span>
<span class=normal>2633</span>
<span class=normal>2634</span>
<span class=normal>2635</span>
<span class=normal>2636</span>
<span class=normal>2637</span>
<span class=normal>2638</span>
<span class=normal>2639</span>
<span class=normal>2640</span>
<span class=normal>2641</span>
<span class=normal>2642</span>
<span class=normal>2643</span>
<span class=normal>2644</span>
<span class=normal>2645</span>
<span class=normal>2646</span>
<span class=normal>2647</span>
<span class=normal>2648</span>
<span class=normal>2649</span>
<span class=normal>2650</span>
<span class=normal>2651</span>
<span class=normal>2652</span>
<span class=normal>2653</span>
<span class=normal>2654</span>
<span class=normal>2655</span>
<span class=normal>2656</span>
<span class=normal>2657</span>
<span class=normal>2658</span>
<span class=normal>2659</span>
<span class=normal>2660</span>
<span class=normal>2661</span>
<span class=normal>2662</span>
<span class=normal>2663</span>
<span class=normal>2664</span>
<span class=normal>2665</span>
<span class=normal>2666</span>
<span class=normal>2667</span>
<span class=normal>2668</span>
<span class=normal>2669</span>
<span class=normal>2670</span>
<span class=normal>2671</span>
<span class=normal>2672</span>
<span class=normal>2673</span>
<span class=normal>2674</span>
<span class=normal>2675</span>
<span class=normal>2676</span>
<span class=normal>2677</span>
<span class=normal>2678</span>
<span class=normal>2679</span>
<span class=normal>2680</span>
<span class=normal>2681</span>
<span class=normal>2682</span>
<span class=normal>2683</span>
<span class=normal>2684</span>
<span class=normal>2685</span>
<span class=normal>2686</span>
<span class=normal>2687</span>
<span class=normal>2688</span>
<span class=normal>2689</span>
<span class=normal>2690</span>
<span class=normal>2691</span>
<span class=normal>2692</span>
<span class=normal>2693</span>
<span class=normal>2694</span>
<span class=normal>2695</span>
<span class=normal>2696</span>
<span class=normal>2697</span>
<span class=normal>2698</span>
<span class=normal>2699</span>
<span class=normal>2700</span>
<span class=normal>2701</span>
<span class=normal>2702</span>
<span class=normal>2703</span>
<span class=normal>2704</span>
<span class=normal>2705</span>
<span class=normal>2706</span>
<span class=normal>2707</span>
<span class=normal>2708</span>
<span class=normal>2709</span>
<span class=normal>2710</span>
<span class=normal>2711</span>
<span class=normal>2712</span>
<span class=normal>2713</span>
<span class=normal>2714</span>
<span class=normal>2715</span>
<span class=normal>2716</span>
<span class=normal>2717</span>
<span class=normal>2718</span>
<span class=normal>2719</span>
<span class=normal>2720</span>
<span class=normal>2721</span>
<span class=normal>2722</span>
<span class=normal>2723</span>
<span class=normal>2724</span>
<span class=normal>2725</span>
<span class=normal>2726</span>
<span class=normal>2727</span>
<span class=normal>2728</span>
<span class=normal>2729</span>
<span class=normal>2730</span>
<span class=normal>2731</span>
<span class=normal>2732</span>
<span class=normal>2733</span>
<span class=normal>2734</span>
<span class=normal>2735</span>
<span class=normal>2736</span>
<span class=normal>2737</span>
<span class=normal>2738</span>
<span class=normal>2739</span>
<span class=normal>2740</span>
<span class=normal>2741</span>
<span class=normal>2742</span>
<span class=normal>2743</span>
<span class=normal>2744</span>
<span class=normal>2745</span>
<span class=normal>2746</span>
<span class=normal>2747</span>
<span class=normal>2748</span>
<span class=normal>2749</span>
<span class=normal>2750</span>
<span class=normal>2751</span>
<span class=normal>2752</span>
<span class=normal>2753</span>
<span class=normal>2754</span>
<span class=normal>2755</span>
<span class=normal>2756</span>
<span class=normal>2757</span>
<span class=normal>2758</span>
<span class=normal>2759</span>
<span class=normal>2760</span>
<span class=normal>2761</span>
<span class=normal>2762</span>
<span class=normal>2763</span>
<span class=normal>2764</span>
<span class=normal>2765</span>
<span class=normal>2766</span>
<span class=normal>2767</span>
<span class=normal>2768</span>
<span class=normal>2769</span>
<span class=normal>2770</span>
<span class=normal>2771</span>
<span class=normal>2772</span>
<span class=normal>2773</span>
<span class=normal>2774</span>
<span class=normal>2775</span>
<span class=normal>2776</span>
<span class=normal>2777</span>
<span class=normal>2778</span>
<span class=normal>2779</span>
<span class=normal>2780</span>
<span class=normal>2781</span>
<span class=normal>2782</span>
<span class=normal>2783</span>
<span class=normal>2784</span>
<span class=normal>2785</span>
<span class=normal>2786</span>
<span class=normal>2787</span>
<span class=normal>2788</span>
<span class=normal>2789</span>
<span class=normal>2790</span>
<span class=normal>2791</span>
<span class=normal>2792</span>
<span class=normal>2793</span>
<span class=normal>2794</span>
<span class=normal>2795</span>
<span class=normal>2796</span>
<span class=normal>2797</span>
<span class=normal>2798</span>
<span class=normal>2799</span>
<span class=normal>2800</span>
<span class=normal>2801</span>
<span class=normal>2802</span>
<span class=normal>2803</span>
<span class=normal>2804</span>
<span class=normal>2805</span>
<span class=normal>2806</span>
<span class=normal>2807</span>
<span class=normal>2808</span>
<span class=normal>2809</span>
<span class=normal>2810</span>
<span class=normal>2811</span>
<span class=normal>2812</span>
<span class=normal>2813</span>
<span class=normal>2814</span>
<span class=normal>2815</span>
<span class=normal>2816</span>
<span class=normal>2817</span>
<span class=normal>2818</span>
<span class=normal>2819</span>
<span class=normal>2820</span>
<span class=normal>2821</span>
<span class=normal>2822</span>
<span class=normal>2823</span>
<span class=normal>2824</span>
<span class=normal>2825</span>
<span class=normal>2826</span>
<span class=normal>2827</span>
<span class=normal>2828</span>
<span class=normal>2829</span>
<span class=normal>2830</span>
<span class=normal>2831</span>
<span class=normal>2832</span>
<span class=normal>2833</span>
<span class=normal>2834</span>
<span class=normal>2835</span>
<span class=normal>2836</span>
<span class=normal>2837</span>
<span class=normal>2838</span>
<span class=normal>2839</span>
<span class=normal>2840</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>AYONDistribution</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Distribution control.</span>

<span class=sd>    Receive information from server what addons and dependency packages</span>
<span class=sd>    should be available locally and prepare/validate their distribution.</span>

<span class=sd>    Arguments are available for testing of the class.</span>

<span class=sd>    Args:</span>
<span class=sd>        addon_dirpath (Optional[str]): Where addons will be stored.</span>
<span class=sd>        dependency_dirpath (Optional[str]): Where dependencies will be stored.</span>
<span class=sd>        dist_factory (Optional[DownloadFactory]): Factory which cares about</span>
<span class=sd>            downloading of items based on source type.</span>
<span class=sd>        installers_info (Optional[list[dict[str, Any]]]): List of prepared</span>
<span class=sd>            installers&#39; info.</span>
<span class=sd>        addons_info (Optional[list[dict[str, Any]]]): List of prepared</span>
<span class=sd>            addons&#39; info.</span>
<span class=sd>        dependency_packages_info (Optional[list[dict[str, Any]]]): Info</span>
<span class=sd>            about packages from server.</span>
<span class=sd>        bundles_info (Optional[dict[str, Any]]): Info about</span>
<span class=sd>            bundles.</span>
<span class=sd>        studio_bundle_name (Optional[str]): Name of studio bundle to use.</span>
<span class=sd>        project_bundle_name (Optional[str]): Name of project bundle to use.</span>
<span class=sd>        project_name (Optional[str]): Name of project for which project bundle</span>
<span class=sd>            can be auto-detected.</span>
<span class=sd>        use_staging (Optional[bool]): Use staging versions of an addon.</span>
<span class=sd>            If not passed, &#39;is_staging_enabled&#39; is used as default value.</span>
<span class=sd>        use_dev (Optional[bool]): Use develop versions of an addon.</span>
<span class=sd>            If not passed, &#39;is_dev_mode_enabled&#39; is used as default value.</span>
<span class=sd>        skip_installer_dist (bool): Skip installer distribution. This</span>
<span class=sd>            is for testing purposes and for running from code.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>addon_dirpath</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>dependency_dirpath</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>dist_factory</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>DownloadFactory</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>installers_info</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span> <span class=o>=</span> <span class=n>NOT_SET</span><span class=p>,</span>
        <span class=n>addons_info</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span> <span class=o>=</span> <span class=n>NOT_SET</span><span class=p>,</span>
        <span class=n>dependency_packages_info</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span> <span class=o>=</span> <span class=n>NOT_SET</span><span class=p>,</span>
        <span class=n>bundles_info</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]</span> <span class=o>=</span> <span class=n>NOT_SET</span><span class=p>,</span>
        <span class=n>studio_bundle_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>NOT_SET</span><span class=p>,</span>
        <span class=n>project_bundle_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>NOT_SET</span><span class=p>,</span>
        <span class=n>project_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>NOT_SET</span><span class=p>,</span>
        <span class=n>use_staging</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>use_dev</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>active_user</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>skip_installer_dist</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_log</span> <span class=o>=</span> <span class=kc>None</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_dist_started</span> <span class=o>=</span> <span class=kc>False</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_addons_dirpath</span> <span class=o>=</span> <span class=n>addon_dirpath</span> <span class=ow>or</span> <span class=n>get_addons_dir</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dirpath</span> <span class=o>=</span> <span class=n>dependency_dirpath</span> <span class=ow>or</span> <span class=n>get_dependencies_dir</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dist_factory</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>dist_factory</span> <span class=ow>or</span> <span class=n>get_default_download_factory</span><span class=p>()</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=n>studio_bundle_name</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=n>studio_bundle_name</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;AYON_STUDIO_BUNDLE_NAME&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>NOT_SET</span>
            <span class=p>)</span>

        <span class=k>if</span> <span class=n>project_bundle_name</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=n>project_bundle_name</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;AYON_BUNDLE_NAME&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>NOT_SET</span>
            <span class=p>)</span>

        <span class=k>if</span> <span class=n>project_name</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=n>project_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;AYON_PROJECT_NAME&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>NOT_SET</span>

        <span class=c1># Where addon zip files and dependency packages are downloaded</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dist_download_dirs</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dist_unzip_dirs</span> <span class=o>=</span> <span class=p>[]</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_dist_addons_unzip_temp</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_addons_dirpath</span><span class=p>,</span> <span class=s2>&quot;.unzip_temp&quot;</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dist_dep_packages_unzip_temp</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dirpath</span><span class=p>,</span> <span class=s2>&quot;.unzip_temp&quot;</span>
        <span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_installers_info</span> <span class=o>=</span> <span class=n>installers_info</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_items</span> <span class=o>=</span> <span class=n>NOT_SET</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_expected_installer_version</span> <span class=o>=</span> <span class=n>NOT_SET</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_item</span> <span class=o>=</span> <span class=n>NOT_SET</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_executable</span> <span class=o>=</span> <span class=n>NOT_SET</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_skip_installer_dist</span> <span class=o>=</span> <span class=n>skip_installer_dist</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_filepath</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span> <span class=o>=</span> <span class=kc>None</span>

        <span class=c1># Raw addons data from server</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_addons_info</span> <span class=o>=</span> <span class=n>addons_info</span>
        <span class=c1># Prepared data as Addon objects</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_addon_items</span> <span class=o>=</span> <span class=n>NOT_SET</span>
        <span class=c1># Distrubtion items of addons</span>
        <span class=c1>#   - only those addons and versions that should be distributed</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_addon_dist_items</span> <span class=o>=</span> <span class=n>NOT_SET</span>

        <span class=c1># Raw dependency packages data from server</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_packages_info</span> <span class=o>=</span> <span class=n>dependency_packages_info</span>
        <span class=c1># Prepared dependency packages as objects</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_packages_items</span> <span class=o>=</span> <span class=n>NOT_SET</span>
        <span class=c1># Dependency package item that should be used</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_package_item</span> <span class=o>=</span> <span class=n>NOT_SET</span>
        <span class=c1># Distribution item of dependency package</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dist_item</span> <span class=o>=</span> <span class=n>NOT_SET</span>

        <span class=c1># Raw bundles data from server</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_bundles_info</span> <span class=o>=</span> <span class=n>bundles_info</span>
        <span class=c1># Bundles as objects</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_bundle_items</span> <span class=o>=</span> <span class=n>NOT_SET</span>

        <span class=c1># Bundle that should be used in production</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_studio_production_bundle</span> <span class=o>=</span> <span class=n>NOT_SET</span>
        <span class=c1># Bundle that should be used in staging</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_studio_staging_bundle</span> <span class=o>=</span> <span class=n>NOT_SET</span>
        <span class=c1># Bundle that should be used in dev</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_studio_dev_bundle</span> <span class=o>=</span> <span class=n>NOT_SET</span>
        <span class=c1># Boolean that defines if staging bundle should be used</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_use_staging</span> <span class=o>=</span> <span class=n>use_staging</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_use_dev</span> <span class=o>=</span> <span class=n>use_dev</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_active_user</span> <span class=o>=</span> <span class=n>active_user</span>

        <span class=c1># Specific bundle name should be used</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle_name</span> <span class=o>=</span> <span class=n>studio_bundle_name</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle_name</span> <span class=o>=</span> <span class=n>project_bundle_name</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_project_name</span> <span class=o>=</span> <span class=n>project_name</span>

        <span class=c1># Final bundles that will be used</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle</span> <span class=o>=</span> <span class=n>NOT_SET</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle</span> <span class=o>=</span> <span class=n>NOT_SET</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>active_user</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_active_user</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>user</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get_user</span><span class=p>()</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_active_user</span> <span class=o>=</span> <span class=n>user</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_active_user</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>use_staging</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Staging version of a bundle should be used.</span>

<span class=sd>        This value is completely ignored if specific bundle name should</span>
<span class=sd>            be used.</span>

<span class=sd>        Returns:</span>
<span class=sd>            bool: True if staging version should be used.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_use_staging</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_use_staging</span> <span class=o>=</span> <span class=n>is_staging_enabled</span><span class=p>()</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_use_staging</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>use_dev</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_use_staging</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_use_staging</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>use_dev</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Develop version of a bundle should be used.</span>

<span class=sd>        This value is completely ignored if specific bundle name should</span>
<span class=sd>            be used.</span>

<span class=sd>        Returns:</span>
<span class=sd>            bool: True if staging version should be used.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_use_dev</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle_name</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_use_dev</span> <span class=o>=</span> <span class=n>is_dev_mode_enabled</span><span class=p>()</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>bundle</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
                    <span class=p>(</span>
                        <span class=n>bundle</span>
                        <span class=k>for</span> <span class=n>bundle</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>bundle_items</span>
                        <span class=k>if</span> <span class=n>bundle</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle_name</span>
                    <span class=p>),</span>
                    <span class=kc>None</span>
                <span class=p>)</span>
                <span class=k>if</span> <span class=n>bundle</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_use_dev</span> <span class=o>=</span> <span class=n>bundle</span><span class=o>.</span><span class=n>is_dev</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_use_dev</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_use_dev</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>log</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>logging</span><span class=o>.</span><span class=n>Logger</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Helper to access logger.</span>

<span class=sd>        Returns:</span>
<span class=sd>             logging.Logger: Logger instance.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_log</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_log</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_log</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>bundles_info</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>

<span class=sd>        Returns:</span>
<span class=sd>            list[dict[str, Any]]: Bundles information from server.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_bundles_info</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_bundles_info</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get_bundles</span><span class=p>()[</span><span class=s2>&quot;bundles&quot;</span><span class=p>]</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_bundles_info</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>bundle_items</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=n>Bundle</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>

<span class=sd>        Returns:</span>
<span class=sd>            list[Bundle]: List of bundles info.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_bundle_items</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_bundle_items</span> <span class=o>=</span> <span class=p>[</span>
                <span class=n>Bundle</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span><span class=n>info</span><span class=p>)</span>
                <span class=k>for</span> <span class=n>info</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>bundles_info</span>
            <span class=p>]</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_bundle_items</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>studio_production_bundle</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Bundle</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[Bundle]: Bundle that should be used in production.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_production_bundle</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_bundles</span><span class=p>()</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_production_bundle</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>studio_staging_bundle</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Bundle</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[Bundle]: Bundle that should be used in staging.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_staging_bundle</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_bundles</span><span class=p>()</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_staging_bundle</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>studio_dev_bundle</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Bundle</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[Bundle]: Bundle that should be used in dev.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_dev_bundle</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_bundles</span><span class=p>()</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_dev_bundle</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>studio_bundle_to_use</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Bundle</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[Bundle]: Bundle that should be used in distribution.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle</span> <span class=ow>is</span> <span class=ow>not</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_bundles</span><span class=p>()</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle_name</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>use_staging</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>studio_staging_bundle</span>
            <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>use_dev</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>studio_dev_bundle</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>studio_production_bundle</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle</span>

        <span class=n>bundle</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
            <span class=p>(</span>
                <span class=n>bundle</span>
                <span class=k>for</span> <span class=n>bundle</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>bundle_items</span>
                <span class=k>if</span> <span class=n>bundle</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle_name</span>
            <span class=p>),</span>
            <span class=kc>None</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>bundle</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>BundleNotFoundError</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle_name</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle</span> <span class=o>=</span> <span class=n>bundle</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_studio_bundle</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>project_bundle_to_use</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Bundle</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Bundle that will be used for distribution.</span>

<span class=sd>        Bundle that should be used can be affected by &#39;project_bundle_name&#39;,</span>
<span class=sd>            &#39;project_name&#39;, &#39;studio_bundle_name&#39; or &#39;use_staging&#39;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[Bundle]: Bundle that will be used for distribution</span>
<span class=sd>                or None.</span>

<span class=sd>        Raises:</span>
<span class=sd>            BundleNotFoundError: When bundle name to use is defined</span>
<span class=sd>                but is not available on server.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle</span><span class=p>:</span>
            <span class=n>project_bundle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_project_bundle</span><span class=p>()</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>project_bundle</span><span class=p>:</span>
                <span class=n>project_bundle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>studio_bundle_to_use</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle</span> <span class=o>=</span> <span class=n>project_bundle</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>project_bundle_name_to_use</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Name of bundle that will be used for distribution.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[str]: Name of bundle that will be used for</span>
<span class=sd>                distribution.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>bundle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>project_bundle_to_use</span>
        <span class=k>return</span> <span class=kc>None</span> <span class=k>if</span> <span class=n>bundle</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>bundle</span><span class=o>.</span><span class=n>name</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>installers_info</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Installers information from server.</span>

<span class=sd>        Returns:</span>
<span class=sd>            list[dict[str, Any]]: Installers information from server.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installers_info</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_installers_info</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get_installers</span><span class=p>()[</span><span class=s2>&quot;installers&quot;</span><span class=p>]</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installers_info</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>installer_items</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=n>Installer</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Installers as objects.</span>

<span class=sd>        Returns:</span>
<span class=sd>            list[Installer]: List of installers info from server.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installer_items</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_installer_items</span> <span class=o>=</span> <span class=p>[</span>
                <span class=n>Installer</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span><span class=n>info</span><span class=p>)</span>
                <span class=k>for</span> <span class=n>info</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>installers_info</span>
            <span class=p>]</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installer_items</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>expected_installer_version</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Excepted installer version.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[str]: Expected installer version or None defined by</span>
<span class=sd>                bundle that should be used.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_expected_installer_version</span> <span class=ow>is</span> <span class=ow>not</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_expected_installer_version</span>

        <span class=n>bundle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>project_bundle_to_use</span>
        <span class=n>version</span> <span class=o>=</span> <span class=kc>None</span> <span class=k>if</span> <span class=n>bundle</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>bundle</span><span class=o>.</span><span class=n>installer_version</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_expected_installer_version</span> <span class=o>=</span> <span class=n>version</span>
        <span class=k>return</span> <span class=n>version</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>need_installer_change</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Installer should be changed.</span>

<span class=sd>        Current installer is using different version than what is expected</span>
<span class=sd>            by bundle.</span>

<span class=sd>        Returns:</span>
<span class=sd>            bool: True if installer should be changed.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_skip_installer_dist</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>False</span>

        <span class=n>version</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;AYON_VERSION&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>version</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>expected_installer_version</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>need_installer_distribution</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Installer distribution is needed.</span>

<span class=sd>        Todos:</span>
<span class=sd>            Add option to skip if running from code?</span>

<span class=sd>        Returns:</span>
<span class=sd>            bool: True if installer distribution is needed.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>need_installer_change</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>False</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>installer_executable</span> <span class=ow>is</span> <span class=kc>None</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>installer_dist_error</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Installer distribution error message.</span>

<span class=sd>        Returns:</span>
<span class=sd>              Optional[str]: Error that happened during installer</span>
<span class=sd>                distribution.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>installer_filepath</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Path to a distribution package/installer.</span>

<span class=sd>        This can be used as reference for user where to find downloaded</span>
<span class=sd>            installer on disk and distribute it manually.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[str]: Path to installer.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installer_filepath</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>installer_executable</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Path to installer executable that should be used.</span>

<span class=sd>        Notes:</span>
<span class=sd>            The &#39;installer_executable&#39; is maybe confusing naming. It might be</span>
<span class=sd>                called &#39;ayon_executable&#39;?</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[str]: Path to installer executable that should be</span>
<span class=sd>                used. None if executable is not found and must be distributed</span>
<span class=sd>                or bundle does not have defined an installer to use.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installer_executable</span> <span class=ow>is</span> <span class=ow>not</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installer_executable</span>

        <span class=n>path</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>need_installer_change</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_installer_executable</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>executable</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installer_executable</span>

        <span class=c1># Compare existing executable with current executable</span>
        <span class=n>current_executable</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>executable</span>
        <span class=c1># Use &#39;ayon.exe&#39; for executable lookup on Windows</span>
        <span class=n>root</span><span class=p>,</span> <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>current_executable</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>filename</span> <span class=o>==</span> <span class=s2>&quot;ayon_console.exe&quot;</span><span class=p>:</span>
            <span class=n>current_executable</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=s2>&quot;ayon.exe&quot;</span><span class=p>)</span>

        <span class=c1># TODO look to expected target install directory too</span>
        <span class=n>executables_info</span> <span class=o>=</span> <span class=n>get_executables_info_by_version</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>expected_installer_version</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>executable_info</span> <span class=ow>in</span> <span class=n>executables_info</span><span class=p>:</span>
            <span class=n>executable_path</span> <span class=o>=</span> <span class=n>executable_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;executable&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=p>(</span>
                <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>executable_path</span><span class=p>)</span>
                <span class=ow>or</span> <span class=n>executable_path</span> <span class=o>==</span> <span class=n>current_executable</span>
            <span class=p>):</span>
                <span class=k>continue</span>
            <span class=n>path</span> <span class=o>=</span> <span class=n>executable_path</span>
            <span class=k>break</span>

        <span class=c1># Make sure current executable filename is used on Windows</span>
        <span class=k>if</span> <span class=n>path</span> <span class=ow>and</span> <span class=n>filename</span> <span class=o>==</span> <span class=s2>&quot;ayon_console.exe&quot;</span><span class=p>:</span>
            <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>path</span><span class=p>),</span> <span class=n>filename</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>path</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_installer_executable</span> <span class=o>=</span> <span class=n>path</span>
            <span class=k>return</span> <span class=n>path</span>

        <span class=c1># Guess based on &quot;expected&quot; path of the version</span>
        <span class=c1># - is used if the AYON is already installed at target location but is</span>
        <span class=c1>#   missing in the metadata file</span>
        <span class=n>current_version</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;AYON_VERSION&quot;</span><span class=p>]</span>
        <span class=n>platform_name</span> <span class=o>=</span> <span class=n>platform</span><span class=o>.</span><span class=n>system</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>platform_name</span> <span class=ow>in</span> <span class=p>{</span><span class=s2>&quot;windows&quot;</span><span class=p>,</span> <span class=s2>&quot;linux&quot;</span><span class=p>}:</span>
            <span class=n>executable_dir</span><span class=p>,</span> <span class=n>exe_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>executable</span><span class=p>)</span>
            <span class=n>install_root</span><span class=p>,</span> <span class=n>dirname</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>executable_dir</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>current_version</span> <span class=ow>in</span> <span class=n>dirname</span><span class=p>:</span>
                <span class=n>new_dirname</span> <span class=o>=</span> <span class=n>dirname</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span>
                    <span class=n>current_version</span><span class=p>,</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>expected_installer_version</span>
                <span class=p>)</span>
                <span class=n>executable</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                    <span class=n>install_root</span><span class=p>,</span> <span class=n>new_dirname</span><span class=p>,</span> <span class=n>exe_name</span>
                <span class=p>)</span>
                <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>executable</span><span class=p>):</span>
                    <span class=n>path</span> <span class=o>=</span> <span class=n>executable</span>

        <span class=k>elif</span> <span class=n>platform_name</span> <span class=o>==</span> <span class=s2>&quot;darwin&quot;</span><span class=p>:</span>
            <span class=n>app_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;AYON </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>expected_installer_version</span><span class=si>}</span><span class=s2>.app&quot;</span>
            <span class=n>excutable</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;/Applications/</span><span class=si>{</span><span class=n>app_name</span><span class=si>}</span><span class=s2>/Contents/MacOS/ayon&quot;</span>
            <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>excutable</span><span class=p>):</span>
                <span class=n>path</span> <span class=o>=</span> <span class=n>excutable</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_executable</span> <span class=o>=</span> <span class=n>path</span>
        <span class=k>return</span> <span class=n>path</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>installer_item</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Installer item that should be used for distribution.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Union[Installer, None]: Installer information item.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installer_item</span> <span class=ow>is</span> <span class=ow>not</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installer_item</span>

        <span class=n>final_item</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>expected_version</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>expected_installer_version</span>
        <span class=k>if</span> <span class=n>expected_version</span><span class=p>:</span>
            <span class=n>final_item</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
                <span class=p>(</span>
                    <span class=n>item</span>
                    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>installer_items</span>
                    <span class=k>if</span> <span class=p>(</span>
                        <span class=n>item</span><span class=o>.</span><span class=n>version</span> <span class=o>==</span> <span class=n>expected_version</span>
                        <span class=ow>and</span> <span class=n>item</span><span class=o>.</span><span class=n>platform_name</span> <span class=o>==</span> <span class=n>platform</span><span class=o>.</span><span class=n>system</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
                    <span class=p>)</span>
                <span class=p>),</span>
                <span class=kc>None</span>
            <span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_item</span> <span class=o>=</span> <span class=n>final_item</span>
        <span class=k>return</span> <span class=n>final_item</span>

    <span class=k>def</span><span class=w> </span><span class=nf>distribute_installer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Distribute installer.&quot;&quot;&quot;</span>

        <span class=n>installer_item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>installer_item</span>
        <span class=k>if</span> <span class=n>installer_item</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_installer_executable</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span> <span class=o>=</span> <span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot;Bundle &#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>project_bundle_name_to_use</span><span class=si>}</span><span class=s2>&#39;&quot;</span>
                <span class=s2>&quot; does not have set installer version to use.&quot;</span>
            <span class=p>)</span>
            <span class=k>return</span>

        <span class=n>downloader_data</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;installer&quot;</span><span class=p>,</span>
            <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>installer_item</span><span class=o>.</span><span class=n>version</span><span class=p>,</span>
            <span class=s2>&quot;filename&quot;</span><span class=p>:</span> <span class=n>installer_item</span><span class=o>.</span><span class=n>filename</span><span class=p>,</span>
        <span class=p>}</span>

        <span class=n>tmp_used</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=n>downloads_dir</span> <span class=o>=</span> <span class=n>get_downloads_dir</span><span class=p>()</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>downloads_dir</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>downloads_dir</span><span class=p>):</span>
            <span class=n>tmp_used</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=n>downloads_dir</span> <span class=o>=</span> <span class=n>tempfile</span><span class=o>.</span><span class=n>mkdtemp</span><span class=p>(</span><span class=n>prefix</span><span class=o>=</span><span class=s2>&quot;ayon_installer&quot;</span><span class=p>)</span>
            <span class=n>change_permissions_recursive</span><span class=p>(</span><span class=n>downloads_dir</span><span class=p>)</span>

        <span class=n>dist_item</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>dist_item</span> <span class=o>=</span> <span class=n>InstallerDistributionItem</span><span class=p>(</span>
                <span class=n>tmp_used</span><span class=p>,</span>
                <span class=n>downloads_dir</span><span class=p>,</span>
                <span class=n>UpdateState</span><span class=o>.</span><span class=n>OUTDATED</span><span class=p>,</span>
                <span class=n>installer_item</span><span class=o>.</span><span class=n>checksum</span><span class=p>,</span>
                <span class=n>installer_item</span><span class=o>.</span><span class=n>checksum_algorithm</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_dist_factory</span><span class=p>,</span>
                <span class=nb>list</span><span class=p>(</span><span class=n>installer_item</span><span class=o>.</span><span class=n>sources</span><span class=p>),</span>
                <span class=n>downloader_data</span><span class=p>,</span>
                <span class=sa>f</span><span class=s2>&quot;Installer </span><span class=si>{</span><span class=n>installer_item</span><span class=o>.</span><span class=n>version</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
            <span class=p>)</span>

            <span class=k>if</span> <span class=p>(</span>
                <span class=n>platform</span><span class=o>.</span><span class=n>system</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>!=</span> <span class=s2>&quot;windows&quot;</span>
                <span class=ow>and</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>is_missing_permissions</span>
            <span class=p>):</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;Your user does not have required permissions to update&quot;</span>
                    <span class=s2>&quot; AYON launcher.&quot;</span>
                    <span class=s2>&quot; Please contact your administrator, or use user&quot;</span>
                    <span class=s2>&quot; with permissions.&quot;</span>
                <span class=p>)</span>
                <span class=k>return</span>

            <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>distribute</span><span class=p>():</span>
                <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
                    <span class=k>break</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>_installer_executable</span> <span class=o>=</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>executable</span>
            <span class=k>if</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>installer_error</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span> <span class=o>=</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>installer_error</span>

            <span class=k>elif</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>MISS_SOURCE_FILES</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;Couldn&#39;t find valid installer source for required&quot;</span>
                    <span class=sa>f</span><span class=s2>&quot; AYON launcher version </span><span class=si>{</span><span class=n>installer_item</span><span class=o>.</span><span class=n>version</span><span class=si>}</span><span class=s2>.&quot;</span>
                <span class=p>)</span>

            <span class=k>elif</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installer_executable</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;Couldn&#39;t find installed AYON launcher.&quot;</span>
                    <span class=s2>&quot; Please try to launch AYON manually.&quot;</span>
                <span class=p>)</span>

        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                <span class=s2>&quot;Installer distribution failed do to unknown reasons.&quot;</span><span class=p>,</span>
                <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
            <span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span> <span class=o>=</span> <span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot;Distribution of AYON launcher </span><span class=si>{</span><span class=n>installer_item</span><span class=o>.</span><span class=n>version</span><span class=si>}</span><span class=s2>&quot;</span>
                <span class=s2>&quot; failed with unexpected reason.&quot;</span>
            <span class=p>)</span>

        <span class=k>finally</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>dist_item</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_installer_filepath</span> <span class=o>=</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>installer_path</span>

            <span class=k>if</span> <span class=n>tmp_used</span> <span class=ow>and</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>downloads_dir</span><span class=p>):</span>
                <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=n>downloads_dir</span><span class=p>)</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>addons_info</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Server information about available addons.</span>

<span class=sd>        Returns:</span>
<span class=sd>            dict[str, dict[str, Any]]: Addon info by addon name.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_addons_info</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=c1># Use details to get information about client.zip</span>
            <span class=n>server_info</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get_addons_info</span><span class=p>(</span><span class=n>details</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_addons_info</span> <span class=o>=</span> <span class=n>server_info</span><span class=p>[</span><span class=s2>&quot;addons&quot;</span><span class=p>]</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_addons_info</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>addon_items</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>AddonInfo</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Information about available addons on server.</span>

<span class=sd>        Addons may require distribution of files. For those addons will be</span>
<span class=sd>        created &#39;DistributionItem&#39; handling distribution itself.</span>

<span class=sd>        Returns:</span>
<span class=sd>            dict[str, AddonInfo]: Addon info object by addon name.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_addon_items</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=n>addons_info</span> <span class=o>=</span> <span class=p>{}</span>
            <span class=k>for</span> <span class=n>addon</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>addons_info</span><span class=p>:</span>
                <span class=n>addon_info</span> <span class=o>=</span> <span class=n>AddonInfo</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span><span class=n>addon</span><span class=p>)</span>
                <span class=n>addons_info</span><span class=p>[</span><span class=n>addon_info</span><span class=o>.</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>addon_info</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_addon_items</span> <span class=o>=</span> <span class=n>addons_info</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_addon_items</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>dependency_packages_info</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Server information about available dependency packages.</span>

<span class=sd>        Notes:</span>
<span class=sd>            For testing purposes it is possible to pass dependency packages</span>
<span class=sd>                information to &#39;__init__&#39;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            list[dict[str, Any]]: Dependency packages information.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_packages_info</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_packages_info</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>ayon_api</span><span class=o>.</span><span class=n>get_dependency_packages</span><span class=p>())[</span><span class=s2>&quot;packages&quot;</span><span class=p>]</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_packages_info</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>dependency_packages_items</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>DependencyItem</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Dependency packages as objects.</span>

<span class=sd>        Returns:</span>
<span class=sd>            dict[str, DependencyItem]: Dependency packages as objects by name.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_packages_items</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=n>dependenc_package_items</span> <span class=o>=</span> <span class=p>{}</span>
            <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>dependency_packages_info</span><span class=p>:</span>
                <span class=n>item</span> <span class=o>=</span> <span class=n>DependencyItem</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
                <span class=n>dependenc_package_items</span><span class=p>[</span><span class=n>item</span><span class=o>.</span><span class=n>filename</span><span class=p>]</span> <span class=o>=</span> <span class=n>item</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_packages_items</span> <span class=o>=</span> <span class=n>dependenc_package_items</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_packages_items</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>dependency_package_item</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>DependencyItem</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Dependency package item that should be used by bundle.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[DependencyItem]: None if bundle does not have</span>
<span class=sd>                specified dependency package.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_package_item</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=n>dependency_package_item</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=n>bundle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>project_bundle_to_use</span>
            <span class=k>if</span> <span class=n>bundle</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=n>package_name</span> <span class=o>=</span> <span class=n>bundle</span><span class=o>.</span><span class=n>dependency_packages</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
                    <span class=n>platform</span><span class=o>.</span><span class=n>system</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
                <span class=p>)</span>
                <span class=n>dependency_package_item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dependency_packages_items</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
                    <span class=n>package_name</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_package_item</span> <span class=o>=</span> <span class=n>dependency_package_item</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_package_item</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_addon_dist_items</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Addon distribution items.</span>

<span class=sd>        These items describe source files required by addon to be available on</span>
<span class=sd>        machine. Each item may have 0-n source information from where can be</span>
<span class=sd>        obtained. If file is already available it&#39;s state will be &#39;UPDATED&#39;.</span>

<span class=sd>        Example output:</span>
<span class=sd>            [</span>
<span class=sd>                {</span>
<span class=sd>                    &quot;dist_item&quot;: DistributionItem,</span>
<span class=sd>                    &quot;addon_name&quot;: str,</span>
<span class=sd>                    &quot;addon_version&quot;: str,</span>
<span class=sd>                    &quot;addon_item&quot;: AddonInfo,</span>
<span class=sd>                    &quot;addon_version_item&quot;: AddonVersionInfo</span>
<span class=sd>                }, {</span>
<span class=sd>                    ...</span>
<span class=sd>                }</span>
<span class=sd>            ]</span>

<span class=sd>        Returns:</span>
<span class=sd>             list[dict[str, Any]]: Distribution items with addon version item.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_addon_dist_items</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_addon_dist_items</span> <span class=o>=</span> <span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_current_addon_dist_items</span><span class=p>())</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_addon_dist_items</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_dependency_dist_item</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>DistributionItem</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Dependency package distribution item.</span>

<span class=sd>        Item describe source files required by server to be available on</span>
<span class=sd>        machine. Item may have 0-n source information from where can be</span>
<span class=sd>        obtained. If file is already available it&#39;s state will be &#39;UPDATED&#39;.</span>

<span class=sd>        &#39;None&#39; is returned if server does not have defined any dependency</span>
<span class=sd>        package.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[DistributionItem]: Dependency item or None if server</span>
<span class=sd>                does not have specified any dependency package.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dist_item</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dist_item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_dependency_progress</span><span class=p>()</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dist_item</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_dependency_metadata_filepath</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Path to distribution metadata file.</span>

<span class=sd>        Metadata contain information about distributed packages, used source,</span>
<span class=sd>        expected file hash and time when file was distributed.</span>

<span class=sd>        Returns:</span>
<span class=sd>            str: Path to a file where dependency package metadata are stored.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dirpath</span><span class=p>,</span> <span class=s2>&quot;dependency.json&quot;</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_addons_metadata_filepath</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Path to addons metadata file.</span>

<span class=sd>        Metadata contain information about distributed addons, used sources,</span>
<span class=sd>        expected file hashes and time when files were distributed.</span>

<span class=sd>        Returns:</span>
<span class=sd>            str: Path to a file where addons metadata are stored.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_addons_dirpath</span><span class=p>,</span> <span class=s2>&quot;addons.json&quot;</span><span class=p>)</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>read_metadata_file</span><span class=p>(</span>
        <span class=n>filepath</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>default_value</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Read json file from path.</span>

<span class=sd>        Method creates the file when does not exist with default value.</span>

<span class=sd>        Args:</span>
<span class=sd>            filepath (str): Path to json file.</span>
<span class=sd>            default_value (Union[Dict[str, Any], List[Any], None]): Default</span>
<span class=sd>                value if the file is not available (or valid).</span>

<span class=sd>        Returns:</span>
<span class=sd>            Union[Dict[str, Any], List[Any]]: Value from file.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>if</span> <span class=n>default_value</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>default_value</span> <span class=o>=</span> <span class=p>{}</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>filepath</span><span class=p>):</span>
            <span class=k>return</span> <span class=n>default_value</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>stream</span><span class=p>:</span>
                <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>stream</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
            <span class=n>data</span> <span class=o>=</span> <span class=n>default_value</span>
        <span class=k>return</span> <span class=n>data</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>save_metadata_file</span><span class=p>(</span><span class=n>filepath</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Store data to json file.</span>

<span class=sd>        Method creates the file when does not exist.</span>

<span class=sd>        Args:</span>
<span class=sd>            filepath (str): Path to json file.</span>
<span class=sd>            data (dict[str, Any]): Data to store into file.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>dirpath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>filepath</span><span class=p>)</span>
        <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>dirpath</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>stream</span><span class=p>:</span>
            <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>stream</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
        <span class=n>change_permissions_recursive</span><span class=p>(</span><span class=n>dirpath</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_dependency_metadata</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
        <span class=n>filepath</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_metadata_filepath</span><span class=p>()</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_metadata_file</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=p>{})</span>

    <span class=k>def</span><span class=w> </span><span class=nf>update_dependency_metadata</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>package_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
    <span class=p>):</span>
        <span class=n>dependency_metadata</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_metadata</span><span class=p>()</span>
        <span class=n>dependency_metadata</span><span class=p>[</span><span class=n>package_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span>
        <span class=n>filepath</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_metadata_filepath</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>save_metadata_file</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=n>dependency_metadata</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_addons_metadata</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
        <span class=n>filepath</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_addons_metadata_filepath</span><span class=p>()</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_metadata_file</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=p>{})</span>

    <span class=k>def</span><span class=w> </span><span class=nf>update_addons_metadata</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>addons_information</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>addons_information</span><span class=p>:</span>
            <span class=k>return</span>
        <span class=n>addons_metadata</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_addons_metadata</span><span class=p>()</span>
        <span class=k>for</span> <span class=n>addon_name</span><span class=p>,</span> <span class=n>version_value</span> <span class=ow>in</span> <span class=n>addons_information</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=k>if</span> <span class=n>addon_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>addons_metadata</span><span class=p>:</span>
                <span class=n>addons_metadata</span><span class=p>[</span><span class=n>addon_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
            <span class=k>for</span> <span class=n>addon_version</span><span class=p>,</span> <span class=n>version_data</span> <span class=ow>in</span> <span class=n>version_value</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
                <span class=n>addons_metadata</span><span class=p>[</span><span class=n>addon_name</span><span class=p>][</span><span class=n>addon_version</span><span class=p>]</span> <span class=o>=</span> <span class=n>version_data</span>

        <span class=n>filepath</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_addons_metadata_filepath</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>save_metadata_file</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=n>addons_metadata</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>finish_distribution</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Store metadata about distributed items.&quot;&quot;&quot;</span>
        <span class=k>for</span> <span class=n>tmp_dir</span> <span class=ow>in</span> <span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_dist_download_dirs</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dist_unzip_dirs</span>
        <span class=p>):</span>
            <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>tmp_dir</span><span class=p>):</span>
                <span class=k>try</span><span class=p>:</span>
                    <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=n>tmp_dir</span><span class=p>)</span>
                <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
                    <span class=k>pass</span>

        <span class=n>stored_time</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2> %H:%M:%S&quot;</span><span class=p>)</span>
        <span class=c1># TODO store dependencies info inside dependencies folder instead</span>
        <span class=c1>#   of having one file</span>
        <span class=c1># - the file can be used to track progress and find out if other</span>
        <span class=c1>#   process is already working on distribution</span>
        <span class=n>dependency_dist_item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_dist_item</span><span class=p>()</span>
        <span class=k>if</span> <span class=p>(</span>
            <span class=n>dependency_dist_item</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
            <span class=ow>and</span> <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>need_distribution</span>
            <span class=ow>and</span> <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
        <span class=p>):</span>
            <span class=n>package</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dependency_package_item</span>
            <span class=n>source</span> <span class=o>=</span> <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>used_source</span>
            <span class=k>if</span> <span class=n>source</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
                    <span class=s2>&quot;source&quot;</span><span class=p>:</span> <span class=n>source</span><span class=p>,</span>
                    <span class=s2>&quot;checksum&quot;</span><span class=p>:</span> <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>checksum</span><span class=p>,</span>
                    <span class=s2>&quot;checksum_algorithm&quot;</span><span class=p>:</span> <span class=p>(</span>
                        <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>checksum_algorithm</span><span class=p>),</span>
                    <span class=s2>&quot;distributed_dt&quot;</span><span class=p>:</span> <span class=n>stored_time</span>
                <span class=p>}</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>update_dependency_metadata</span><span class=p>(</span><span class=n>package</span><span class=o>.</span><span class=n>filename</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>

        <span class=c1># TODO store addon info inside addon folder instead of having one</span>
        <span class=c1>#   of having one file</span>
        <span class=c1># - the file can be used to track progress and find out if other</span>
        <span class=c1>#   process is already working on distribution</span>
        <span class=n>addons_info</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_addon_dist_items</span><span class=p>():</span>
            <span class=n>dist_item</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&quot;dist_item&quot;</span><span class=p>]</span>
            <span class=k>if</span> <span class=p>(</span>
                <span class=ow>not</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>need_distribution</span>
                <span class=ow>or</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>state</span> <span class=o>!=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
            <span class=p>):</span>
                <span class=k>continue</span>

            <span class=n>source_data</span> <span class=o>=</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>used_source</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>source_data</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=n>addon_name</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&quot;addon_name&quot;</span><span class=p>]</span>
            <span class=n>addon_version</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&quot;addon_version&quot;</span><span class=p>]</span>
            <span class=n>addons_info</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>addon_name</span><span class=p>,</span> <span class=p>{})</span>
            <span class=n>addons_info</span><span class=p>[</span><span class=n>addon_name</span><span class=p>][</span><span class=n>addon_version</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
                <span class=s2>&quot;source&quot;</span><span class=p>:</span> <span class=n>source_data</span><span class=p>,</span>
                <span class=s2>&quot;checksum&quot;</span><span class=p>:</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>checksum</span><span class=p>,</span>
                <span class=s2>&quot;checksum_algorithm&quot;</span><span class=p>:</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>checksum_algorithm</span><span class=p>,</span>
                <span class=s2>&quot;distributed_dt&quot;</span><span class=p>:</span> <span class=n>stored_time</span>
            <span class=p>}</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>update_addons_metadata</span><span class=p>(</span><span class=n>addons_info</span><span class=p>)</span>

        <span class=n>_cleanup_dist_download_dirs</span><span class=p>()</span>
        <span class=n>_cleanup_dist_expire_dirs</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_dist_addons_unzip_temp</span><span class=p>)</span>
        <span class=n>_cleanup_dist_expire_dirs</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_dist_dep_packages_unzip_temp</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_all_distribution_items</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=n>DistributionItem</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Distribution items required by server.</span>

<span class=sd>        Items contain dependency package item and all addons that are enabled</span>
<span class=sd>        and have distribution requirements.</span>

<span class=sd>        Items can be already available on machine.</span>

<span class=sd>        Returns:</span>
<span class=sd>            list[DistributionItem]: Distribution items required by server.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>output</span> <span class=o>=</span> <span class=p>[</span>
            <span class=n>item</span><span class=p>[</span><span class=s2>&quot;dist_item&quot;</span><span class=p>]</span>
            <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_addon_dist_items</span><span class=p>()</span>
        <span class=p>]</span>
        <span class=n>dependency_dist_item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_dist_item</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>dependency_dist_item</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>output</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>dependency_dist_item</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>output</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>need_distribution</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Distribution is needed.</span>

<span class=sd>        Returns:</span>
<span class=sd>            bool: True if any distribution is needed.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>need_installer_change</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>need_installer_distribution</span><span class=p>:</span>
                <span class=k>return</span> <span class=kc>True</span>
            <span class=k>return</span> <span class=kc>False</span>

        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_all_distribution_items</span><span class=p>():</span>
            <span class=k>if</span> <span class=n>item</span><span class=o>.</span><span class=n>need_distribution</span><span class=p>:</span>
                <span class=k>return</span> <span class=kc>True</span>
        <span class=k>return</span> <span class=kc>False</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>is_missing_permissions</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=c1># Do not validate installer (launcher) distribution as that is</span>
        <span class=c1>#   reported with &#39;_installer_dist_error&#39;</span>
        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_all_distribution_items</span><span class=p>():</span>
            <span class=k>if</span> <span class=n>item</span><span class=o>.</span><span class=n>need_distribution</span> <span class=ow>and</span> <span class=n>item</span><span class=o>.</span><span class=n>is_missing_permissions</span><span class=p>:</span>
                <span class=k>return</span> <span class=kc>True</span>
        <span class=k>return</span> <span class=kc>False</span>

    <span class=k>def</span><span class=w> </span><span class=nf>distribute</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Distribute all missing items.</span>

<span class=sd>        Method will try to distribute all items that are required by server.</span>

<span class=sd>        This method does not handle failed items. To validate the result call</span>
<span class=sd>        &#39;validate_distribution&#39; when this method finishes.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dist_started</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&quot;Distribution already started&quot;</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dist_started</span> <span class=o>=</span> <span class=kc>True</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>need_installer_change</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>need_installer_distribution</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>distribute_installer</span><span class=p>()</span>
            <span class=k>return</span>

        <span class=n>dist_items</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>dist_item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_all_distribution_items</span><span class=p>():</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>is_distributed</span><span class=p>():</span>
                <span class=n>dist_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>dist_item</span><span class=p>)</span>
                <span class=n>_create_dist_expire_file</span><span class=p>(</span><span class=n>dist_item</span><span class=o>.</span><span class=n>download_dirpath</span><span class=p>)</span>

        <span class=n>running_items</span> <span class=o>=</span> <span class=n>collections</span><span class=o>.</span><span class=n>deque</span><span class=p>()</span>
        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>dist_items</span><span class=p>:</span>
            <span class=n>running_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>item</span><span class=o>.</span><span class=n>distribute</span><span class=p>())</span>

        <span class=k>if</span> <span class=n>running_items</span><span class=p>:</span>
            <span class=n>running_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=k>while</span> <span class=n>running_items</span><span class=p>:</span>
                <span class=n>running_item</span> <span class=o>=</span> <span class=n>running_items</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span>
                <span class=k>if</span> <span class=n>running_item</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                    <span class=k>if</span> <span class=n>running_items</span><span class=p>:</span>
                        <span class=n>running_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
                        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.02</span><span class=p>)</span>
                    <span class=k>continue</span>

                <span class=k>if</span> <span class=ow>not</span> <span class=nb>next</span><span class=p>(</span><span class=n>running_item</span><span class=p>):</span>
                    <span class=n>running_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>running_item</span><span class=p>)</span>

        <span class=k>finally</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>finish_distribution</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>validate_distribution</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Check if all required distribution items are distributed.</span>

<span class=sd>        Raises:</span>
<span class=sd>            RuntimeError: Any of items is not available.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>invalid</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>dependency_package</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_dist_item</span><span class=p>()</span>
        <span class=k>if</span> <span class=p>(</span>
            <span class=n>dependency_package</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
            <span class=ow>and</span> <span class=n>dependency_package</span><span class=o>.</span><span class=n>state</span> <span class=o>!=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
        <span class=p>):</span>
            <span class=n>invalid</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;Dependency package&quot;</span><span class=p>)</span>

        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_addon_dist_items</span><span class=p>():</span>
            <span class=n>dist_item</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&quot;dist_item&quot;</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>state</span> <span class=o>!=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span><span class=p>:</span>
                <span class=n>invalid</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s2>&quot;addon_name&quot;</span><span class=p>])</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>invalid</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&quot;Failed to distribute </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=s2>&quot;, &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=sa>f</span><span class=s1>&#39;&quot;</span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s1>&quot;&#39;</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>invalid</span><span class=p>])</span>
        <span class=p>))</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_sys_paths</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Get all paths to python packages that should be added to path.</span>

<span class=sd>        These packages will be added only to &#39;sys.path&#39; and not into</span>
<span class=sd>        &#39;PYTHONPATH&#39;, so they won&#39;t be available in subprocesses.</span>

<span class=sd>        Todos:</span>
<span class=sd>            This is not yet implemented. The goal is that dependency</span>
<span class=sd>                package will contain also &#39;build&#39; python</span>
<span class=sd>                dependencies (OpenTimelineIO, Pillow, etc.).</span>

<span class=sd>        Returns:</span>
<span class=sd>            list[str]: Paths that should be added to &#39;sys.path&#39;.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>output</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>dependency_dist_item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_dist_item</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>dependency_dist_item</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>runtime_dir</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=n>target_dirpath</span> <span class=o>=</span> <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>target_dirpath</span>
            <span class=k>if</span> <span class=n>target_dirpath</span><span class=p>:</span>
                <span class=n>runtime_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>target_dirpath</span><span class=p>,</span> <span class=s2>&quot;runtime&quot;</span><span class=p>)</span>

            <span class=k>if</span> <span class=n>runtime_dir</span> <span class=ow>and</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>runtime_dir</span><span class=p>):</span>
                <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>runtime_dir</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>output</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_python_paths</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Get all paths to python packages that should be added to python.</span>

<span class=sd>        These paths lead to addon directories and python dependencies in</span>
<span class=sd>        dependency package.</span>

<span class=sd>        Returns:</span>
<span class=sd>            List[str]: Paths that should be added to &#39;sys.path&#39; and</span>
<span class=sd>                &#39;PYTHONPATH&#39;.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>output</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_addon_dist_items</span><span class=p>():</span>
            <span class=n>dist_item</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&quot;dist_item&quot;</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>state</span> <span class=o>!=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span><span class=p>:</span>
                <span class=k>continue</span>
            <span class=n>target_dirpath</span> <span class=o>=</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>target_dirpath</span>
            <span class=k>if</span> <span class=n>target_dirpath</span> <span class=ow>and</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>target_dirpath</span><span class=p>):</span>
                <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>target_dirpath</span><span class=p>)</span>

        <span class=n>output</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_get_dev_sys_paths</span><span class=p>())</span>

        <span class=n>dependency_dist_item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_dist_item</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>dependency_dist_item</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>dependencies_dir</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=n>target_dirpath</span> <span class=o>=</span> <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>target_dirpath</span>
            <span class=k>if</span> <span class=n>target_dirpath</span><span class=p>:</span>
                <span class=n>dependencies_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>target_dirpath</span><span class=p>,</span> <span class=s2>&quot;dependencies&quot;</span><span class=p>)</span>

            <span class=k>if</span> <span class=n>dependencies_dir</span> <span class=ow>and</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>dependencies_dir</span><span class=p>):</span>
                <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>dependencies_dir</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>output</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_dev_sys_paths</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
        <span class=n>output</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>use_dev</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>output</span>

        <span class=n>addon_versions</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=n>dev_addons</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=n>bundle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>project_bundle_to_use</span>
        <span class=k>if</span> <span class=n>bundle</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>dev_addons</span> <span class=o>=</span> <span class=n>bundle</span><span class=o>.</span><span class=n>addons_dev_info</span>
            <span class=n>addon_versions</span> <span class=o>=</span> <span class=n>bundle</span><span class=o>.</span><span class=n>addon_versions</span>

        <span class=k>for</span> <span class=n>addon_name</span><span class=p>,</span> <span class=n>_</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>addon_items</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=n>addon_version</span> <span class=o>=</span> <span class=n>addon_versions</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>addon_name</span><span class=p>)</span>
            <span class=c1># Addon is not in bundle -&gt; Skip</span>
            <span class=k>if</span> <span class=n>addon_version</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=n>dev_addon_info</span> <span class=o>=</span> <span class=n>dev_addons</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>addon_name</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>dev_addon_info</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>dev_addon_info</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
                <span class=k>try</span><span class=p>:</span>
                    <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
                        <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>expandvars</span><span class=p>(</span><span class=n>dev_addon_info</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>format_map</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>))</span>
                    <span class=p>)</span>
                <span class=k>except</span> <span class=p>(</span><span class=ne>KeyError</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>):</span>
                    <span class=n>msg</span> <span class=o>=</span> <span class=p>(</span>
                        <span class=sa>f</span><span class=s2>&quot;Failed to format path &#39;</span><span class=si>{</span><span class=n>dev_addon_info</span><span class=o>.</span><span class=n>path</span><span class=si>}</span><span class=s2>&#39;&quot;</span>
                        <span class=sa>f</span><span class=s2>&quot; for addon &#39;</span><span class=si>{</span><span class=n>addon_name</span><span class=si>}</span><span class=s2>&#39;.&quot;</span>
                    <span class=p>)</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
                    <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>output</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_prepare_bundles</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>studio_production_bundle</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>studio_staging_bundle</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>studio_dev_bundle</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>for</span> <span class=n>bundle</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>bundle_items</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>bundle</span><span class=o>.</span><span class=n>is_project_bundle</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=k>if</span> <span class=n>bundle</span><span class=o>.</span><span class=n>is_production</span><span class=p>:</span>
                <span class=n>studio_production_bundle</span> <span class=o>=</span> <span class=n>bundle</span>
            <span class=k>if</span> <span class=n>bundle</span><span class=o>.</span><span class=n>is_staging</span><span class=p>:</span>
                <span class=n>studio_staging_bundle</span> <span class=o>=</span> <span class=n>bundle</span>
            <span class=k>if</span> <span class=n>bundle</span><span class=o>.</span><span class=n>is_dev</span> <span class=ow>and</span> <span class=n>bundle</span><span class=o>.</span><span class=n>active_dev_user</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_user</span><span class=p>:</span>
                <span class=n>studio_dev_bundle</span> <span class=o>=</span> <span class=n>bundle</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_studio_production_bundle</span> <span class=o>=</span> <span class=n>studio_production_bundle</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_studio_staging_bundle</span> <span class=o>=</span> <span class=n>studio_staging_bundle</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_studio_dev_bundle</span> <span class=o>=</span> <span class=n>studio_dev_bundle</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_prepare_current_addon_dist_items</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
        <span class=n>addons_metadata</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_addons_metadata</span><span class=p>()</span>
        <span class=n>output</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>addon_versions</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=n>dev_addons</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=n>bundle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>project_bundle_to_use</span>
        <span class=k>if</span> <span class=n>bundle</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>dev_addons</span> <span class=o>=</span> <span class=n>bundle</span><span class=o>.</span><span class=n>addons_dev_info</span>
            <span class=n>addon_versions</span> <span class=o>=</span> <span class=n>bundle</span><span class=o>.</span><span class=n>addon_versions</span>

        <span class=n>unzip_temp</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_addons_dirpath</span><span class=p>,</span> <span class=s2>&quot;.unzip_temp&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>unzip_temp</span><span class=p>):</span>
            <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>unzip_temp</span><span class=p>)</span>
            <span class=n>change_permissions_recursive</span><span class=p>(</span><span class=n>unzip_temp</span><span class=p>)</span>

        <span class=k>for</span> <span class=n>addon_name</span><span class=p>,</span> <span class=n>addon_item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>addon_items</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
            <span class=c1># Dev mode can redirect addon directory elsewhere</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>use_dev</span><span class=p>:</span>
                <span class=n>dev_addon_info</span> <span class=o>=</span> <span class=n>dev_addons</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>addon_name</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>dev_addon_info</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>dev_addon_info</span><span class=o>.</span><span class=n>enabled</span><span class=p>:</span>
                    <span class=k>continue</span>

            <span class=n>addon_version</span> <span class=o>=</span> <span class=n>addon_versions</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>addon_name</span><span class=p>)</span>
            <span class=c1># Addon is not in bundle -&gt; Skip</span>
            <span class=k>if</span> <span class=n>addon_version</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=n>addon_version_item</span> <span class=o>=</span> <span class=n>addon_item</span><span class=o>.</span><span class=n>versions</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>addon_version</span><span class=p>)</span>
            <span class=c1># Addon version is not available in addons info</span>
            <span class=c1># - TODO handle this case (raise error, skip, store, report, ...)</span>
            <span class=k>if</span> <span class=n>addon_version_item</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=nb>print</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>&quot;Version &#39;</span><span class=si>{</span><span class=n>addon_version</span><span class=si>}</span><span class=s2>&#39; of addon &#39;</span><span class=si>{</span><span class=n>addon_name</span><span class=si>}</span><span class=s2>&#39;&quot;</span>
                    <span class=s2>&quot; is not available on server.&quot;</span>
                <span class=p>)</span>
                <span class=k>continue</span>

            <span class=k>if</span> <span class=ow>not</span> <span class=n>addon_version_item</span><span class=o>.</span><span class=n>require_distribution</span><span class=p>:</span>
                <span class=k>continue</span>
            <span class=n>full_name</span> <span class=o>=</span> <span class=n>addon_version_item</span><span class=o>.</span><span class=n>full_name</span>
            <span class=n>addon_dest</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_addons_dirpath</span><span class=p>,</span> <span class=n>full_name</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Checking </span><span class=si>{</span><span class=n>full_name</span><span class=si>}</span><span class=s2> in </span><span class=si>{</span><span class=n>addon_dest</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
            <span class=n>progress_info</span> <span class=o>=</span> <span class=n>_read_progress_file</span><span class=p>(</span><span class=n>addon_dest</span><span class=p>)</span>
            <span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>OUTDATED</span>
            <span class=k>if</span> <span class=n>progress_info</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>progress_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;state&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=n>DistFileStates</span><span class=o>.</span><span class=n>done</span><span class=o>.</span><span class=n>value</span><span class=p>:</span>
                    <span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>addon_in_metadata</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>addon_name</span> <span class=ow>in</span> <span class=n>addons_metadata</span>
                    <span class=ow>and</span> <span class=n>addon_version_item</span><span class=o>.</span><span class=n>version</span> <span class=ow>in</span> <span class=p>(</span>
                        <span class=n>addons_metadata</span><span class=p>[</span><span class=n>addon_name</span><span class=p>]</span>
                    <span class=p>)</span>
                <span class=p>)</span>
                <span class=k>if</span> <span class=n>addon_in_metadata</span> <span class=ow>and</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isdir</span><span class=p>(</span><span class=n>addon_dest</span><span class=p>):</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span>
                        <span class=sa>f</span><span class=s2>&quot;Addon version folder </span><span class=si>{</span><span class=n>addon_dest</span><span class=si>}</span><span class=s2> already exists.&quot;</span>
                    <span class=p>)</span>
                    <span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
                    <span class=c1># Auto-create addons dist file extracted with old versions</span>
                    <span class=n>_create_progress_file</span><span class=p>(</span>
                        <span class=n>addon_dest</span><span class=p>,</span>
                        <span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span><span class=p>,</span>
                        <span class=n>addon_version_item</span><span class=o>.</span><span class=n>checksum</span><span class=p>,</span>
                        <span class=n>addon_version_item</span><span class=o>.</span><span class=n>checksum_algorithm</span><span class=p>,</span>
                    <span class=p>)</span>

            <span class=n>download_dir</span> <span class=o>=</span> <span class=n>_get_dist_download_dir</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span><span class=p>)</span>
            <span class=n>unzip_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>unzip_temp</span><span class=p>,</span> <span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_dist_download_dirs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>download_dir</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_dist_unzip_dirs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>unzip_dir</span><span class=p>)</span>
            <span class=n>downloader_data</span> <span class=o>=</span> <span class=p>{</span>
                <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;addon&quot;</span><span class=p>,</span>
                <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>addon_name</span><span class=p>,</span>
                <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>addon_version</span>
            <span class=p>}</span>
            <span class=n>dist_item</span> <span class=o>=</span> <span class=n>DistributionItem</span><span class=p>(</span>
                <span class=n>addon_dest</span><span class=p>,</span>
                <span class=n>unzip_dir</span><span class=p>,</span>
                <span class=n>download_dirpath</span><span class=o>=</span><span class=n>download_dir</span><span class=p>,</span>
                <span class=n>state</span><span class=o>=</span><span class=n>state</span><span class=p>,</span>
                <span class=n>checksum</span><span class=o>=</span><span class=n>addon_version_item</span><span class=o>.</span><span class=n>checksum</span><span class=p>,</span>
                <span class=n>checksum_algorithm</span><span class=o>=</span><span class=n>addon_version_item</span><span class=o>.</span><span class=n>checksum_algorithm</span><span class=p>,</span>
                <span class=n>factory</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_dist_factory</span><span class=p>,</span>
                <span class=n>sources</span><span class=o>=</span><span class=nb>list</span><span class=p>(</span><span class=n>addon_version_item</span><span class=o>.</span><span class=n>sources</span><span class=p>),</span>
                <span class=n>downloader_data</span><span class=o>=</span><span class=n>downloader_data</span><span class=p>,</span>
                <span class=n>item_label</span><span class=o>=</span><span class=n>full_name</span><span class=p>,</span>
                <span class=n>progress_dir</span><span class=o>=</span><span class=n>addon_dest</span><span class=p>,</span>
                <span class=n>logger</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>log</span>
            <span class=p>)</span>
            <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
                <span class=s2>&quot;dist_item&quot;</span><span class=p>:</span> <span class=n>dist_item</span><span class=p>,</span>
                <span class=s2>&quot;addon_name&quot;</span><span class=p>:</span> <span class=n>addon_name</span><span class=p>,</span>
                <span class=s2>&quot;addon_version&quot;</span><span class=p>:</span> <span class=n>addon_version</span><span class=p>,</span>
                <span class=s2>&quot;addon_item&quot;</span><span class=p>:</span> <span class=n>addon_item</span><span class=p>,</span>
                <span class=s2>&quot;addon_version_item&quot;</span><span class=p>:</span> <span class=n>addon_version_item</span><span class=p>,</span>
            <span class=p>})</span>
        <span class=k>return</span> <span class=n>output</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_prepare_dependency_progress</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>DistributionItem</span><span class=p>]:</span>
        <span class=n>package</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dependency_package_item</span>
        <span class=k>if</span> <span class=n>package</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>None</span>

        <span class=n>metadata</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_metadata</span><span class=p>()</span>
        <span class=n>downloader_data</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;dependency_package&quot;</span><span class=p>,</span>
            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>package</span><span class=o>.</span><span class=n>filename</span><span class=p>,</span>
            <span class=s2>&quot;platform&quot;</span><span class=p>:</span> <span class=n>package</span><span class=o>.</span><span class=n>platform_name</span>
        <span class=p>}</span>
        <span class=n>package_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dirpath</span><span class=p>,</span> <span class=n>package</span><span class=o>.</span><span class=n>filename</span>
        <span class=p>)</span>
        <span class=c1># Future compatibility for dependency packages without .zip in dirname</span>
        <span class=n>new_basename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>package</span><span class=o>.</span><span class=n>filename</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
        <span class=n>new_package_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dirpath</span><span class=p>,</span> <span class=n>new_basename</span><span class=p>)</span>

        <span class=n>download_dir</span> <span class=o>=</span> <span class=n>_get_dist_download_dir</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span><span class=p>)</span>
        <span class=n>unzip_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dirpath</span><span class=p>,</span> <span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dist_download_dirs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>download_dir</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dist_unzip_dirs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>unzip_dir</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Checking </span><span class=si>{</span><span class=n>package</span><span class=o>.</span><span class=n>filename</span><span class=si>}</span><span class=s2> in </span><span class=si>{</span><span class=n>package_dir</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
        <span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>OUTDATED</span>
        <span class=n>progress_info</span> <span class=o>=</span> <span class=n>_read_progress_file</span><span class=p>(</span><span class=n>package_dir</span><span class=p>)</span>
        <span class=n>new_progress_info</span> <span class=o>=</span> <span class=n>_read_progress_file</span><span class=p>(</span><span class=n>new_package_dir</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>progress_info</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>progress_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;state&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=n>DistFileStates</span><span class=o>.</span><span class=n>done</span><span class=o>.</span><span class=n>value</span><span class=p>:</span>
                <span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>

        <span class=k>elif</span> <span class=n>new_progress_info</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>new_progress_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;state&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=n>DistFileStates</span><span class=o>.</span><span class=n>done</span><span class=o>.</span><span class=n>value</span><span class=p>:</span>
                <span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
                <span class=n>package_dir</span> <span class=o>=</span> <span class=n>new_package_dir</span>

        <span class=k>elif</span> <span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isdir</span><span class=p>(</span><span class=n>package_dir</span><span class=p>)</span>
            <span class=ow>and</span> <span class=n>package</span><span class=o>.</span><span class=n>filename</span> <span class=ow>in</span> <span class=n>metadata</span>
        <span class=p>):</span>
            <span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
            <span class=c1># Autofix dependency packages extracted with old versions</span>
            <span class=n>_create_progress_file</span><span class=p>(</span>
                <span class=n>package_dir</span><span class=p>,</span>
                <span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span><span class=p>,</span>
                <span class=n>package</span><span class=o>.</span><span class=n>checksum</span><span class=p>,</span>
                <span class=n>package</span><span class=o>.</span><span class=n>checksum_algorithm</span><span class=p>,</span>
            <span class=p>)</span>

        <span class=k>return</span> <span class=n>DistributionItem</span><span class=p>(</span>
            <span class=n>package_dir</span><span class=p>,</span>
            <span class=n>unzip_dir</span><span class=p>,</span>
            <span class=n>download_dirpath</span><span class=o>=</span><span class=n>download_dir</span><span class=p>,</span>
            <span class=n>state</span><span class=o>=</span><span class=n>state</span><span class=p>,</span>
            <span class=n>checksum</span><span class=o>=</span><span class=n>package</span><span class=o>.</span><span class=n>checksum</span><span class=p>,</span>
            <span class=n>checksum_algorithm</span><span class=o>=</span><span class=n>package</span><span class=o>.</span><span class=n>checksum_algorithm</span><span class=p>,</span>
            <span class=n>factory</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_dist_factory</span><span class=p>,</span>
            <span class=n>sources</span><span class=o>=</span><span class=n>package</span><span class=o>.</span><span class=n>sources</span><span class=p>,</span>
            <span class=n>downloader_data</span><span class=o>=</span><span class=n>downloader_data</span><span class=p>,</span>
            <span class=n>item_label</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>package</span><span class=o>.</span><span class=n>filename</span><span class=p>)[</span><span class=mi>0</span><span class=p>],</span>
            <span class=n>progress_dir</span><span class=o>=</span><span class=n>package_dir</span><span class=p>,</span>
            <span class=n>logger</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>,</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_project_bundle</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Bundle</span><span class=p>]:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle</span> <span class=ow>is</span> <span class=ow>not</span> <span class=n>NOT_SET</span><span class=p>:</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>studio_bundle_to_use</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=k>return</span> <span class=kc>None</span>

        <span class=c1># Project bundle is set and is same as studio bundle</span>
        <span class=n>studio_bundle_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>studio_bundle_to_use</span><span class=o>.</span><span class=n>name</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle_name</span> <span class=o>==</span> <span class=n>studio_bundle_name</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=k>return</span> <span class=kc>None</span>

        <span class=k>if</span> <span class=p>(</span>
            <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle_name</span>
            <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>_project_name</span> <span class=ow>is</span> <span class=ow>not</span> <span class=n>NOT_SET</span>
        <span class=p>):</span>
            <span class=n>project</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get_project</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_project_name</span><span class=p>)</span>
            <span class=n>project_bundles</span> <span class=o>=</span> <span class=n>project</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;bundle&quot;</span><span class=p>,</span> <span class=p>{})</span>
            <span class=n>bundle_name</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>use_staging</span><span class=p>:</span>
                <span class=n>bundle_name</span> <span class=o>=</span> <span class=n>project_bundles</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;staging&quot;</span><span class=p>)</span>
            <span class=k>elif</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>use_dev</span><span class=p>:</span>
                <span class=n>bundle_name</span> <span class=o>=</span> <span class=n>project_bundles</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;production&quot;</span><span class=p>)</span>

            <span class=k>if</span> <span class=n>bundle_name</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle_name</span> <span class=o>=</span> <span class=n>bundle_name</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle_name</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=k>return</span> <span class=kc>None</span>

        <span class=n>bundle</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
            <span class=p>(</span>
                <span class=n>bundle</span>
                <span class=k>for</span> <span class=n>bundle</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>bundle_items</span>
                <span class=k>if</span> <span class=n>bundle</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle_name</span>
            <span class=p>),</span>
            <span class=kc>None</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>bundle</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>BundleNotFoundError</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle_name</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>studio_bundle_name</span><span class=p>:</span>
            <span class=n>key_values</span> <span class=o>=</span> <span class=p>{</span>
                <span class=s2>&quot;summary&quot;</span><span class=p>:</span> <span class=s2>&quot;true&quot;</span><span class=p>,</span>
                <span class=s2>&quot;bundle&quot;</span><span class=p>:</span> <span class=n>studio_bundle_name</span><span class=p>,</span>
            <span class=p>}</span>
            <span class=n>query</span> <span class=o>=</span> <span class=n>urlencode</span><span class=p>(</span><span class=n>key_values</span><span class=p>)</span>
            <span class=n>response</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;settings?</span><span class=si>{</span><span class=n>query</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
            <span class=c1># NOTE This does modify the bundle data</span>
            <span class=c1># - should be fine as it really does fill up the project bundle</span>
            <span class=k>for</span> <span class=n>addon</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;addons&quot;</span><span class=p>]:</span>
                <span class=n>addon_name</span> <span class=o>=</span> <span class=n>addon</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
                <span class=n>addon_version</span> <span class=o>=</span> <span class=n>addon</span><span class=p>[</span><span class=s2>&quot;version&quot;</span><span class=p>]</span>
                <span class=n>bundle</span><span class=o>.</span><span class=n>addon_versions</span><span class=p>[</span><span class=n>addon_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>addon_version</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_project_bundle</span> <span class=o>=</span> <span class=n>bundle</span>
        <span class=k>return</span> <span class=n>bundle</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.addon_items class="doc doc-heading"> <code class="highlight language-python"><span class=n>addon_items</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Information about available addons on server.</p> <p>Addons may require distribution of files. For those addons will be created 'DistributionItem' handling distribution itself.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <a class="autorefs autorefs-internal" title="AddonInfo


  
      dataclass
   (common.ayon_common.distribution.data_structures.AddonInfo)" href=data_structures.html#common.ayon_common.distribution.data_structures.AddonInfo>AddonInfo</a>]</code> </td> <td> <div class=doc-md-description> <p>dict[str, AddonInfo]: Addon info object by addon name.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.addons_info class="doc doc-heading"> <code class="highlight language-python"><span class=n>addons_info</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Server information about available addons.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=dict>dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>dict[str, dict[str, Any]]: Addon info by addon name.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.bundle_items class="doc doc-heading"> <code class="highlight language-python"><span class=n>bundle_items</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=list>list</span>[<a class="autorefs autorefs-internal" title="Bundle


  
      dataclass
   (common.ayon_common.distribution.data_structures.Bundle)" href=data_structures.html#common.ayon_common.distribution.data_structures.Bundle>Bundle</a>]</code> </td> <td> <div class=doc-md-description> <p>list[Bundle]: List of bundles info.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.bundles_info class="doc doc-heading"> <code class="highlight language-python"><span class=n>bundles_info</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=list>list</span>[<span title=dict>dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>list[dict[str, Any]]: Bundles information from server.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.dependency_package_item class="doc doc-heading"> <code class="highlight language-python"><span class=n>dependency_package_item</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Dependency package item that should be used by bundle.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<a class="autorefs autorefs-internal" title="DependencyItem


  
      dataclass
   (common.ayon_common.distribution.data_structures.DependencyItem)" href=data_structures.html#common.ayon_common.distribution.data_structures.DependencyItem>DependencyItem</a>]</code> </td> <td> <div class=doc-md-description> <p>Optional[DependencyItem]: None if bundle does not have specified dependency package.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.dependency_packages_info class="doc doc-heading"> <code class="highlight language-python"><span class=n>dependency_packages_info</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Server information about available dependency packages.</p> <details class=notes open> <summary>Notes</summary> <p>For testing purposes it is possible to pass dependency packages information to '<strong>init</strong>'.</p> </details> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=list>list</span>[<span title=dict>dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>list[dict[str, Any]]: Dependency packages information.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.dependency_packages_items class="doc doc-heading"> <code class="highlight language-python"><span class=n>dependency_packages_items</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Dependency packages as objects.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <a class="autorefs autorefs-internal" title="DependencyItem


  
      dataclass
   (common.ayon_common.distribution.data_structures.DependencyItem)" href=data_structures.html#common.ayon_common.distribution.data_structures.DependencyItem>DependencyItem</a>]</code> </td> <td> <div class=doc-md-description> <p>dict[str, DependencyItem]: Dependency packages as objects by name.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.expected_installer_version class="doc doc-heading"> <code class="highlight language-python"><span class=n>expected_installer_version</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Excepted installer version.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Optional[str]: Expected installer version or None defined by bundle that should be used.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.installer_dist_error class="doc doc-heading"> <code class="highlight language-python"><span class=n>installer_dist_error</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Installer distribution error message.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Optional[str]: Error that happened during installer distribution.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.installer_executable class="doc doc-heading"> <code class="highlight language-python"><span class=n>installer_executable</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Path to installer executable that should be used.</p> <details class=notes open> <summary>Notes</summary> <p>The 'installer_executable' is maybe confusing naming. It might be called 'ayon_executable'?</p> </details> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Optional[str]: Path to installer executable that should be used. None if executable is not found and must be distributed or bundle does not have defined an installer to use.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.installer_filepath class="doc doc-heading"> <code class="highlight language-python"><span class=n>installer_filepath</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Path to a distribution package/installer.</p> <p>This can be used as reference for user where to find downloaded installer on disk and distribute it manually.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Optional[str]: Path to installer.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.installer_item class="doc doc-heading"> <code class="highlight language-python"><span class=n>installer_item</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Installer item that should be used for distribution.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> </td> <td> <div class=doc-md-description> <p>Union[Installer, None]: Installer information item.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.installer_items class="doc doc-heading"> <code class="highlight language-python"><span class=n>installer_items</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Installers as objects.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=list>list</span>[<span title=common.ayon_common.distribution.data_structures.Installer>Installer</span>]</code> </td> <td> <div class=doc-md-description> <p>list[Installer]: List of installers info from server.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.installers_info class="doc doc-heading"> <code class="highlight language-python"><span class=n>installers_info</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Installers information from server.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=list>list</span>[<span title=dict>dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>list[dict[str, Any]]: Installers information from server.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.log class="doc doc-heading"> <code class="highlight language-python"><span class=n>log</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Helper to access logger.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=logging.Logger>Logger</span></code> </td> <td> <div class=doc-md-description> <p>logging.Logger: Logger instance.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.need_distribution class="doc doc-heading"> <code class="highlight language-python"><span class=n>need_distribution</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Distribution is needed.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>bool</code></td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>True if any distribution is needed.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.need_installer_change class="doc doc-heading"> <code class="highlight language-python"><span class=n>need_installer_change</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Installer should be changed.</p> <p>Current installer is using different version than what is expected by bundle.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>bool</code></td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>True if installer should be changed.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.need_installer_distribution class="doc doc-heading"> <code class="highlight language-python"><span class=n>need_installer_distribution</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Installer distribution is needed.</p> <details class=todos open> <summary>Todos</summary> <p>Add option to skip if running from code?</p> </details> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>bool</code></td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>True if installer distribution is needed.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.project_bundle_name_to_use class="doc doc-heading"> <code class="highlight language-python"><span class=n>project_bundle_name_to_use</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Name of bundle that will be used for distribution.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Optional[str]: Name of bundle that will be used for distribution.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.project_bundle_to_use class="doc doc-heading"> <code class="highlight language-python"><span class=n>project_bundle_to_use</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Bundle that will be used for distribution.</p> <p>Bundle that should be used can be affected by 'project_bundle_name', 'project_name', 'studio_bundle_name' or 'use_staging'.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<a class="autorefs autorefs-internal" title="Bundle


  
      dataclass
   (common.ayon_common.distribution.data_structures.Bundle)" href=data_structures.html#common.ayon_common.distribution.data_structures.Bundle>Bundle</a>]</code> </td> <td> <div class=doc-md-description> <p>Optional[Bundle]: Bundle that will be used for distribution or None.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" title="BundleNotFoundError (common.ayon_common.distribution.exceptions.BundleNotFoundError)" href=exceptions.html#common.ayon_common.distribution.exceptions.BundleNotFoundError>BundleNotFoundError</a></code> </td> <td> <div class=doc-md-description> <p>When bundle name to use is defined but is not available on server.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.studio_bundle_to_use class="doc doc-heading"> <code class="highlight language-python"><span class=n>studio_bundle_to_use</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<a class="autorefs autorefs-internal" title="Bundle


  
      dataclass
   (common.ayon_common.distribution.data_structures.Bundle)" href=data_structures.html#common.ayon_common.distribution.data_structures.Bundle>Bundle</a>]</code> </td> <td> <div class=doc-md-description> <p>Optional[Bundle]: Bundle that should be used in distribution.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.studio_dev_bundle class="doc doc-heading"> <code class="highlight language-python"><span class=n>studio_dev_bundle</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<a class="autorefs autorefs-internal" title="Bundle


  
      dataclass
   (common.ayon_common.distribution.data_structures.Bundle)" href=data_structures.html#common.ayon_common.distribution.data_structures.Bundle>Bundle</a>]</code> </td> <td> <div class=doc-md-description> <p>Optional[Bundle]: Bundle that should be used in dev.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.studio_production_bundle class="doc doc-heading"> <code class="highlight language-python"><span class=n>studio_production_bundle</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<a class="autorefs autorefs-internal" title="Bundle


  
      dataclass
   (common.ayon_common.distribution.data_structures.Bundle)" href=data_structures.html#common.ayon_common.distribution.data_structures.Bundle>Bundle</a>]</code> </td> <td> <div class=doc-md-description> <p>Optional[Bundle]: Bundle that should be used in production.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.studio_staging_bundle class="doc doc-heading"> <code class="highlight language-python"><span class=n>studio_staging_bundle</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<a class="autorefs autorefs-internal" title="Bundle


  
      dataclass
   (common.ayon_common.distribution.data_structures.Bundle)" href=data_structures.html#common.ayon_common.distribution.data_structures.Bundle>Bundle</a>]</code> </td> <td> <div class=doc-md-description> <p>Optional[Bundle]: Bundle that should be used in staging.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.use_dev class="doc doc-heading"> <code class="highlight language-python"><span class=n>use_dev</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Develop version of a bundle should be used.</p> <p>This value is completely ignored if specific bundle name should be used.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>bool</code></td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>True if staging version should be used.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.use_staging class="doc doc-heading"> <code class="highlight language-python"><span class=n>use_staging</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Staging version of a bundle should be used.</p> <p>This value is completely ignored if specific bundle name should be used.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>bool</code></td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>True if staging version should be used.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.distribute class="doc doc-heading"> <code class="highlight language-python"><span class=n>distribute</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Distribute all missing items.</p> <p>Method will try to distribute all items that are required by server.</p> <p>This method does not handle failed items. To validate the result call 'validate_distribution' when this method finishes.</p> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2432</span>
<span class=normal>2433</span>
<span class=normal>2434</span>
<span class=normal>2435</span>
<span class=normal>2436</span>
<span class=normal>2437</span>
<span class=normal>2438</span>
<span class=normal>2439</span>
<span class=normal>2440</span>
<span class=normal>2441</span>
<span class=normal>2442</span>
<span class=normal>2443</span>
<span class=normal>2444</span>
<span class=normal>2445</span>
<span class=normal>2446</span>
<span class=normal>2447</span>
<span class=normal>2448</span>
<span class=normal>2449</span>
<span class=normal>2450</span>
<span class=normal>2451</span>
<span class=normal>2452</span>
<span class=normal>2453</span>
<span class=normal>2454</span>
<span class=normal>2455</span>
<span class=normal>2456</span>
<span class=normal>2457</span>
<span class=normal>2458</span>
<span class=normal>2459</span>
<span class=normal>2460</span>
<span class=normal>2461</span>
<span class=normal>2462</span>
<span class=normal>2463</span>
<span class=normal>2464</span>
<span class=normal>2465</span>
<span class=normal>2466</span>
<span class=normal>2467</span>
<span class=normal>2468</span>
<span class=normal>2469</span>
<span class=normal>2470</span>
<span class=normal>2471</span>
<span class=normal>2472</span>
<span class=normal>2473</span>
<span class=normal>2474</span>
<span class=normal>2475</span>
<span class=normal>2476</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>distribute</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Distribute all missing items.</span>

<span class=sd>    Method will try to distribute all items that are required by server.</span>

<span class=sd>    This method does not handle failed items. To validate the result call</span>
<span class=sd>    &#39;validate_distribution&#39; when this method finishes.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dist_started</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&quot;Distribution already started&quot;</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_dist_started</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>need_installer_change</span><span class=p>:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>need_installer_distribution</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>distribute_installer</span><span class=p>()</span>
        <span class=k>return</span>

    <span class=n>dist_items</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>dist_item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_all_distribution_items</span><span class=p>():</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>is_distributed</span><span class=p>():</span>
            <span class=n>dist_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>dist_item</span><span class=p>)</span>
            <span class=n>_create_dist_expire_file</span><span class=p>(</span><span class=n>dist_item</span><span class=o>.</span><span class=n>download_dirpath</span><span class=p>)</span>

    <span class=n>running_items</span> <span class=o>=</span> <span class=n>collections</span><span class=o>.</span><span class=n>deque</span><span class=p>()</span>
    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>dist_items</span><span class=p>:</span>
        <span class=n>running_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>item</span><span class=o>.</span><span class=n>distribute</span><span class=p>())</span>

    <span class=k>if</span> <span class=n>running_items</span><span class=p>:</span>
        <span class=n>running_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>

    <span class=k>try</span><span class=p>:</span>
        <span class=k>while</span> <span class=n>running_items</span><span class=p>:</span>
            <span class=n>running_item</span> <span class=o>=</span> <span class=n>running_items</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span>
            <span class=k>if</span> <span class=n>running_item</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>running_items</span><span class=p>:</span>
                    <span class=n>running_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
                    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.02</span><span class=p>)</span>
                <span class=k>continue</span>

            <span class=k>if</span> <span class=ow>not</span> <span class=nb>next</span><span class=p>(</span><span class=n>running_item</span><span class=p>):</span>
                <span class=n>running_items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>running_item</span><span class=p>)</span>

    <span class=k>finally</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>finish_distribution</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.distribute_installer class="doc doc-heading"> <code class="highlight language-python"><span class=n>distribute_installer</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Distribute installer.</p> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1992</span>
<span class=normal>1993</span>
<span class=normal>1994</span>
<span class=normal>1995</span>
<span class=normal>1996</span>
<span class=normal>1997</span>
<span class=normal>1998</span>
<span class=normal>1999</span>
<span class=normal>2000</span>
<span class=normal>2001</span>
<span class=normal>2002</span>
<span class=normal>2003</span>
<span class=normal>2004</span>
<span class=normal>2005</span>
<span class=normal>2006</span>
<span class=normal>2007</span>
<span class=normal>2008</span>
<span class=normal>2009</span>
<span class=normal>2010</span>
<span class=normal>2011</span>
<span class=normal>2012</span>
<span class=normal>2013</span>
<span class=normal>2014</span>
<span class=normal>2015</span>
<span class=normal>2016</span>
<span class=normal>2017</span>
<span class=normal>2018</span>
<span class=normal>2019</span>
<span class=normal>2020</span>
<span class=normal>2021</span>
<span class=normal>2022</span>
<span class=normal>2023</span>
<span class=normal>2024</span>
<span class=normal>2025</span>
<span class=normal>2026</span>
<span class=normal>2027</span>
<span class=normal>2028</span>
<span class=normal>2029</span>
<span class=normal>2030</span>
<span class=normal>2031</span>
<span class=normal>2032</span>
<span class=normal>2033</span>
<span class=normal>2034</span>
<span class=normal>2035</span>
<span class=normal>2036</span>
<span class=normal>2037</span>
<span class=normal>2038</span>
<span class=normal>2039</span>
<span class=normal>2040</span>
<span class=normal>2041</span>
<span class=normal>2042</span>
<span class=normal>2043</span>
<span class=normal>2044</span>
<span class=normal>2045</span>
<span class=normal>2046</span>
<span class=normal>2047</span>
<span class=normal>2048</span>
<span class=normal>2049</span>
<span class=normal>2050</span>
<span class=normal>2051</span>
<span class=normal>2052</span>
<span class=normal>2053</span>
<span class=normal>2054</span>
<span class=normal>2055</span>
<span class=normal>2056</span>
<span class=normal>2057</span>
<span class=normal>2058</span>
<span class=normal>2059</span>
<span class=normal>2060</span>
<span class=normal>2061</span>
<span class=normal>2062</span>
<span class=normal>2063</span>
<span class=normal>2064</span>
<span class=normal>2065</span>
<span class=normal>2066</span>
<span class=normal>2067</span>
<span class=normal>2068</span>
<span class=normal>2069</span>
<span class=normal>2070</span>
<span class=normal>2071</span>
<span class=normal>2072</span>
<span class=normal>2073</span>
<span class=normal>2074</span>
<span class=normal>2075</span>
<span class=normal>2076</span>
<span class=normal>2077</span>
<span class=normal>2078</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>distribute_installer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Distribute installer.&quot;&quot;&quot;</span>

    <span class=n>installer_item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>installer_item</span>
    <span class=k>if</span> <span class=n>installer_item</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_executable</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span> <span class=o>=</span> <span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;Bundle &#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>project_bundle_name_to_use</span><span class=si>}</span><span class=s2>&#39;&quot;</span>
            <span class=s2>&quot; does not have set installer version to use.&quot;</span>
        <span class=p>)</span>
        <span class=k>return</span>

    <span class=n>downloader_data</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;installer&quot;</span><span class=p>,</span>
        <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>installer_item</span><span class=o>.</span><span class=n>version</span><span class=p>,</span>
        <span class=s2>&quot;filename&quot;</span><span class=p>:</span> <span class=n>installer_item</span><span class=o>.</span><span class=n>filename</span><span class=p>,</span>
    <span class=p>}</span>

    <span class=n>tmp_used</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=n>downloads_dir</span> <span class=o>=</span> <span class=n>get_downloads_dir</span><span class=p>()</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>downloads_dir</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>downloads_dir</span><span class=p>):</span>
        <span class=n>tmp_used</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=n>downloads_dir</span> <span class=o>=</span> <span class=n>tempfile</span><span class=o>.</span><span class=n>mkdtemp</span><span class=p>(</span><span class=n>prefix</span><span class=o>=</span><span class=s2>&quot;ayon_installer&quot;</span><span class=p>)</span>
        <span class=n>change_permissions_recursive</span><span class=p>(</span><span class=n>downloads_dir</span><span class=p>)</span>

    <span class=n>dist_item</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=n>dist_item</span> <span class=o>=</span> <span class=n>InstallerDistributionItem</span><span class=p>(</span>
            <span class=n>tmp_used</span><span class=p>,</span>
            <span class=n>downloads_dir</span><span class=p>,</span>
            <span class=n>UpdateState</span><span class=o>.</span><span class=n>OUTDATED</span><span class=p>,</span>
            <span class=n>installer_item</span><span class=o>.</span><span class=n>checksum</span><span class=p>,</span>
            <span class=n>installer_item</span><span class=o>.</span><span class=n>checksum_algorithm</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_dist_factory</span><span class=p>,</span>
            <span class=nb>list</span><span class=p>(</span><span class=n>installer_item</span><span class=o>.</span><span class=n>sources</span><span class=p>),</span>
            <span class=n>downloader_data</span><span class=p>,</span>
            <span class=sa>f</span><span class=s2>&quot;Installer </span><span class=si>{</span><span class=n>installer_item</span><span class=o>.</span><span class=n>version</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=p>(</span>
            <span class=n>platform</span><span class=o>.</span><span class=n>system</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>!=</span> <span class=s2>&quot;windows&quot;</span>
            <span class=ow>and</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>is_missing_permissions</span>
        <span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span> <span class=o>=</span> <span class=p>(</span>
                <span class=s2>&quot;Your user does not have required permissions to update&quot;</span>
                <span class=s2>&quot; AYON launcher.&quot;</span>
                <span class=s2>&quot; Please contact your administrator, or use user&quot;</span>
                <span class=s2>&quot; with permissions.&quot;</span>
            <span class=p>)</span>
            <span class=k>return</span>

        <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>distribute</span><span class=p>():</span>
            <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
                <span class=k>break</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_executable</span> <span class=o>=</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>executable</span>
        <span class=k>if</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>installer_error</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span> <span class=o>=</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>installer_error</span>

        <span class=k>elif</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>MISS_SOURCE_FILES</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span> <span class=o>=</span> <span class=p>(</span>
                <span class=s2>&quot;Couldn&#39;t find valid installer source for required&quot;</span>
                <span class=sa>f</span><span class=s2>&quot; AYON launcher version </span><span class=si>{</span><span class=n>installer_item</span><span class=o>.</span><span class=n>version</span><span class=si>}</span><span class=s2>.&quot;</span>
            <span class=p>)</span>

        <span class=k>elif</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installer_executable</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span> <span class=o>=</span> <span class=p>(</span>
                <span class=s2>&quot;Couldn&#39;t find installed AYON launcher.&quot;</span>
                <span class=s2>&quot; Please try to launch AYON manually.&quot;</span>
            <span class=p>)</span>

    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
            <span class=s2>&quot;Installer distribution failed do to unknown reasons.&quot;</span><span class=p>,</span>
            <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_dist_error</span> <span class=o>=</span> <span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;Distribution of AYON launcher </span><span class=si>{</span><span class=n>installer_item</span><span class=o>.</span><span class=n>version</span><span class=si>}</span><span class=s2>&quot;</span>
            <span class=s2>&quot; failed with unexpected reason.&quot;</span>
        <span class=p>)</span>

    <span class=k>finally</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>dist_item</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_installer_filepath</span> <span class=o>=</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>installer_path</span>

        <span class=k>if</span> <span class=n>tmp_used</span> <span class=ow>and</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>downloads_dir</span><span class=p>):</span>
            <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=n>downloads_dir</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.finish_distribution class="doc doc-heading"> <code class="highlight language-python"><span class=n>finish_distribution</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Store metadata about distributed items.</p> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2316</span>
<span class=normal>2317</span>
<span class=normal>2318</span>
<span class=normal>2319</span>
<span class=normal>2320</span>
<span class=normal>2321</span>
<span class=normal>2322</span>
<span class=normal>2323</span>
<span class=normal>2324</span>
<span class=normal>2325</span>
<span class=normal>2326</span>
<span class=normal>2327</span>
<span class=normal>2328</span>
<span class=normal>2329</span>
<span class=normal>2330</span>
<span class=normal>2331</span>
<span class=normal>2332</span>
<span class=normal>2333</span>
<span class=normal>2334</span>
<span class=normal>2335</span>
<span class=normal>2336</span>
<span class=normal>2337</span>
<span class=normal>2338</span>
<span class=normal>2339</span>
<span class=normal>2340</span>
<span class=normal>2341</span>
<span class=normal>2342</span>
<span class=normal>2343</span>
<span class=normal>2344</span>
<span class=normal>2345</span>
<span class=normal>2346</span>
<span class=normal>2347</span>
<span class=normal>2348</span>
<span class=normal>2349</span>
<span class=normal>2350</span>
<span class=normal>2351</span>
<span class=normal>2352</span>
<span class=normal>2353</span>
<span class=normal>2354</span>
<span class=normal>2355</span>
<span class=normal>2356</span>
<span class=normal>2357</span>
<span class=normal>2358</span>
<span class=normal>2359</span>
<span class=normal>2360</span>
<span class=normal>2361</span>
<span class=normal>2362</span>
<span class=normal>2363</span>
<span class=normal>2364</span>
<span class=normal>2365</span>
<span class=normal>2366</span>
<span class=normal>2367</span>
<span class=normal>2368</span>
<span class=normal>2369</span>
<span class=normal>2370</span>
<span class=normal>2371</span>
<span class=normal>2372</span>
<span class=normal>2373</span>
<span class=normal>2374</span>
<span class=normal>2375</span>
<span class=normal>2376</span>
<span class=normal>2377</span>
<span class=normal>2378</span>
<span class=normal>2379</span>
<span class=normal>2380</span>
<span class=normal>2381</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>finish_distribution</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Store metadata about distributed items.&quot;&quot;&quot;</span>
    <span class=k>for</span> <span class=n>tmp_dir</span> <span class=ow>in</span> <span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dist_download_dirs</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dist_unzip_dirs</span>
    <span class=p>):</span>
        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>tmp_dir</span><span class=p>):</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=n>tmp_dir</span><span class=p>)</span>
            <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
                <span class=k>pass</span>

    <span class=n>stored_time</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2> %H:%M:%S&quot;</span><span class=p>)</span>
    <span class=c1># TODO store dependencies info inside dependencies folder instead</span>
    <span class=c1>#   of having one file</span>
    <span class=c1># - the file can be used to track progress and find out if other</span>
    <span class=c1>#   process is already working on distribution</span>
    <span class=n>dependency_dist_item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_dist_item</span><span class=p>()</span>
    <span class=k>if</span> <span class=p>(</span>
        <span class=n>dependency_dist_item</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
        <span class=ow>and</span> <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>need_distribution</span>
        <span class=ow>and</span> <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
    <span class=p>):</span>
        <span class=n>package</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dependency_package_item</span>
        <span class=n>source</span> <span class=o>=</span> <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>used_source</span>
        <span class=k>if</span> <span class=n>source</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
                <span class=s2>&quot;source&quot;</span><span class=p>:</span> <span class=n>source</span><span class=p>,</span>
                <span class=s2>&quot;checksum&quot;</span><span class=p>:</span> <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>checksum</span><span class=p>,</span>
                <span class=s2>&quot;checksum_algorithm&quot;</span><span class=p>:</span> <span class=p>(</span>
                    <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>checksum_algorithm</span><span class=p>),</span>
                <span class=s2>&quot;distributed_dt&quot;</span><span class=p>:</span> <span class=n>stored_time</span>
            <span class=p>}</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>update_dependency_metadata</span><span class=p>(</span><span class=n>package</span><span class=o>.</span><span class=n>filename</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>

    <span class=c1># TODO store addon info inside addon folder instead of having one</span>
    <span class=c1>#   of having one file</span>
    <span class=c1># - the file can be used to track progress and find out if other</span>
    <span class=c1>#   process is already working on distribution</span>
    <span class=n>addons_info</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_addon_dist_items</span><span class=p>():</span>
        <span class=n>dist_item</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&quot;dist_item&quot;</span><span class=p>]</span>
        <span class=k>if</span> <span class=p>(</span>
            <span class=ow>not</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>need_distribution</span>
            <span class=ow>or</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>state</span> <span class=o>!=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
        <span class=p>):</span>
            <span class=k>continue</span>

        <span class=n>source_data</span> <span class=o>=</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>used_source</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>source_data</span><span class=p>:</span>
            <span class=k>continue</span>

        <span class=n>addon_name</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&quot;addon_name&quot;</span><span class=p>]</span>
        <span class=n>addon_version</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&quot;addon_version&quot;</span><span class=p>]</span>
        <span class=n>addons_info</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>addon_name</span><span class=p>,</span> <span class=p>{})</span>
        <span class=n>addons_info</span><span class=p>[</span><span class=n>addon_name</span><span class=p>][</span><span class=n>addon_version</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&quot;source&quot;</span><span class=p>:</span> <span class=n>source_data</span><span class=p>,</span>
            <span class=s2>&quot;checksum&quot;</span><span class=p>:</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>checksum</span><span class=p>,</span>
            <span class=s2>&quot;checksum_algorithm&quot;</span><span class=p>:</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>checksum_algorithm</span><span class=p>,</span>
            <span class=s2>&quot;distributed_dt&quot;</span><span class=p>:</span> <span class=n>stored_time</span>
        <span class=p>}</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>update_addons_metadata</span><span class=p>(</span><span class=n>addons_info</span><span class=p>)</span>

    <span class=n>_cleanup_dist_download_dirs</span><span class=p>()</span>
    <span class=n>_cleanup_dist_expire_dirs</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_dist_addons_unzip_temp</span><span class=p>)</span>
    <span class=n>_cleanup_dist_expire_dirs</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_dist_dep_packages_unzip_temp</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.get_addon_dist_items class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_addon_dist_items</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Addon distribution items.</p> <p>These items describe source files required by addon to be available on machine. Each item may have 0-n source information from where can be obtained. If file is already available it's state will be 'UPDATED'.</p> <details class=example-output open> <summary>Example output</summary> <p>[ { "dist_item": DistributionItem, "addon_name": str, "addon_version": str, "addon_item": AddonInfo, "addon_version_item": AddonVersionInfo }, { ... } ]</p> </details> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=list>list</span>[<span title=dict>dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>list[dict[str, Any]]: Distribution items with addon version item.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2167</span>
<span class=normal>2168</span>
<span class=normal>2169</span>
<span class=normal>2170</span>
<span class=normal>2171</span>
<span class=normal>2172</span>
<span class=normal>2173</span>
<span class=normal>2174</span>
<span class=normal>2175</span>
<span class=normal>2176</span>
<span class=normal>2177</span>
<span class=normal>2178</span>
<span class=normal>2179</span>
<span class=normal>2180</span>
<span class=normal>2181</span>
<span class=normal>2182</span>
<span class=normal>2183</span>
<span class=normal>2184</span>
<span class=normal>2185</span>
<span class=normal>2186</span>
<span class=normal>2187</span>
<span class=normal>2188</span>
<span class=normal>2189</span>
<span class=normal>2190</span>
<span class=normal>2191</span>
<span class=normal>2192</span>
<span class=normal>2193</span>
<span class=normal>2194</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_addon_dist_items</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Addon distribution items.</span>

<span class=sd>    These items describe source files required by addon to be available on</span>
<span class=sd>    machine. Each item may have 0-n source information from where can be</span>
<span class=sd>    obtained. If file is already available it&#39;s state will be &#39;UPDATED&#39;.</span>

<span class=sd>    Example output:</span>
<span class=sd>        [</span>
<span class=sd>            {</span>
<span class=sd>                &quot;dist_item&quot;: DistributionItem,</span>
<span class=sd>                &quot;addon_name&quot;: str,</span>
<span class=sd>                &quot;addon_version&quot;: str,</span>
<span class=sd>                &quot;addon_item&quot;: AddonInfo,</span>
<span class=sd>                &quot;addon_version_item&quot;: AddonVersionInfo</span>
<span class=sd>            }, {</span>
<span class=sd>                ...</span>
<span class=sd>            }</span>
<span class=sd>        ]</span>

<span class=sd>    Returns:</span>
<span class=sd>         list[dict[str, Any]]: Distribution items with addon version item.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_addon_dist_items</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_addon_dist_items</span> <span class=o>=</span> <span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_current_addon_dist_items</span><span class=p>())</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_addon_dist_items</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.get_addons_metadata_filepath class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_addons_metadata_filepath</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Path to addons metadata file.</p> <p>Metadata contain information about distributed addons, used sources, expected file hashes and time when files were distributed.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Path to a file where addons metadata are stored.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2227</span>
<span class=normal>2228</span>
<span class=normal>2229</span>
<span class=normal>2230</span>
<span class=normal>2231</span>
<span class=normal>2232</span>
<span class=normal>2233</span>
<span class=normal>2234</span>
<span class=normal>2235</span>
<span class=normal>2236</span>
<span class=normal>2237</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_addons_metadata_filepath</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Path to addons metadata file.</span>

<span class=sd>    Metadata contain information about distributed addons, used sources,</span>
<span class=sd>    expected file hashes and time when files were distributed.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: Path to a file where addons metadata are stored.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_addons_dirpath</span><span class=p>,</span> <span class=s2>&quot;addons.json&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.get_all_distribution_items class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_all_distribution_items</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Distribution items required by server.</p> <p>Items contain dependency package item and all addons that are enabled and have distribution requirements.</p> <p>Items can be already available on machine.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=list>list</span>[<a class="autorefs autorefs-internal" title="DistributionItem (common.ayon_common.distribution.control.DistributionItem)" href=#common.ayon_common.distribution.control.DistributionItem>DistributionItem</a>]</code> </td> <td> <div class=doc-md-description> <p>list[DistributionItem]: Distribution items required by server.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2383</span>
<span class=normal>2384</span>
<span class=normal>2385</span>
<span class=normal>2386</span>
<span class=normal>2387</span>
<span class=normal>2388</span>
<span class=normal>2389</span>
<span class=normal>2390</span>
<span class=normal>2391</span>
<span class=normal>2392</span>
<span class=normal>2393</span>
<span class=normal>2394</span>
<span class=normal>2395</span>
<span class=normal>2396</span>
<span class=normal>2397</span>
<span class=normal>2398</span>
<span class=normal>2399</span>
<span class=normal>2400</span>
<span class=normal>2401</span>
<span class=normal>2402</span>
<span class=normal>2403</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_all_distribution_items</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=n>DistributionItem</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Distribution items required by server.</span>

<span class=sd>    Items contain dependency package item and all addons that are enabled</span>
<span class=sd>    and have distribution requirements.</span>

<span class=sd>    Items can be already available on machine.</span>

<span class=sd>    Returns:</span>
<span class=sd>        list[DistributionItem]: Distribution items required by server.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>output</span> <span class=o>=</span> <span class=p>[</span>
        <span class=n>item</span><span class=p>[</span><span class=s2>&quot;dist_item&quot;</span><span class=p>]</span>
        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_addon_dist_items</span><span class=p>()</span>
    <span class=p>]</span>
    <span class=n>dependency_dist_item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_dist_item</span><span class=p>()</span>
    <span class=k>if</span> <span class=n>dependency_dist_item</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>output</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>dependency_dist_item</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>output</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.get_dependency_dist_item class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_dependency_dist_item</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Dependency package distribution item.</p> <p>Item describe source files required by server to be available on machine. Item may have 0-n source information from where can be obtained. If file is already available it's state will be 'UPDATED'.</p> <p>'None' is returned if server does not have defined any dependency package.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<a class="autorefs autorefs-internal" title="DistributionItem (common.ayon_common.distribution.control.DistributionItem)" href=#common.ayon_common.distribution.control.DistributionItem>DistributionItem</a>]</code> </td> <td> <div class=doc-md-description> <p>Optional[DistributionItem]: Dependency item or None if server does not have specified any dependency package.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2196</span>
<span class=normal>2197</span>
<span class=normal>2198</span>
<span class=normal>2199</span>
<span class=normal>2200</span>
<span class=normal>2201</span>
<span class=normal>2202</span>
<span class=normal>2203</span>
<span class=normal>2204</span>
<span class=normal>2205</span>
<span class=normal>2206</span>
<span class=normal>2207</span>
<span class=normal>2208</span>
<span class=normal>2209</span>
<span class=normal>2210</span>
<span class=normal>2211</span>
<span class=normal>2212</span>
<span class=normal>2213</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_dependency_dist_item</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>DistributionItem</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Dependency package distribution item.</span>

<span class=sd>    Item describe source files required by server to be available on</span>
<span class=sd>    machine. Item may have 0-n source information from where can be</span>
<span class=sd>    obtained. If file is already available it&#39;s state will be &#39;UPDATED&#39;.</span>

<span class=sd>    &#39;None&#39; is returned if server does not have defined any dependency</span>
<span class=sd>    package.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Optional[DistributionItem]: Dependency item or None if server</span>
<span class=sd>            does not have specified any dependency package.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dist_item</span> <span class=ow>is</span> <span class=n>NOT_SET</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dist_item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_dependency_progress</span><span class=p>()</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dist_item</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.get_dependency_metadata_filepath class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_dependency_metadata_filepath</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Path to distribution metadata file.</p> <p>Metadata contain information about distributed packages, used source, expected file hash and time when file was distributed.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Path to a file where dependency package metadata are stored.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2215</span>
<span class=normal>2216</span>
<span class=normal>2217</span>
<span class=normal>2218</span>
<span class=normal>2219</span>
<span class=normal>2220</span>
<span class=normal>2221</span>
<span class=normal>2222</span>
<span class=normal>2223</span>
<span class=normal>2224</span>
<span class=normal>2225</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_dependency_metadata_filepath</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Path to distribution metadata file.</span>

<span class=sd>    Metadata contain information about distributed packages, used source,</span>
<span class=sd>    expected file hash and time when file was distributed.</span>

<span class=sd>    Returns:</span>
<span class=sd>        str: Path to a file where dependency package metadata are stored.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_dependency_dirpath</span><span class=p>,</span> <span class=s2>&quot;dependency.json&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.get_python_paths class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_python_paths</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Get all paths to python packages that should be added to python.</p> <p>These paths lead to addon directories and python dependencies in dependency package.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=list>list</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>List[str]: Paths that should be added to 'sys.path' and 'PYTHONPATH'.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2532</span>
<span class=normal>2533</span>
<span class=normal>2534</span>
<span class=normal>2535</span>
<span class=normal>2536</span>
<span class=normal>2537</span>
<span class=normal>2538</span>
<span class=normal>2539</span>
<span class=normal>2540</span>
<span class=normal>2541</span>
<span class=normal>2542</span>
<span class=normal>2543</span>
<span class=normal>2544</span>
<span class=normal>2545</span>
<span class=normal>2546</span>
<span class=normal>2547</span>
<span class=normal>2548</span>
<span class=normal>2549</span>
<span class=normal>2550</span>
<span class=normal>2551</span>
<span class=normal>2552</span>
<span class=normal>2553</span>
<span class=normal>2554</span>
<span class=normal>2555</span>
<span class=normal>2556</span>
<span class=normal>2557</span>
<span class=normal>2558</span>
<span class=normal>2559</span>
<span class=normal>2560</span>
<span class=normal>2561</span>
<span class=normal>2562</span>
<span class=normal>2563</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_python_paths</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get all paths to python packages that should be added to python.</span>

<span class=sd>    These paths lead to addon directories and python dependencies in</span>
<span class=sd>    dependency package.</span>

<span class=sd>    Returns:</span>
<span class=sd>        List[str]: Paths that should be added to &#39;sys.path&#39; and</span>
<span class=sd>            &#39;PYTHONPATH&#39;.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>output</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_addon_dist_items</span><span class=p>():</span>
        <span class=n>dist_item</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&quot;dist_item&quot;</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>state</span> <span class=o>!=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span><span class=p>:</span>
            <span class=k>continue</span>
        <span class=n>target_dirpath</span> <span class=o>=</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>target_dirpath</span>
        <span class=k>if</span> <span class=n>target_dirpath</span> <span class=ow>and</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>target_dirpath</span><span class=p>):</span>
            <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>target_dirpath</span><span class=p>)</span>

    <span class=n>output</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_get_dev_sys_paths</span><span class=p>())</span>

    <span class=n>dependency_dist_item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_dist_item</span><span class=p>()</span>
    <span class=k>if</span> <span class=n>dependency_dist_item</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>dependencies_dir</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>target_dirpath</span> <span class=o>=</span> <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>target_dirpath</span>
        <span class=k>if</span> <span class=n>target_dirpath</span><span class=p>:</span>
            <span class=n>dependencies_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>target_dirpath</span><span class=p>,</span> <span class=s2>&quot;dependencies&quot;</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>dependencies_dir</span> <span class=ow>and</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>dependencies_dir</span><span class=p>):</span>
            <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>dependencies_dir</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>output</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.get_sys_paths class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_sys_paths</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Get all paths to python packages that should be added to path.</p> <p>These packages will be added only to 'sys.path' and not into 'PYTHONPATH', so they won't be available in subprocesses.</p> <details class=todos open> <summary>Todos</summary> <p>This is not yet implemented. The goal is that dependency package will contain also 'build' python dependencies (OpenTimelineIO, Pillow, etc.).</p> </details> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=list>list</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>list[str]: Paths that should be added to 'sys.path'.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2505</span>
<span class=normal>2506</span>
<span class=normal>2507</span>
<span class=normal>2508</span>
<span class=normal>2509</span>
<span class=normal>2510</span>
<span class=normal>2511</span>
<span class=normal>2512</span>
<span class=normal>2513</span>
<span class=normal>2514</span>
<span class=normal>2515</span>
<span class=normal>2516</span>
<span class=normal>2517</span>
<span class=normal>2518</span>
<span class=normal>2519</span>
<span class=normal>2520</span>
<span class=normal>2521</span>
<span class=normal>2522</span>
<span class=normal>2523</span>
<span class=normal>2524</span>
<span class=normal>2525</span>
<span class=normal>2526</span>
<span class=normal>2527</span>
<span class=normal>2528</span>
<span class=normal>2529</span>
<span class=normal>2530</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_sys_paths</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get all paths to python packages that should be added to path.</span>

<span class=sd>    These packages will be added only to &#39;sys.path&#39; and not into</span>
<span class=sd>    &#39;PYTHONPATH&#39;, so they won&#39;t be available in subprocesses.</span>

<span class=sd>    Todos:</span>
<span class=sd>        This is not yet implemented. The goal is that dependency</span>
<span class=sd>            package will contain also &#39;build&#39; python</span>
<span class=sd>            dependencies (OpenTimelineIO, Pillow, etc.).</span>

<span class=sd>    Returns:</span>
<span class=sd>        list[str]: Paths that should be added to &#39;sys.path&#39;.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>output</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>dependency_dist_item</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_dist_item</span><span class=p>()</span>
    <span class=k>if</span> <span class=n>dependency_dist_item</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>runtime_dir</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>target_dirpath</span> <span class=o>=</span> <span class=n>dependency_dist_item</span><span class=o>.</span><span class=n>target_dirpath</span>
        <span class=k>if</span> <span class=n>target_dirpath</span><span class=p>:</span>
            <span class=n>runtime_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>target_dirpath</span><span class=p>,</span> <span class=s2>&quot;runtime&quot;</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>runtime_dir</span> <span class=ow>and</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>runtime_dir</span><span class=p>):</span>
            <span class=n>output</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>runtime_dir</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>output</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.read_metadata_file class="doc doc-heading"> <code class="highlight language-python"><span class=n>read_metadata_file</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=n>default_value</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents "> <p>Read json file from path.</p> <p>Method creates the file when does not exist with default value.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>filepath</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Path to json file.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>default_value</code> </td> <td> <code><span title=Union>Union</span>[<span title=Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>], <span title=List>List</span>[<span title=typing.Any>Any</span>], None]</code> </td> <td> <div class=doc-md-description> <p>Default value if the file is not available (or valid).</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>Union[Dict[str, Any], List[Any]]: Value from file.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2239</span>
<span class=normal>2240</span>
<span class=normal>2241</span>
<span class=normal>2242</span>
<span class=normal>2243</span>
<span class=normal>2244</span>
<span class=normal>2245</span>
<span class=normal>2246</span>
<span class=normal>2247</span>
<span class=normal>2248</span>
<span class=normal>2249</span>
<span class=normal>2250</span>
<span class=normal>2251</span>
<span class=normal>2252</span>
<span class=normal>2253</span>
<span class=normal>2254</span>
<span class=normal>2255</span>
<span class=normal>2256</span>
<span class=normal>2257</span>
<span class=normal>2258</span>
<span class=normal>2259</span>
<span class=normal>2260</span>
<span class=normal>2261</span>
<span class=normal>2262</span>
<span class=normal>2263</span>
<span class=normal>2264</span>
<span class=normal>2265</span>
<span class=normal>2266</span>
<span class=normal>2267</span>
<span class=normal>2268</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@staticmethod</span>
<span class=k>def</span><span class=w> </span><span class=nf>read_metadata_file</span><span class=p>(</span>
    <span class=n>filepath</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>default_value</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Read json file from path.</span>

<span class=sd>    Method creates the file when does not exist with default value.</span>

<span class=sd>    Args:</span>
<span class=sd>        filepath (str): Path to json file.</span>
<span class=sd>        default_value (Union[Dict[str, Any], List[Any], None]): Default</span>
<span class=sd>            value if the file is not available (or valid).</span>

<span class=sd>    Returns:</span>
<span class=sd>        Union[Dict[str, Any], List[Any]]: Value from file.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=n>default_value</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>default_value</span> <span class=o>=</span> <span class=p>{}</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>filepath</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>default_value</span>

    <span class=k>try</span><span class=p>:</span>
        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>stream</span><span class=p>:</span>
            <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>stream</span><span class=p>)</span>
    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
        <span class=n>data</span> <span class=o>=</span> <span class=n>default_value</span>
    <span class=k>return</span> <span class=n>data</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.save_metadata_file class="doc doc-heading"> <code class="highlight language-python"><span class=n>save_metadata_file</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents "> <p>Store data to json file.</p> <p>Method creates the file when does not exist.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>filepath</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Path to json file.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>data</code> </td> <td> <code><span title=dict>dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>Data to store into file.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2270</span>
<span class=normal>2271</span>
<span class=normal>2272</span>
<span class=normal>2273</span>
<span class=normal>2274</span>
<span class=normal>2275</span>
<span class=normal>2276</span>
<span class=normal>2277</span>
<span class=normal>2278</span>
<span class=normal>2279</span>
<span class=normal>2280</span>
<span class=normal>2281</span>
<span class=normal>2282</span>
<span class=normal>2283</span>
<span class=normal>2284</span>
<span class=normal>2285</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@staticmethod</span>
<span class=k>def</span><span class=w> </span><span class=nf>save_metadata_file</span><span class=p>(</span><span class=n>filepath</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Store data to json file.</span>

<span class=sd>    Method creates the file when does not exist.</span>

<span class=sd>    Args:</span>
<span class=sd>        filepath (str): Path to json file.</span>
<span class=sd>        data (dict[str, Any]): Data to store into file.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>dirpath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>filepath</span><span class=p>)</span>
    <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>dirpath</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>stream</span><span class=p>:</span>
        <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>stream</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
    <span class=n>change_permissions_recursive</span><span class=p>(</span><span class=n>dirpath</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.AYONDistribution.validate_distribution class="doc doc-heading"> <code class="highlight language-python"><span class=n>validate_distribution</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Check if all required distribution items are distributed.</p> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=RuntimeError>RuntimeError</span></code> </td> <td> <div class=doc-md-description> <p>Any of items is not available.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2478</span>
<span class=normal>2479</span>
<span class=normal>2480</span>
<span class=normal>2481</span>
<span class=normal>2482</span>
<span class=normal>2483</span>
<span class=normal>2484</span>
<span class=normal>2485</span>
<span class=normal>2486</span>
<span class=normal>2487</span>
<span class=normal>2488</span>
<span class=normal>2489</span>
<span class=normal>2490</span>
<span class=normal>2491</span>
<span class=normal>2492</span>
<span class=normal>2493</span>
<span class=normal>2494</span>
<span class=normal>2495</span>
<span class=normal>2496</span>
<span class=normal>2497</span>
<span class=normal>2498</span>
<span class=normal>2499</span>
<span class=normal>2500</span>
<span class=normal>2501</span>
<span class=normal>2502</span>
<span class=normal>2503</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>validate_distribution</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Check if all required distribution items are distributed.</span>

<span class=sd>    Raises:</span>
<span class=sd>        RuntimeError: Any of items is not available.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>invalid</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>dependency_package</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_dependency_dist_item</span><span class=p>()</span>
    <span class=k>if</span> <span class=p>(</span>
        <span class=n>dependency_package</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
        <span class=ow>and</span> <span class=n>dependency_package</span><span class=o>.</span><span class=n>state</span> <span class=o>!=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
    <span class=p>):</span>
        <span class=n>invalid</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;Dependency package&quot;</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_addon_dist_items</span><span class=p>():</span>
        <span class=n>dist_item</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s2>&quot;dist_item&quot;</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>dist_item</span><span class=o>.</span><span class=n>state</span> <span class=o>!=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span><span class=p>:</span>
            <span class=n>invalid</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s2>&quot;addon_name&quot;</span><span class=p>])</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>invalid</span><span class=p>:</span>
        <span class=k>return</span>

    <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&quot;Failed to distribute </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
        <span class=s2>&quot;, &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=sa>f</span><span class=s1>&#39;&quot;</span><span class=si>{</span><span class=n>item</span><span class=si>}</span><span class=s1>&quot;&#39;</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>invalid</span><span class=p>])</span>
    <span class=p>))</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=common.ayon_common.distribution.control.BaseDistributionItem class="doc doc-heading"> <code>BaseDistributionItem</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=abc.ABC>ABC</span></code></p> <p>Distribution item with sources and target directories.</p> <p>Distribution item can be an installer, addon or dependency package. Distribution item can be already distributed and don't need any progression. The item keeps track of the progress. The reason is to be able to use the distribution items as source data for UI without implementing the same logic.</p> <p>Distribution is "state" based. Distribution can be 'UPDATED' or 'OUTDATED' at the initialization. If item is 'UPDATED' the distribution is skipped and 'OUTDATED' will trigger the distribution process.</p> <p>Because the distribution may have multiple sources each source has own progress item.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>download_dirpath</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Path to directory where file is unzipped.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>state</code> </td> <td> <code><span title=common.ayon_common.distribution.control.UpdateState>UpdateState</span></code> </td> <td> <div class=doc-md-description> <p>Initial state (UpdateState.UPDATED or UpdateState.OUTDATED).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>checksum</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Hash of file for validation.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>checksum_algorithm</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Algorithm used to generate the hash.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>factory</code> </td> <td> <code><a class="autorefs autorefs-internal" title="DownloadFactory (common.ayon_common.distribution.downloaders.DownloadFactory)" href=downloaders.html#common.ayon_common.distribution.downloaders.DownloadFactory>DownloadFactory</a></code> </td> <td> <div class=doc-md-description> <p>Downloaders factory object.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>sources</code> </td> <td> <code><span title=List>List</span>[<span title=common.ayon_common.distribution.data_structures.SourceInfo>SourceInfo</span>]</code> </td> <td> <div class=doc-md-description> <p>Possible sources to receive the distribution item.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>downloader_data</code> </td> <td> <code><span title=Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>More information for downloaders.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>item_label</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Label used in log outputs (and in UI).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>progress_dir</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Directory where progress is stored for other processes.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>logger</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=logging.Logger>Logger</span>]</code> </td> <td> <div class=doc-md-description> <p>Logger object.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span>
<span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span>
<span class=normal>600</span>
<span class=normal>601</span>
<span class=normal>602</span>
<span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span>
<span class=normal>608</span>
<span class=normal>609</span>
<span class=normal>610</span>
<span class=normal>611</span>
<span class=normal>612</span>
<span class=normal>613</span>
<span class=normal>614</span>
<span class=normal>615</span>
<span class=normal>616</span>
<span class=normal>617</span>
<span class=normal>618</span>
<span class=normal>619</span>
<span class=normal>620</span>
<span class=normal>621</span>
<span class=normal>622</span>
<span class=normal>623</span>
<span class=normal>624</span>
<span class=normal>625</span>
<span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span>
<span class=normal>633</span>
<span class=normal>634</span>
<span class=normal>635</span>
<span class=normal>636</span>
<span class=normal>637</span>
<span class=normal>638</span>
<span class=normal>639</span>
<span class=normal>640</span>
<span class=normal>641</span>
<span class=normal>642</span>
<span class=normal>643</span>
<span class=normal>644</span>
<span class=normal>645</span>
<span class=normal>646</span>
<span class=normal>647</span>
<span class=normal>648</span>
<span class=normal>649</span>
<span class=normal>650</span>
<span class=normal>651</span>
<span class=normal>652</span>
<span class=normal>653</span>
<span class=normal>654</span>
<span class=normal>655</span>
<span class=normal>656</span>
<span class=normal>657</span>
<span class=normal>658</span>
<span class=normal>659</span>
<span class=normal>660</span>
<span class=normal>661</span>
<span class=normal>662</span>
<span class=normal>663</span>
<span class=normal>664</span>
<span class=normal>665</span>
<span class=normal>666</span>
<span class=normal>667</span>
<span class=normal>668</span>
<span class=normal>669</span>
<span class=normal>670</span>
<span class=normal>671</span>
<span class=normal>672</span>
<span class=normal>673</span>
<span class=normal>674</span>
<span class=normal>675</span>
<span class=normal>676</span>
<span class=normal>677</span>
<span class=normal>678</span>
<span class=normal>679</span>
<span class=normal>680</span>
<span class=normal>681</span>
<span class=normal>682</span>
<span class=normal>683</span>
<span class=normal>684</span>
<span class=normal>685</span>
<span class=normal>686</span>
<span class=normal>687</span>
<span class=normal>688</span>
<span class=normal>689</span>
<span class=normal>690</span>
<span class=normal>691</span>
<span class=normal>692</span>
<span class=normal>693</span>
<span class=normal>694</span>
<span class=normal>695</span>
<span class=normal>696</span>
<span class=normal>697</span>
<span class=normal>698</span>
<span class=normal>699</span>
<span class=normal>700</span>
<span class=normal>701</span>
<span class=normal>702</span>
<span class=normal>703</span>
<span class=normal>704</span>
<span class=normal>705</span>
<span class=normal>706</span>
<span class=normal>707</span>
<span class=normal>708</span>
<span class=normal>709</span>
<span class=normal>710</span>
<span class=normal>711</span>
<span class=normal>712</span>
<span class=normal>713</span>
<span class=normal>714</span>
<span class=normal>715</span>
<span class=normal>716</span>
<span class=normal>717</span>
<span class=normal>718</span>
<span class=normal>719</span>
<span class=normal>720</span>
<span class=normal>721</span>
<span class=normal>722</span>
<span class=normal>723</span>
<span class=normal>724</span>
<span class=normal>725</span>
<span class=normal>726</span>
<span class=normal>727</span>
<span class=normal>728</span>
<span class=normal>729</span>
<span class=normal>730</span>
<span class=normal>731</span>
<span class=normal>732</span>
<span class=normal>733</span>
<span class=normal>734</span>
<span class=normal>735</span>
<span class=normal>736</span>
<span class=normal>737</span>
<span class=normal>738</span>
<span class=normal>739</span>
<span class=normal>740</span>
<span class=normal>741</span>
<span class=normal>742</span>
<span class=normal>743</span>
<span class=normal>744</span>
<span class=normal>745</span>
<span class=normal>746</span>
<span class=normal>747</span>
<span class=normal>748</span>
<span class=normal>749</span>
<span class=normal>750</span>
<span class=normal>751</span>
<span class=normal>752</span>
<span class=normal>753</span>
<span class=normal>754</span>
<span class=normal>755</span>
<span class=normal>756</span>
<span class=normal>757</span>
<span class=normal>758</span>
<span class=normal>759</span>
<span class=normal>760</span>
<span class=normal>761</span>
<span class=normal>762</span>
<span class=normal>763</span>
<span class=normal>764</span>
<span class=normal>765</span>
<span class=normal>766</span>
<span class=normal>767</span>
<span class=normal>768</span>
<span class=normal>769</span>
<span class=normal>770</span>
<span class=normal>771</span>
<span class=normal>772</span>
<span class=normal>773</span>
<span class=normal>774</span>
<span class=normal>775</span>
<span class=normal>776</span>
<span class=normal>777</span>
<span class=normal>778</span>
<span class=normal>779</span>
<span class=normal>780</span>
<span class=normal>781</span>
<span class=normal>782</span>
<span class=normal>783</span>
<span class=normal>784</span>
<span class=normal>785</span>
<span class=normal>786</span>
<span class=normal>787</span>
<span class=normal>788</span>
<span class=normal>789</span>
<span class=normal>790</span>
<span class=normal>791</span>
<span class=normal>792</span>
<span class=normal>793</span>
<span class=normal>794</span>
<span class=normal>795</span>
<span class=normal>796</span>
<span class=normal>797</span>
<span class=normal>798</span>
<span class=normal>799</span>
<span class=normal>800</span>
<span class=normal>801</span>
<span class=normal>802</span>
<span class=normal>803</span>
<span class=normal>804</span>
<span class=normal>805</span>
<span class=normal>806</span>
<span class=normal>807</span>
<span class=normal>808</span>
<span class=normal>809</span>
<span class=normal>810</span>
<span class=normal>811</span>
<span class=normal>812</span>
<span class=normal>813</span>
<span class=normal>814</span>
<span class=normal>815</span>
<span class=normal>816</span>
<span class=normal>817</span>
<span class=normal>818</span>
<span class=normal>819</span>
<span class=normal>820</span>
<span class=normal>821</span>
<span class=normal>822</span>
<span class=normal>823</span>
<span class=normal>824</span>
<span class=normal>825</span>
<span class=normal>826</span>
<span class=normal>827</span>
<span class=normal>828</span>
<span class=normal>829</span>
<span class=normal>830</span>
<span class=normal>831</span>
<span class=normal>832</span>
<span class=normal>833</span>
<span class=normal>834</span>
<span class=normal>835</span>
<span class=normal>836</span>
<span class=normal>837</span>
<span class=normal>838</span>
<span class=normal>839</span>
<span class=normal>840</span>
<span class=normal>841</span>
<span class=normal>842</span>
<span class=normal>843</span>
<span class=normal>844</span>
<span class=normal>845</span>
<span class=normal>846</span>
<span class=normal>847</span>
<span class=normal>848</span>
<span class=normal>849</span>
<span class=normal>850</span>
<span class=normal>851</span>
<span class=normal>852</span>
<span class=normal>853</span>
<span class=normal>854</span>
<span class=normal>855</span>
<span class=normal>856</span>
<span class=normal>857</span>
<span class=normal>858</span>
<span class=normal>859</span>
<span class=normal>860</span>
<span class=normal>861</span>
<span class=normal>862</span>
<span class=normal>863</span>
<span class=normal>864</span>
<span class=normal>865</span>
<span class=normal>866</span>
<span class=normal>867</span>
<span class=normal>868</span>
<span class=normal>869</span>
<span class=normal>870</span>
<span class=normal>871</span>
<span class=normal>872</span>
<span class=normal>873</span>
<span class=normal>874</span>
<span class=normal>875</span>
<span class=normal>876</span>
<span class=normal>877</span>
<span class=normal>878</span>
<span class=normal>879</span>
<span class=normal>880</span>
<span class=normal>881</span>
<span class=normal>882</span>
<span class=normal>883</span>
<span class=normal>884</span>
<span class=normal>885</span>
<span class=normal>886</span>
<span class=normal>887</span>
<span class=normal>888</span>
<span class=normal>889</span>
<span class=normal>890</span>
<span class=normal>891</span>
<span class=normal>892</span>
<span class=normal>893</span>
<span class=normal>894</span>
<span class=normal>895</span>
<span class=normal>896</span>
<span class=normal>897</span>
<span class=normal>898</span>
<span class=normal>899</span>
<span class=normal>900</span>
<span class=normal>901</span>
<span class=normal>902</span>
<span class=normal>903</span>
<span class=normal>904</span>
<span class=normal>905</span>
<span class=normal>906</span>
<span class=normal>907</span>
<span class=normal>908</span>
<span class=normal>909</span>
<span class=normal>910</span>
<span class=normal>911</span>
<span class=normal>912</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>BaseDistributionItem</span><span class=p>(</span><span class=n>ABC</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Distribution item with sources and target directories.</span>

<span class=sd>    Distribution item can be an installer, addon or dependency package.</span>
<span class=sd>    Distribution item can be already distributed and don&#39;t need any</span>
<span class=sd>    progression. The item keeps track of the progress. The reason is to be</span>
<span class=sd>    able to use the distribution items as source data for UI without</span>
<span class=sd>    implementing the same logic.</span>

<span class=sd>    Distribution is &quot;state&quot; based. Distribution can be &#39;UPDATED&#39; or &#39;OUTDATED&#39;</span>
<span class=sd>    at the initialization. If item is &#39;UPDATED&#39; the distribution is skipped</span>
<span class=sd>    and &#39;OUTDATED&#39; will trigger the distribution process.</span>

<span class=sd>    Because the distribution may have multiple sources each source has own</span>
<span class=sd>    progress item.</span>

<span class=sd>    Args:</span>
<span class=sd>        download_dirpath (str): Path to directory where file is unzipped.</span>
<span class=sd>        state (UpdateState): Initial state (UpdateState.UPDATED or</span>
<span class=sd>            UpdateState.OUTDATED).</span>
<span class=sd>        checksum (Optional[str]): Hash of file for validation.</span>
<span class=sd>        checksum_algorithm (Optional[str]): Algorithm used to generate the hash.</span>
<span class=sd>        factory (DownloadFactory): Downloaders factory object.</span>
<span class=sd>        sources (List[SourceInfo]): Possible sources to receive the</span>
<span class=sd>            distribution item.</span>
<span class=sd>        downloader_data (Dict[str, Any]): More information for downloaders.</span>
<span class=sd>        item_label (str): Label used in log outputs (and in UI).</span>
<span class=sd>        progress_dir (Optional[str]): Directory where progress is stored for</span>
<span class=sd>            other processes.</span>
<span class=sd>        logger (Optional[logging.Logger]): Logger object.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>download_dirpath</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>state</span><span class=p>:</span> <span class=n>UpdateState</span><span class=p>,</span>
        <span class=n>checksum</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
        <span class=n>checksum_algorithm</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
        <span class=n>factory</span><span class=p>:</span> <span class=n>DownloadFactory</span><span class=p>,</span>
        <span class=n>sources</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=n>SourceInfo</span><span class=p>],</span>
        <span class=n>downloader_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
        <span class=n>item_label</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>progress_dir</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>logger</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>logging</span><span class=o>.</span><span class=n>Logger</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>):</span>
        <span class=k>if</span> <span class=n>logger</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>:</span> <span class=n>logging</span><span class=o>.</span><span class=n>Logger</span> <span class=o>=</span> <span class=n>logger</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>state</span><span class=p>:</span> <span class=n>UpdateState</span> <span class=o>=</span> <span class=n>state</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>download_dirpath</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>download_dirpath</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>checksum</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>checksum</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>checksum_algorithm</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>checksum_algorithm</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>factory</span><span class=p>:</span> <span class=n>DownloadFactory</span> <span class=o>=</span> <span class=n>factory</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>sources</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_sources</span><span class=p>(</span><span class=n>sources</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>downloader_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>downloader_data</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>item_label</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_need_distribution</span> <span class=o>=</span> <span class=n>state</span> <span class=o>!=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_current_source_progress</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_used_source_progress</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_used_source</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_dist_started</span> <span class=o>=</span> <span class=kc>False</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_progress_id</span> <span class=o>=</span> <span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_progress_dir</span> <span class=o>=</span> <span class=n>progress_dir</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_error_msg</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_error_detail</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_prepare_sources</span><span class=p>(</span><span class=n>sources</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=n>SourceInfo</span><span class=p>]):</span>
        <span class=k>return</span> <span class=p>[</span>
            <span class=p>(</span><span class=n>source</span><span class=p>,</span> <span class=n>DistributeTransferProgress</span><span class=p>())</span>
            <span class=k>for</span> <span class=n>source</span> <span class=ow>in</span> <span class=n>sources</span>
        <span class=p>]</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>need_distribution</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Need distribution based on initial state.</span>

<span class=sd>        Returns:</span>
<span class=sd>            bool: Need distribution.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_need_distribution</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>current_source_progress</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>DistributeTransferProgress</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Currently processed source progress object.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[DistributeTransferProgress]: Transfer progress or None.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_current_source_progress</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>used_source_progress</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>DistributeTransferProgress</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Transfer progress that successfully distributed the item.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[DistributeTransferProgress]: Transfer progress or None.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_used_source_progress</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>used_source</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Data of source item.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[dict[str, Any]]: SourceInfo data or None.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_used_source</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>error_message</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Reason why distribution item failed.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[str]: Error message.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_error_msg</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>error_detail</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Detailed reason why distribution item failed.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[str]: Detailed information (maybe traceback).</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_error_detail</span>

    <span class=nd>@property</span>
    <span class=nd>@abstractmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>is_missing_permissions</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=k>pass</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_pre_source_process</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>download_dirpath</span><span class=p>):</span>
            <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>download_dirpath</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=n>change_permissions_recursive</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>download_dirpath</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_receive_file</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>source_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
        <span class=n>source_progress</span><span class=p>:</span> <span class=n>DistributeTransferProgress</span><span class=p>,</span>
        <span class=n>downloader</span><span class=p>:</span> <span class=n>SourceDownloader</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Receive source filepath using source data and downloader.</span>

<span class=sd>        Args:</span>
<span class=sd>            source_data (dict[str, Any]): Source information.</span>
<span class=sd>            source_progress (DistributeTransferProgress): Object where to</span>
<span class=sd>                track process of a source.</span>
<span class=sd>            downloader (SourceDownloader): Downloader object which should care</span>
<span class=sd>                about receiving file from source.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[str]: Filepath to received file from source.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>download_dirpath</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>download_dirpath</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=n>filepath</span> <span class=o>=</span> <span class=n>downloader</span><span class=o>.</span><span class=n>download</span><span class=p>(</span>
                <span class=n>source_data</span><span class=p>,</span>
                <span class=n>download_dirpath</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>downloader_data</span><span class=p>,</span>
                <span class=n>source_progress</span><span class=o>.</span><span class=n>transfer_progress</span><span class=p>,</span>
            <span class=p>)</span>
        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
            <span class=n>message</span> <span class=o>=</span> <span class=s2>&quot;Failed to download source&quot;</span>
            <span class=n>source_progress</span><span class=o>.</span><span class=n>set_failed</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
            <span class=p>)</span>
            <span class=k>return</span> <span class=kc>None</span>

        <span class=n>source_progress</span><span class=o>.</span><span class=n>set_hash_check_started</span><span class=p>()</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=c1># WARNING This condition was added because addons don&#39;t have</span>
            <span class=c1>#   information about checksum at the moment.</span>
            <span class=c1># TODO remove once addon can supply checksum.</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>checksum</span><span class=p>:</span>
                <span class=n>downloader</span><span class=o>.</span><span class=n>check_hash</span><span class=p>(</span>
                    <span class=n>filepath</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>checksum</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>checksum_algorithm</span>
                <span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=c1># Fill checksum automatically based on downloaded file</span>
                <span class=c1># - still better than nothing</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>checksum_algorithm</span><span class=p>:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>checksum_algorithm</span> <span class=o>=</span> <span class=s2>&quot;sha256&quot;</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>checksum</span> <span class=o>=</span> <span class=n>calculate_file_checksum</span><span class=p>(</span>
                    <span class=n>filepath</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>checksum_algorithm</span>
                <span class=p>)</span>

        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
            <span class=n>message</span> <span class=o>=</span> <span class=s2>&quot;File hash does not match&quot;</span>
            <span class=n>source_progress</span><span class=o>.</span><span class=n>set_failed</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
            <span class=p>)</span>
            <span class=k>return</span> <span class=kc>None</span>
        <span class=n>source_progress</span><span class=o>.</span><span class=n>set_hash_check_finished</span><span class=p>()</span>
        <span class=k>return</span> <span class=n>filepath</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_post_source_process</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>filepath</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>source_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
        <span class=n>source_progress</span><span class=p>:</span> <span class=n>DistributeTransferProgress</span><span class=p>,</span>
        <span class=n>downloader</span><span class=p>:</span> <span class=n>SourceDownloader</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>],</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Process source after it is downloaded and validated.</span>

<span class=sd>        Override this method if downloaded file needs more logic to do, like</span>
<span class=sd>            extraction.</span>

<span class=sd>        This part will mark source as updated and will trigger cleanup of</span>
<span class=sd>        source files via downloader (e.g. to remove downloaded file).</span>

<span class=sd>        Args:</span>
<span class=sd>            filepath (str): Path to a downloaded source.</span>
<span class=sd>            source_data (dict[str, Any]): Source information data.</span>
<span class=sd>            source_progress (DistributeTransferProgress): Source progress.</span>
<span class=sd>            downloader (SourceDownloader): Object which cared about download</span>
<span class=sd>                of file.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Generator[Optional[bool], None, None]: Post processing finished</span>
<span class=sd>                in a way that it is not needed to process other possible</span>
<span class=sd>                sources. Does not mean that it was successful. If yields None</span>
<span class=sd>                then is still working.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=n>filepath</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_used_source</span> <span class=o>=</span> <span class=n>source_data</span>

        <span class=n>downloader</span><span class=o>.</span><span class=n>cleanup</span><span class=p>(</span>
            <span class=n>source_data</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>download_dirpath</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>downloader_data</span>
        <span class=p>)</span>
        <span class=k>yield</span> <span class=nb>bool</span><span class=p>(</span><span class=n>filepath</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_process_source</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>source</span><span class=p>:</span> <span class=n>SourceInfo</span><span class=p>,</span>
        <span class=n>source_progress</span><span class=p>:</span> <span class=n>DistributeTransferProgress</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>],</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Process single source item.</span>

<span class=sd>        Cares about download, validate and process source.</span>

<span class=sd>        Args:</span>
<span class=sd>            source (SourceInfo): Source information.</span>
<span class=sd>            source_progress (DistributeTransferProgress): Object to keep track</span>
<span class=sd>                about process of a source.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Generator[Optional[bool], None, None]: Source was processed so</span>
<span class=sd>                any other sources can be skipped. Does not have to be</span>
<span class=sd>                successfull. Is still working if yields None.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_current_source_progress</span> <span class=o>=</span> <span class=n>source_progress</span>
        <span class=n>source_progress</span><span class=o>.</span><span class=n>set_started</span><span class=p>()</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_pre_source_process</span><span class=p>()</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>downloader</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>factory</span><span class=o>.</span><span class=n>get_downloader</span><span class=p>(</span><span class=n>source</span><span class=o>.</span><span class=n>type</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
            <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Unknown downloader </span><span class=si>{</span><span class=n>source</span><span class=o>.</span><span class=n>type</span><span class=si>}</span><span class=s2>&quot;</span>
            <span class=n>source_progress</span><span class=o>.</span><span class=n>set_failed</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
            <span class=k>yield</span> <span class=kc>False</span>
            <span class=k>return</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=n>source_data</span> <span class=o>=</span> <span class=n>dataclasses</span><span class=o>.</span><span class=n>asdict</span><span class=p>(</span><span class=n>source</span><span class=p>)</span>
            <span class=n>filepath</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_receive_file</span><span class=p>(</span>
                <span class=n>source_data</span><span class=p>,</span>
                <span class=n>source_progress</span><span class=p>,</span>
                <span class=n>downloader</span>
            <span class=p>)</span>

            <span class=k>yield from</span> <span class=bp>self</span><span class=o>.</span><span class=n>_post_source_process</span><span class=p>(</span>
                <span class=n>filepath</span><span class=p>,</span> <span class=n>source_data</span><span class=p>,</span> <span class=n>source_progress</span><span class=p>,</span> <span class=n>downloader</span>
            <span class=p>)</span>

        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
            <span class=n>message</span> <span class=o>=</span> <span class=s2>&quot;Failed to process source&quot;</span>
            <span class=n>source_progress</span><span class=o>.</span><span class=n>set_failed</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
            <span class=p>)</span>
            <span class=k>yield</span> <span class=kc>False</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_set_progress_state</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>state</span><span class=p>:</span> <span class=n>DistFileStates</span><span class=p>):</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_progress_dir</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=n>progress_info</span> <span class=o>=</span> <span class=n>_read_progress_file</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_progress_dir</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>progress_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;progress_id&quot;</span><span class=p>)</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_progress_id</span><span class=p>:</span>
            <span class=c1># Ignore if wanted to set &#39;failed&#39; state</span>
            <span class=k>if</span> <span class=n>state</span> <span class=o>==</span> <span class=n>DistFileStates</span><span class=o>.</span><span class=n>failed</span><span class=p>:</span>
                <span class=k>return</span>
            <span class=k>raise</span> <span class=n>DistributionProgressInterupted</span><span class=p>(</span>
                <span class=s2>&quot;Different process took over progress file.&quot;</span>
            <span class=p>)</span>

        <span class=n>progress_info</span><span class=p>[</span><span class=s2>&quot;state&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>state</span><span class=o>.</span><span class=n>value</span>
        <span class=k>if</span> <span class=n>state</span> <span class=o>==</span> <span class=n>DistFileStates</span><span class=o>.</span><span class=n>done</span><span class=p>:</span>
            <span class=c1># Update checksum if it was not set from server information</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>progress_info</span><span class=p>[</span><span class=s2>&quot;checksum&quot;</span><span class=p>]</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>checksum</span><span class=p>:</span>
                <span class=n>progress_info</span><span class=p>[</span><span class=s2>&quot;checksum&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>checksum</span>
                <span class=n>progress_info</span><span class=p>[</span><span class=s2>&quot;checksum_algorithm&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>checksum_algorithm</span>
            <span class=n>progress_info</span><span class=p>[</span><span class=s2>&quot;dist_finished&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2> %H:%M:%S&quot;</span><span class=p>)</span>
            <span class=p>)</span>

        <span class=n>_store_progress_file</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_progress_dir</span><span class=p>,</span> <span class=n>progress_info</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_distribute</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=p>:</span>
            <span class=n>message</span> <span class=o>=</span> <span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: Don&#39;t have&quot;</span>
                <span class=s2>&quot; any sources to download from.&quot;</span>
            <span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_error_msg</span> <span class=o>=</span> <span class=n>message</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>MISS_SOURCE_FILES</span>
            <span class=k>yield</span> <span class=kc>True</span>
            <span class=k>return</span>

        <span class=c1># Progress file</span>
        <span class=c1># - Check if other process/machine already started the job</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_progress_dir</span><span class=p>:</span>
            <span class=n>result</span> <span class=o>=</span> <span class=kc>False</span>
            <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>_wait_for_other_process</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_progress_dir</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_progress_id</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span>
            <span class=p>):</span>
                <span class=k>if</span> <span class=n>result</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                    <span class=c1># Give other distribution items option to start waiting</span>
                    <span class=c1>#   cycle</span>
                    <span class=k>yield</span> <span class=kc>False</span>
                    <span class=k>break</span>
                <span class=k>yield</span> <span class=kc>False</span>

            <span class=k>if</span> <span class=n>result</span> <span class=ow>is</span> <span class=kc>True</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: Already distributed&quot;</span><span class=p>)</span>
                <span class=k>yield</span> <span class=kc>True</span>
                <span class=k>return</span>

            <span class=n>_create_progress_file</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_progress_dir</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_progress_id</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>checksum</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>checksum_algorithm</span><span class=p>,</span>
            <span class=p>)</span>

        <span class=c1># Download</span>
        <span class=k>for</span> <span class=n>source</span><span class=p>,</span> <span class=n>source_progress</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>sources</span><span class=p>:</span>
            <span class=k>yield</span> <span class=kc>False</span>
            <span class=n>result</span> <span class=o>=</span> <span class=kc>False</span>
            <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_source</span><span class=p>(</span><span class=n>source</span><span class=p>,</span> <span class=n>source_progress</span><span class=p>):</span>
                <span class=k>if</span> <span class=n>result</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                    <span class=k>break</span>

            <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
                <span class=k>break</span>

        <span class=n>last_progress</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_current_source_progress</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_current_source_progress</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_set_progress_state</span><span class=p>(</span><span class=n>DistFileStates</span><span class=o>.</span><span class=n>done</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_used_source_progress</span> <span class=o>=</span> <span class=n>last_progress</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: Distributed&quot;</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_set_progress_state</span><span class=p>(</span><span class=n>DistFileStates</span><span class=o>.</span><span class=n>failed</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: Failed to distribute&quot;</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_error_msg</span> <span class=o>=</span> <span class=s2>&quot;Failed to receive or install source files&quot;</span>
        <span class=k>yield</span> <span class=kc>True</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_post_distribute</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>pass</span>

    <span class=k>def</span><span class=w> </span><span class=nf>is_distributed</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>need_distribution</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>True</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>

    <span class=k>def</span><span class=w> </span><span class=nf>distribute</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Execute distribution logic.&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_distributed</span><span class=p>()</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dist_started</span><span class=p>:</span>
            <span class=k>yield</span> <span class=kc>True</span>
            <span class=k>return</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_dist_started</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_distribute</span><span class=p>():</span>
                    <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
                        <span class=k>break</span>
                    <span class=k>yield</span> <span class=kc>False</span>

            <span class=k>except</span> <span class=n>DistributionProgressInterupted</span><span class=p>:</span>
                <span class=n>wait_result</span> <span class=o>=</span> <span class=kc>False</span>
                <span class=k>for</span> <span class=n>wait_result</span> <span class=ow>in</span> <span class=n>_wait_for_other_process</span><span class=p>(</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_progress_dir</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_progress_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>log</span>
                <span class=p>):</span>
                    <span class=k>if</span> <span class=n>wait_result</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                        <span class=k>break</span>
                    <span class=k>yield</span> <span class=kc>False</span>

                <span class=k>if</span> <span class=n>wait_result</span><span class=p>:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATE_FAILED</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_error_msg</span> <span class=o>=</span> <span class=p>(</span>
                        <span class=s2>&quot;Other process took over distribution and failed.&quot;</span>
                    <span class=p>)</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_error_detail</span> <span class=o>=</span> <span class=p>(</span>
                        <span class=s2>&quot;Please try to start AYON again and contact&quot;</span>
                        <span class=s2>&quot; administrator if issue persist.&quot;</span>
                    <span class=p>)</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
                        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_error_msg</span><span class=si>}</span><span class=s2>&quot;</span>
                    <span class=p>)</span>

        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATE_FAILED</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_error_msg</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>exc</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_error_detail</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
                <span class=n>traceback</span><span class=o>.</span><span class=n>format_exception</span><span class=p>(</span><span class=o>*</span><span class=n>sys</span><span class=o>.</span><span class=n>exc_info</span><span class=p>())</span>
            <span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: Distibution failed&quot;</span><span class=p>,</span>
                <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
            <span class=p>)</span>

        <span class=k>finally</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>OUTDATED</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATE_FAILED</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_error_msg</span> <span class=o>=</span> <span class=s2>&quot;Distribution failed&quot;</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>_post_distribute</span><span class=p>()</span>
            <span class=k>yield</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.BaseDistributionItem.current_source_progress class="doc doc-heading"> <code class="highlight language-python"><span class=n>current_source_progress</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Currently processed source progress object.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<a class="autorefs autorefs-internal" title="DistributeTransferProgress (common.ayon_common.distribution.control.DistributeTransferProgress)" href=#common.ayon_common.distribution.control.DistributeTransferProgress>DistributeTransferProgress</a>]</code> </td> <td> <div class=doc-md-description> <p>Optional[DistributeTransferProgress]: Transfer progress or None.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.BaseDistributionItem.error_detail class="doc doc-heading"> <code class="highlight language-python"><span class=n>error_detail</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Detailed reason why distribution item failed.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Optional[str]: Detailed information (maybe traceback).</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.BaseDistributionItem.error_message class="doc doc-heading"> <code class="highlight language-python"><span class=n>error_message</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Reason why distribution item failed.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Optional[str]: Error message.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.BaseDistributionItem.need_distribution class="doc doc-heading"> <code class="highlight language-python"><span class=n>need_distribution</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Need distribution based on initial state.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>bool</code></td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Need distribution.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.BaseDistributionItem.used_source class="doc doc-heading"> <code class="highlight language-python"><span class=n>used_source</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Data of source item.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=dict>dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]</code> </td> <td> <div class=doc-md-description> <p>Optional[dict[str, Any]]: SourceInfo data or None.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.BaseDistributionItem.used_source_progress class="doc doc-heading"> <code class="highlight language-python"><span class=n>used_source_progress</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Transfer progress that successfully distributed the item.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<a class="autorefs autorefs-internal" title="DistributeTransferProgress (common.ayon_common.distribution.control.DistributeTransferProgress)" href=#common.ayon_common.distribution.control.DistributeTransferProgress>DistributeTransferProgress</a>]</code> </td> <td> <div class=doc-md-description> <p>Optional[DistributeTransferProgress]: Transfer progress or None.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.BaseDistributionItem.distribute class="doc doc-heading"> <code class="highlight language-python"><span class=n>distribute</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Execute distribution logic.</p> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>857</span>
<span class=normal>858</span>
<span class=normal>859</span>
<span class=normal>860</span>
<span class=normal>861</span>
<span class=normal>862</span>
<span class=normal>863</span>
<span class=normal>864</span>
<span class=normal>865</span>
<span class=normal>866</span>
<span class=normal>867</span>
<span class=normal>868</span>
<span class=normal>869</span>
<span class=normal>870</span>
<span class=normal>871</span>
<span class=normal>872</span>
<span class=normal>873</span>
<span class=normal>874</span>
<span class=normal>875</span>
<span class=normal>876</span>
<span class=normal>877</span>
<span class=normal>878</span>
<span class=normal>879</span>
<span class=normal>880</span>
<span class=normal>881</span>
<span class=normal>882</span>
<span class=normal>883</span>
<span class=normal>884</span>
<span class=normal>885</span>
<span class=normal>886</span>
<span class=normal>887</span>
<span class=normal>888</span>
<span class=normal>889</span>
<span class=normal>890</span>
<span class=normal>891</span>
<span class=normal>892</span>
<span class=normal>893</span>
<span class=normal>894</span>
<span class=normal>895</span>
<span class=normal>896</span>
<span class=normal>897</span>
<span class=normal>898</span>
<span class=normal>899</span>
<span class=normal>900</span>
<span class=normal>901</span>
<span class=normal>902</span>
<span class=normal>903</span>
<span class=normal>904</span>
<span class=normal>905</span>
<span class=normal>906</span>
<span class=normal>907</span>
<span class=normal>908</span>
<span class=normal>909</span>
<span class=normal>910</span>
<span class=normal>911</span>
<span class=normal>912</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>distribute</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Execute distribution logic.&quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_distributed</span><span class=p>()</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dist_started</span><span class=p>:</span>
        <span class=k>yield</span> <span class=kc>True</span>
        <span class=k>return</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_dist_started</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_distribute</span><span class=p>():</span>
                <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
                    <span class=k>break</span>
                <span class=k>yield</span> <span class=kc>False</span>

        <span class=k>except</span> <span class=n>DistributionProgressInterupted</span><span class=p>:</span>
            <span class=n>wait_result</span> <span class=o>=</span> <span class=kc>False</span>
            <span class=k>for</span> <span class=n>wait_result</span> <span class=ow>in</span> <span class=n>_wait_for_other_process</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_progress_dir</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_progress_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>log</span>
            <span class=p>):</span>
                <span class=k>if</span> <span class=n>wait_result</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                    <span class=k>break</span>
                <span class=k>yield</span> <span class=kc>False</span>

            <span class=k>if</span> <span class=n>wait_result</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATE_FAILED</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_error_msg</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;Other process took over distribution and failed.&quot;</span>
                <span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_error_detail</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;Please try to start AYON again and contact&quot;</span>
                    <span class=s2>&quot; administrator if issue persist.&quot;</span>
                <span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_error_msg</span><span class=si>}</span><span class=s2>&quot;</span>
                <span class=p>)</span>

    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATE_FAILED</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_error_msg</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>exc</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_error_detail</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>traceback</span><span class=o>.</span><span class=n>format_exception</span><span class=p>(</span><span class=o>*</span><span class=n>sys</span><span class=o>.</span><span class=n>exc_info</span><span class=p>())</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: Distibution failed&quot;</span><span class=p>,</span>
            <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>)</span>

    <span class=k>finally</span><span class=p>:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>==</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>OUTDATED</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATE_FAILED</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_error_msg</span> <span class=o>=</span> <span class=s2>&quot;Distribution failed&quot;</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_post_distribute</span><span class=p>()</span>
        <span class=k>yield</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=common.ayon_common.distribution.control.DistributeTransferProgress class="doc doc-heading"> <code>DistributeTransferProgress</code> </h2> <div class="doc doc-contents "> <p>Progress of single source item in 'DistributionItem'.</p> <p>The item is to keep track of single source item.</p> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>DistributeTransferProgress</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Progress of single source item in &#39;DistributionItem&#39;.</span>

<span class=sd>    The item is to keep track of single source item.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_transfer_progress</span> <span class=o>=</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>TransferProgress</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_started</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_failed</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_fail_reason</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_unzip_started</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_unzip_finished</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_hash_check_started</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_hash_check_finished</span> <span class=o>=</span> <span class=kc>False</span>

    <span class=k>def</span><span class=w> </span><span class=nf>set_started</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Call when source distribution starts.&quot;&quot;&quot;</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_started</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>def</span><span class=w> </span><span class=nf>set_failed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>reason</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Set source distribution as failed.</span>

<span class=sd>        Args:</span>
<span class=sd>            reason (str): Error message why the transfer failed.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_failed</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_fail_reason</span> <span class=o>=</span> <span class=n>reason</span>

    <span class=k>def</span><span class=w> </span><span class=nf>set_hash_check_started</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Call just before hash check starts.&quot;&quot;&quot;</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_hash_check_started</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>def</span><span class=w> </span><span class=nf>set_hash_check_finished</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Call just after hash check finishes.&quot;&quot;&quot;</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_hash_check_finished</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>def</span><span class=w> </span><span class=nf>set_unzip_started</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Call just before unzip starts.&quot;&quot;&quot;</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_unzip_started</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>def</span><span class=w> </span><span class=nf>set_unzip_finished</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Call just after unzip finishes.&quot;&quot;&quot;</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_unzip_finished</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>is_running</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Source distribution is in progress.</span>

<span class=sd>        Returns:</span>
<span class=sd>            bool: Transfer is in progress.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>return</span> <span class=nb>bool</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_started</span>
            <span class=ow>and</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_failed</span>
            <span class=ow>and</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_hash_check_finished</span>
        <span class=p>)</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>transfer_progress</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ayon_api</span><span class=o>.</span><span class=n>TransferProgress</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Source file &#39;download&#39; progress tracker.</span>

<span class=sd>        Returns:</span>
<span class=sd>            ayon_api.TransferProgress: Content download progress.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_transfer_progress</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>started</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_started</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>hash_check_started</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_hash_check_started</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>hash_check_finished</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_hash_check_finished</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>unzip_started</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_unzip_started</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>unzip_finished</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_unzip_finished</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>failed</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_failed</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>_transfer_progress</span><span class=o>.</span><span class=n>failed</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>fail_reason</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_fail_reason</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>_transfer_progress</span><span class=o>.</span><span class=n>fail_reason</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.DistributeTransferProgress.is_running class="doc doc-heading"> <code class="highlight language-python"><span class=n>is_running</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Source distribution is in progress.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>bool</code></td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Transfer is in progress.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.DistributeTransferProgress.transfer_progress class="doc doc-heading"> <code class="highlight language-python"><span class=n>transfer_progress</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Source file 'download' progress tracker.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=ayon_api.TransferProgress>TransferProgress</span></code> </td> <td> <div class=doc-md-description> <p>ayon_api.TransferProgress: Content download progress.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.DistributeTransferProgress.set_failed class="doc doc-heading"> <code class="highlight language-python"><span class=n>set_failed</span><span class=p>(</span><span class=n>reason</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Set source distribution as failed.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>reason</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Error message why the transfer failed.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>set_failed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>reason</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Set source distribution as failed.</span>

<span class=sd>    Args:</span>
<span class=sd>        reason (str): Error message why the transfer failed.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_failed</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_fail_reason</span> <span class=o>=</span> <span class=n>reason</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.DistributeTransferProgress.set_hash_check_finished class="doc doc-heading"> <code class="highlight language-python"><span class=n>set_hash_check_finished</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Call just after hash check finishes.</p> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>set_hash_check_finished</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Call just after hash check finishes.&quot;&quot;&quot;</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_hash_check_finished</span> <span class=o>=</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.DistributeTransferProgress.set_hash_check_started class="doc doc-heading"> <code class="highlight language-python"><span class=n>set_hash_check_started</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Call just before hash check starts.</p> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>set_hash_check_started</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Call just before hash check starts.&quot;&quot;&quot;</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_hash_check_started</span> <span class=o>=</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.DistributeTransferProgress.set_started class="doc doc-heading"> <code class="highlight language-python"><span class=n>set_started</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Call when source distribution starts.</p> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>set_started</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Call when source distribution starts.&quot;&quot;&quot;</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_started</span> <span class=o>=</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.DistributeTransferProgress.set_unzip_finished class="doc doc-heading"> <code class="highlight language-python"><span class=n>set_unzip_finished</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Call just after unzip finishes.</p> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>set_unzip_finished</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Call just after unzip finishes.&quot;&quot;&quot;</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_unzip_finished</span> <span class=o>=</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=common.ayon_common.distribution.control.DistributeTransferProgress.set_unzip_started class="doc doc-heading"> <code class="highlight language-python"><span class=n>set_unzip_started</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Call just before unzip starts.</p> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>set_unzip_started</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Call just before unzip starts.&quot;&quot;&quot;</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_unzip_started</span> <span class=o>=</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=common.ayon_common.distribution.control.DistributionItem class="doc doc-heading"> <code>DistributionItem</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="BaseDistributionItem (common.ayon_common.distribution.control.BaseDistributionItem)" href=#common.ayon_common.distribution.control.BaseDistributionItem>BaseDistributionItem</a></code></p> <p>Distribution item with sources and target directories.</p> <p>Distribution item for addons and dependency packages. They have defined unzip directory where the downloaded content is unzipped.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>target_dirpath</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Path to directory where zip is downloaded.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>download_dirpath</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Path to directory where file is unzipped.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>state</code> </td> <td> <code><span title=common.ayon_common.distribution.control.UpdateState>UpdateState</span></code> </td> <td> <div class=doc-md-description> <p>Initial state (UpdateState.UPDATED or UpdateState.OUTDATED).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>file_hash</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Hash of file for validation.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>factory</code> </td> <td> <code><a class="autorefs autorefs-internal" title="DownloadFactory (common.ayon_common.distribution.downloaders.DownloadFactory)" href=downloaders.html#common.ayon_common.distribution.downloaders.DownloadFactory>DownloadFactory</a></code> </td> <td> <div class=doc-md-description> <p>Downloaders factory object.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>sources</code> </td> <td> <code><span title=List>List</span>[<span title=common.ayon_common.distribution.data_structures.SourceInfo>SourceInfo</span>]</code> </td> <td> <div class=doc-md-description> <p>Possible sources to receive the distribution item.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>downloader_data</code> </td> <td> <code><span title=Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>More information for downloaders.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>item_label</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Label used in log outputs (and in UI).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>progress_dir</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Directory where progress is stored for other processes.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>logger</code> </td> <td> <code><span title=logging.Logger>Logger</span></code> </td> <td> <div class=doc-md-description> <p>Logger object.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1233</span>
<span class=normal>1234</span>
<span class=normal>1235</span>
<span class=normal>1236</span>
<span class=normal>1237</span>
<span class=normal>1238</span>
<span class=normal>1239</span>
<span class=normal>1240</span>
<span class=normal>1241</span>
<span class=normal>1242</span>
<span class=normal>1243</span>
<span class=normal>1244</span>
<span class=normal>1245</span>
<span class=normal>1246</span>
<span class=normal>1247</span>
<span class=normal>1248</span>
<span class=normal>1249</span>
<span class=normal>1250</span>
<span class=normal>1251</span>
<span class=normal>1252</span>
<span class=normal>1253</span>
<span class=normal>1254</span>
<span class=normal>1255</span>
<span class=normal>1256</span>
<span class=normal>1257</span>
<span class=normal>1258</span>
<span class=normal>1259</span>
<span class=normal>1260</span>
<span class=normal>1261</span>
<span class=normal>1262</span>
<span class=normal>1263</span>
<span class=normal>1264</span>
<span class=normal>1265</span>
<span class=normal>1266</span>
<span class=normal>1267</span>
<span class=normal>1268</span>
<span class=normal>1269</span>
<span class=normal>1270</span>
<span class=normal>1271</span>
<span class=normal>1272</span>
<span class=normal>1273</span>
<span class=normal>1274</span>
<span class=normal>1275</span>
<span class=normal>1276</span>
<span class=normal>1277</span>
<span class=normal>1278</span>
<span class=normal>1279</span>
<span class=normal>1280</span>
<span class=normal>1281</span>
<span class=normal>1282</span>
<span class=normal>1283</span>
<span class=normal>1284</span>
<span class=normal>1285</span>
<span class=normal>1286</span>
<span class=normal>1287</span>
<span class=normal>1288</span>
<span class=normal>1289</span>
<span class=normal>1290</span>
<span class=normal>1291</span>
<span class=normal>1292</span>
<span class=normal>1293</span>
<span class=normal>1294</span>
<span class=normal>1295</span>
<span class=normal>1296</span>
<span class=normal>1297</span>
<span class=normal>1298</span>
<span class=normal>1299</span>
<span class=normal>1300</span>
<span class=normal>1301</span>
<span class=normal>1302</span>
<span class=normal>1303</span>
<span class=normal>1304</span>
<span class=normal>1305</span>
<span class=normal>1306</span>
<span class=normal>1307</span>
<span class=normal>1308</span>
<span class=normal>1309</span>
<span class=normal>1310</span>
<span class=normal>1311</span>
<span class=normal>1312</span>
<span class=normal>1313</span>
<span class=normal>1314</span>
<span class=normal>1315</span>
<span class=normal>1316</span>
<span class=normal>1317</span>
<span class=normal>1318</span>
<span class=normal>1319</span>
<span class=normal>1320</span>
<span class=normal>1321</span>
<span class=normal>1322</span>
<span class=normal>1323</span>
<span class=normal>1324</span>
<span class=normal>1325</span>
<span class=normal>1326</span>
<span class=normal>1327</span>
<span class=normal>1328</span>
<span class=normal>1329</span>
<span class=normal>1330</span>
<span class=normal>1331</span>
<span class=normal>1332</span>
<span class=normal>1333</span>
<span class=normal>1334</span>
<span class=normal>1335</span>
<span class=normal>1336</span>
<span class=normal>1337</span>
<span class=normal>1338</span>
<span class=normal>1339</span>
<span class=normal>1340</span>
<span class=normal>1341</span>
<span class=normal>1342</span>
<span class=normal>1343</span>
<span class=normal>1344</span>
<span class=normal>1345</span>
<span class=normal>1346</span>
<span class=normal>1347</span>
<span class=normal>1348</span>
<span class=normal>1349</span>
<span class=normal>1350</span>
<span class=normal>1351</span>
<span class=normal>1352</span>
<span class=normal>1353</span>
<span class=normal>1354</span>
<span class=normal>1355</span>
<span class=normal>1356</span>
<span class=normal>1357</span>
<span class=normal>1358</span>
<span class=normal>1359</span>
<span class=normal>1360</span>
<span class=normal>1361</span>
<span class=normal>1362</span>
<span class=normal>1363</span>
<span class=normal>1364</span>
<span class=normal>1365</span>
<span class=normal>1366</span>
<span class=normal>1367</span>
<span class=normal>1368</span>
<span class=normal>1369</span>
<span class=normal>1370</span>
<span class=normal>1371</span>
<span class=normal>1372</span>
<span class=normal>1373</span>
<span class=normal>1374</span>
<span class=normal>1375</span>
<span class=normal>1376</span>
<span class=normal>1377</span>
<span class=normal>1378</span>
<span class=normal>1379</span>
<span class=normal>1380</span>
<span class=normal>1381</span>
<span class=normal>1382</span>
<span class=normal>1383</span>
<span class=normal>1384</span>
<span class=normal>1385</span>
<span class=normal>1386</span>
<span class=normal>1387</span>
<span class=normal>1388</span>
<span class=normal>1389</span>
<span class=normal>1390</span>
<span class=normal>1391</span>
<span class=normal>1392</span>
<span class=normal>1393</span>
<span class=normal>1394</span>
<span class=normal>1395</span>
<span class=normal>1396</span>
<span class=normal>1397</span>
<span class=normal>1398</span>
<span class=normal>1399</span>
<span class=normal>1400</span>
<span class=normal>1401</span>
<span class=normal>1402</span>
<span class=normal>1403</span>
<span class=normal>1404</span>
<span class=normal>1405</span>
<span class=normal>1406</span>
<span class=normal>1407</span>
<span class=normal>1408</span>
<span class=normal>1409</span>
<span class=normal>1410</span>
<span class=normal>1411</span>
<span class=normal>1412</span>
<span class=normal>1413</span>
<span class=normal>1414</span>
<span class=normal>1415</span>
<span class=normal>1416</span>
<span class=normal>1417</span>
<span class=normal>1418</span>
<span class=normal>1419</span>
<span class=normal>1420</span>
<span class=normal>1421</span>
<span class=normal>1422</span>
<span class=normal>1423</span>
<span class=normal>1424</span>
<span class=normal>1425</span>
<span class=normal>1426</span>
<span class=normal>1427</span>
<span class=normal>1428</span>
<span class=normal>1429</span>
<span class=normal>1430</span>
<span class=normal>1431</span>
<span class=normal>1432</span>
<span class=normal>1433</span>
<span class=normal>1434</span>
<span class=normal>1435</span>
<span class=normal>1436</span>
<span class=normal>1437</span>
<span class=normal>1438</span>
<span class=normal>1439</span>
<span class=normal>1440</span>
<span class=normal>1441</span>
<span class=normal>1442</span>
<span class=normal>1443</span>
<span class=normal>1444</span>
<span class=normal>1445</span>
<span class=normal>1446</span>
<span class=normal>1447</span>
<span class=normal>1448</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>DistributionItem</span><span class=p>(</span><span class=n>BaseDistributionItem</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Distribution item with sources and target directories.</span>

<span class=sd>    Distribution item for addons and dependency packages. They have defined</span>
<span class=sd>    unzip directory where the downloaded content is unzipped.</span>

<span class=sd>    Args:</span>
<span class=sd>        target_dirpath (str): Path to directory where zip is downloaded.</span>
<span class=sd>        download_dirpath (str): Path to directory where file is unzipped.</span>
<span class=sd>        state (UpdateState): Initial state (UpdateState.UPDATED or</span>
<span class=sd>            UpdateState.OUTDATED).</span>
<span class=sd>        file_hash (str): Hash of file for validation.</span>
<span class=sd>        factory (DownloadFactory): Downloaders factory object.</span>
<span class=sd>        sources (List[SourceInfo]): Possible sources to receive the</span>
<span class=sd>            distribution item.</span>
<span class=sd>        downloader_data (Dict[str, Any]): More information for downloaders.</span>
<span class=sd>        item_label (str): Label used in log outputs (and in UI).</span>
<span class=sd>        progress_dir (Optional[str]): Directory where progress is stored for</span>
<span class=sd>            other processes.</span>
<span class=sd>        logger (logging.Logger): Logger object.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>target_dirpath</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>unzip_temp_dir</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span>
    <span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span> <span class=o>=</span> <span class=n>target_dirpath</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>unzip_temp_dir</span> <span class=o>=</span> <span class=n>unzip_temp_dir</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>is_missing_permissions</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=k>return</span> <span class=ow>not</span> <span class=n>_has_write_permissions</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_post_source_process</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>filepath</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>source_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
        <span class=n>source_progress</span><span class=p>:</span> <span class=n>DistributeTransferProgress</span><span class=p>,</span>
        <span class=n>downloader</span><span class=p>:</span> <span class=n>SourceDownloader</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>],</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
        <span class=n>source_progress</span><span class=o>.</span><span class=n>set_unzip_started</span><span class=p>()</span>
        <span class=n>result</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>_wait_for_other_process</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_progress_dir</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_progress_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>log</span>
        <span class=p>):</span>
            <span class=k>if</span> <span class=n>result</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>break</span>
            <span class=k>yield</span> <span class=kc>None</span>

        <span class=k>if</span> <span class=n>result</span> <span class=ow>is</span> <span class=kc>True</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
            <span class=k>yield</span> <span class=kc>True</span>
            <span class=k>return</span>

        <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span><span class=p>)</span>
        <span class=n>unzip_dirpath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>unzip_temp_dir</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
        <span class=c1># NOTE This is a workaround for dependency packages</span>
        <span class=c1># TODO remove when dependency packages are not stored to directory</span>
        <span class=c1>#   ending with .zip</span>
        <span class=k>if</span> <span class=n>filepath</span> <span class=o>==</span> <span class=n>unzip_dirpath</span><span class=p>:</span>
            <span class=n>filedir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>filepath</span><span class=p>)</span>
            <span class=n>ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>filepath</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
            <span class=n>new_filepath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>filedir</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span><span class=si>}{</span><span class=n>ext</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
            <span class=n>os</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=n>new_filepath</span><span class=p>)</span>
            <span class=n>filepath</span> <span class=o>=</span> <span class=n>new_filepath</span>

        <span class=c1># Create directory</span>
        <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>unzip_dirpath</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=n>change_permissions_recursive</span><span class=p>(</span><span class=n>unzip_dirpath</span><span class=p>)</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=n>downloader</span><span class=o>.</span><span class=n>unzip</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=n>unzip_dirpath</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
            <span class=n>message</span> <span class=o>=</span> <span class=s2>&quot;Couldn&#39;t unzip source file&quot;</span>
            <span class=n>source_progress</span><span class=o>.</span><span class=n>set_failed</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
            <span class=p>)</span>
            <span class=k>yield</span> <span class=kc>False</span>
            <span class=k>return</span>

        <span class=n>source_progress</span><span class=o>.</span><span class=n>set_unzip_finished</span><span class=p>()</span>

        <span class=k>yield</span> <span class=kc>None</span>

        <span class=n>result</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>_wait_for_other_process</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_progress_dir</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_progress_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>log</span>
        <span class=p>):</span>
            <span class=k>if</span> <span class=n>result</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>break</span>
            <span class=k>yield</span> <span class=kc>None</span>

        <span class=k>if</span> <span class=n>result</span> <span class=ow>is</span> <span class=kc>True</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
            <span class=k>yield</span> <span class=kc>True</span>
            <span class=k>return</span>

        <span class=n>failed</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=n>renamed_mapping</span> <span class=o>=</span> <span class=p>[]</span>

        <span class=c1># Target directory can contain only distribution metadata file</span>
        <span class=c1>#   anything else is temporarily moved to different directory</span>
        <span class=c1>#   - next to target directory</span>
        <span class=c1># NOTE: We might validate if the content is exactly same?</span>
        <span class=n>tmp_subfolder</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span><span class=p>),</span> <span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span><span class=p>):</span>
            <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
            <span class=n>change_permissions_recursive</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span><span class=p>)</span>

        <span class=k>for</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>name</span> <span class=o>==</span> <span class=n>DIST_PROGRESS_FILENAME</span><span class=p>:</span>
                <span class=k>continue</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>tmp_subfolder</span><span class=p>):</span>
                <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>tmp_subfolder</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
                <span class=n>change_permissions_recursive</span><span class=p>(</span><span class=n>tmp_subfolder</span><span class=p>)</span>

            <span class=n>current_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
            <span class=n>new_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>tmp_subfolder</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=n>os</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>current_path</span><span class=p>,</span> <span class=n>new_path</span><span class=p>)</span>
            <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
                <span class=n>message</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;Target files already exist and can&#39;t be renamed.&quot;</span>
                <span class=p>)</span>
                <span class=n>source_progress</span><span class=o>.</span><span class=n>set_failed</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                    <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
                <span class=p>)</span>
                <span class=n>failed</span> <span class=o>=</span> <span class=kc>True</span>
                <span class=k>break</span>
            <span class=n>renamed_mapping</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>current_path</span><span class=p>,</span> <span class=n>new_path</span><span class=p>))</span>

        <span class=k>if</span> <span class=n>failed</span><span class=p>:</span>
            <span class=c1># Rollback renamed files</span>
            <span class=k>for</span> <span class=n>src_path</span><span class=p>,</span> <span class=n>renamed_path</span> <span class=ow>in</span> <span class=n>renamed_mapping</span><span class=p>:</span>
                <span class=n>os</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>renamed_path</span><span class=p>,</span> <span class=n>src_path</span><span class=p>)</span>
            <span class=k>yield</span> <span class=kc>False</span>
            <span class=k>return</span>

        <span class=k>yield</span> <span class=kc>None</span>

        <span class=c1># Move unzipped content to target directory</span>
        <span class=n>moved_paths</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>rename_attemps</span> <span class=o>=</span> <span class=mi>5</span>
        <span class=k>for</span> <span class=n>subname</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=n>unzip_dirpath</span><span class=p>):</span>
            <span class=n>target_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span><span class=p>,</span> <span class=n>subname</span><span class=p>)</span>
            <span class=n>src_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>unzip_dirpath</span><span class=p>,</span> <span class=n>subname</span><span class=p>)</span>
            <span class=n>dst_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span><span class=p>,</span> <span class=n>subname</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Copying </span><span class=si>%s</span><span class=s2> to </span><span class=si>%s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>src_path</span><span class=p>,</span> <span class=n>dst_path</span><span class=p>)</span>
            <span class=c1># Sometimes &#39;os.rename&#39; crashes because of permissions issue</span>
            <span class=c1>#   even though it can be done in a future attempt (probably some</span>
            <span class=c1>#   service traversing through files blocking it?)</span>
            <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>rename_attemps</span><span class=p>):</span>
                <span class=k>try</span><span class=p>:</span>
                    <span class=n>os</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>src_path</span><span class=p>,</span> <span class=n>dst_path</span><span class=p>)</span>
                    <span class=k>break</span>
                <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
                    <span class=k>if</span> <span class=n>attempt</span> <span class=o>&lt;</span> <span class=p>(</span><span class=n>rename_attemps</span> <span class=o>-</span> <span class=mi>1</span><span class=p>):</span>
                        <span class=k>yield</span> <span class=kc>None</span>
                        <span class=k>continue</span>
                    <span class=n>message</span> <span class=o>=</span> <span class=p>(</span>
                        <span class=s2>&quot;Failed to move unzipped content to target directory.&quot;</span>
                    <span class=p>)</span>
                    <span class=n>source_progress</span><span class=o>.</span><span class=n>set_failed</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                        <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
                    <span class=p>)</span>
                    <span class=n>failed</span> <span class=o>=</span> <span class=kc>True</span>

            <span class=k>if</span> <span class=n>failed</span><span class=p>:</span>
                <span class=k>break</span>

            <span class=n>moved_paths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>target_path</span><span class=p>)</span>

        <span class=c1># Handle failed movement</span>
        <span class=k>if</span> <span class=n>failed</span><span class=p>:</span>
            <span class=c1># Remove moved files</span>
            <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>moved_paths</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
                    <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>

            <span class=c1># Rename renamed files back to original</span>
            <span class=k>for</span> <span class=n>src_path</span><span class=p>,</span> <span class=n>renamed_path</span> <span class=ow>in</span> <span class=n>renamed_mapping</span><span class=p>:</span>
                <span class=n>os</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>renamed_path</span><span class=p>,</span> <span class=n>src_path</span><span class=p>)</span>

        <span class=c1># Remove temp subfolder used for renaming</span>
        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>tmp_subfolder</span><span class=p>):</span>
            <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=n>tmp_subfolder</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>failed</span><span class=p>:</span>
            <span class=k>yield</span> <span class=kc>False</span>
            <span class=k>return</span>

        <span class=k>yield from</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>_post_source_process</span><span class=p>(</span>
            <span class=n>filepath</span><span class=p>,</span> <span class=n>source_data</span><span class=p>,</span> <span class=n>source_progress</span><span class=p>,</span> <span class=n>downloader</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_post_distribute</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>if</span> <span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>!=</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span>
            <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span>
            <span class=ow>and</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isdir</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span><span class=p>)</span>
        <span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Cleaning </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
            <span class=c1># TODO use &#39;_clean_dist_dir&#39; when backwards compatibility with</span>
            <span class=c1>#   previous versions of AYON launchers is not needed.</span>
            <span class=c1># _clean_dist_dir(self.target_dirpath)</span>
            <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>target_dirpath</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=common.ayon_common.distribution.control.InstallerDistributionItem class="doc doc-heading"> <code>InstallerDistributionItem</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="BaseDistributionItem (common.ayon_common.distribution.control.BaseDistributionItem)" href=#common.ayon_common.distribution.control.BaseDistributionItem>BaseDistributionItem</a></code></p> <p>Distribution of new version of AYON launcher/Installer.</p> <details class=quote> <summary>Source code in <code>common/ayon_common/distribution/control.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 926</span>
<span class=normal> 927</span>
<span class=normal> 928</span>
<span class=normal> 929</span>
<span class=normal> 930</span>
<span class=normal> 931</span>
<span class=normal> 932</span>
<span class=normal> 933</span>
<span class=normal> 934</span>
<span class=normal> 935</span>
<span class=normal> 936</span>
<span class=normal> 937</span>
<span class=normal> 938</span>
<span class=normal> 939</span>
<span class=normal> 940</span>
<span class=normal> 941</span>
<span class=normal> 942</span>
<span class=normal> 943</span>
<span class=normal> 944</span>
<span class=normal> 945</span>
<span class=normal> 946</span>
<span class=normal> 947</span>
<span class=normal> 948</span>
<span class=normal> 949</span>
<span class=normal> 950</span>
<span class=normal> 951</span>
<span class=normal> 952</span>
<span class=normal> 953</span>
<span class=normal> 954</span>
<span class=normal> 955</span>
<span class=normal> 956</span>
<span class=normal> 957</span>
<span class=normal> 958</span>
<span class=normal> 959</span>
<span class=normal> 960</span>
<span class=normal> 961</span>
<span class=normal> 962</span>
<span class=normal> 963</span>
<span class=normal> 964</span>
<span class=normal> 965</span>
<span class=normal> 966</span>
<span class=normal> 967</span>
<span class=normal> 968</span>
<span class=normal> 969</span>
<span class=normal> 970</span>
<span class=normal> 971</span>
<span class=normal> 972</span>
<span class=normal> 973</span>
<span class=normal> 974</span>
<span class=normal> 975</span>
<span class=normal> 976</span>
<span class=normal> 977</span>
<span class=normal> 978</span>
<span class=normal> 979</span>
<span class=normal> 980</span>
<span class=normal> 981</span>
<span class=normal> 982</span>
<span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span>
<span class=normal>1045</span>
<span class=normal>1046</span>
<span class=normal>1047</span>
<span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span>
<span class=normal>1054</span>
<span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span>
<span class=normal>1064</span>
<span class=normal>1065</span>
<span class=normal>1066</span>
<span class=normal>1067</span>
<span class=normal>1068</span>
<span class=normal>1069</span>
<span class=normal>1070</span>
<span class=normal>1071</span>
<span class=normal>1072</span>
<span class=normal>1073</span>
<span class=normal>1074</span>
<span class=normal>1075</span>
<span class=normal>1076</span>
<span class=normal>1077</span>
<span class=normal>1078</span>
<span class=normal>1079</span>
<span class=normal>1080</span>
<span class=normal>1081</span>
<span class=normal>1082</span>
<span class=normal>1083</span>
<span class=normal>1084</span>
<span class=normal>1085</span>
<span class=normal>1086</span>
<span class=normal>1087</span>
<span class=normal>1088</span>
<span class=normal>1089</span>
<span class=normal>1090</span>
<span class=normal>1091</span>
<span class=normal>1092</span>
<span class=normal>1093</span>
<span class=normal>1094</span>
<span class=normal>1095</span>
<span class=normal>1096</span>
<span class=normal>1097</span>
<span class=normal>1098</span>
<span class=normal>1099</span>
<span class=normal>1100</span>
<span class=normal>1101</span>
<span class=normal>1102</span>
<span class=normal>1103</span>
<span class=normal>1104</span>
<span class=normal>1105</span>
<span class=normal>1106</span>
<span class=normal>1107</span>
<span class=normal>1108</span>
<span class=normal>1109</span>
<span class=normal>1110</span>
<span class=normal>1111</span>
<span class=normal>1112</span>
<span class=normal>1113</span>
<span class=normal>1114</span>
<span class=normal>1115</span>
<span class=normal>1116</span>
<span class=normal>1117</span>
<span class=normal>1118</span>
<span class=normal>1119</span>
<span class=normal>1120</span>
<span class=normal>1121</span>
<span class=normal>1122</span>
<span class=normal>1123</span>
<span class=normal>1124</span>
<span class=normal>1125</span>
<span class=normal>1126</span>
<span class=normal>1127</span>
<span class=normal>1128</span>
<span class=normal>1129</span>
<span class=normal>1130</span>
<span class=normal>1131</span>
<span class=normal>1132</span>
<span class=normal>1133</span>
<span class=normal>1134</span>
<span class=normal>1135</span>
<span class=normal>1136</span>
<span class=normal>1137</span>
<span class=normal>1138</span>
<span class=normal>1139</span>
<span class=normal>1140</span>
<span class=normal>1141</span>
<span class=normal>1142</span>
<span class=normal>1143</span>
<span class=normal>1144</span>
<span class=normal>1145</span>
<span class=normal>1146</span>
<span class=normal>1147</span>
<span class=normal>1148</span>
<span class=normal>1149</span>
<span class=normal>1150</span>
<span class=normal>1151</span>
<span class=normal>1152</span>
<span class=normal>1153</span>
<span class=normal>1154</span>
<span class=normal>1155</span>
<span class=normal>1156</span>
<span class=normal>1157</span>
<span class=normal>1158</span>
<span class=normal>1159</span>
<span class=normal>1160</span>
<span class=normal>1161</span>
<span class=normal>1162</span>
<span class=normal>1163</span>
<span class=normal>1164</span>
<span class=normal>1165</span>
<span class=normal>1166</span>
<span class=normal>1167</span>
<span class=normal>1168</span>
<span class=normal>1169</span>
<span class=normal>1170</span>
<span class=normal>1171</span>
<span class=normal>1172</span>
<span class=normal>1173</span>
<span class=normal>1174</span>
<span class=normal>1175</span>
<span class=normal>1176</span>
<span class=normal>1177</span>
<span class=normal>1178</span>
<span class=normal>1179</span>
<span class=normal>1180</span>
<span class=normal>1181</span>
<span class=normal>1182</span>
<span class=normal>1183</span>
<span class=normal>1184</span>
<span class=normal>1185</span>
<span class=normal>1186</span>
<span class=normal>1187</span>
<span class=normal>1188</span>
<span class=normal>1189</span>
<span class=normal>1190</span>
<span class=normal>1191</span>
<span class=normal>1192</span>
<span class=normal>1193</span>
<span class=normal>1194</span>
<span class=normal>1195</span>
<span class=normal>1196</span>
<span class=normal>1197</span>
<span class=normal>1198</span>
<span class=normal>1199</span>
<span class=normal>1200</span>
<span class=normal>1201</span>
<span class=normal>1202</span>
<span class=normal>1203</span>
<span class=normal>1204</span>
<span class=normal>1205</span>
<span class=normal>1206</span>
<span class=normal>1207</span>
<span class=normal>1208</span>
<span class=normal>1209</span>
<span class=normal>1210</span>
<span class=normal>1211</span>
<span class=normal>1212</span>
<span class=normal>1213</span>
<span class=normal>1214</span>
<span class=normal>1215</span>
<span class=normal>1216</span>
<span class=normal>1217</span>
<span class=normal>1218</span>
<span class=normal>1219</span>
<span class=normal>1220</span>
<span class=normal>1221</span>
<span class=normal>1222</span>
<span class=normal>1223</span>
<span class=normal>1224</span>
<span class=normal>1225</span>
<span class=normal>1226</span>
<span class=normal>1227</span>
<span class=normal>1228</span>
<span class=normal>1229</span>
<span class=normal>1230</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>InstallerDistributionItem</span><span class=p>(</span><span class=n>BaseDistributionItem</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Distribution of new version of AYON launcher/Installer.&quot;&quot;&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cleanup_on_fail</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_cleanup_on_fail</span> <span class=o>=</span> <span class=n>cleanup_on_fail</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_executable</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_path</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_error</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>executable</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Path to distributed ayon executable.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[str]: Path to executable path which was distributed.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_executable</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>installer_path</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Path to a distribution package/installer.</span>

<span class=sd>        This can be used as reference for user where to find downloaded</span>
<span class=sd>            installer on disk and distribute it manually.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[str]: Path to installer.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installer_path</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>installer_error</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Known installer error that happened during distribution.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[str]: Message that will be shown to user and logged</span>
<span class=sd>                out.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_installer_error</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>is_missing_permissions</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=k>return</span> <span class=ow>not</span> <span class=n>_has_write_permissions</span><span class=p>(</span>
            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>executable</span><span class=p>))</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_find_windows_executable</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>log_output</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Find executable path in log output.</span>

<span class=sd>        Setup exe should print out log output to a file where are described</span>
<span class=sd>        steps that happened during installation.</span>

<span class=sd>        Todos:</span>
<span class=sd>            Find a better way how to find out where AYON launcher was</span>
<span class=sd>                installed.</span>

<span class=sd>        Args:</span>
<span class=sd>            log_output (str): Output from installer log.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>exe_name</span> <span class=o>=</span> <span class=s2>&quot;ayon.exe&quot;</span>
        <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>log_output</span><span class=o>.</span><span class=n>splitlines</span><span class=p>():</span>
            <span class=n>idx</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=n>exe_name</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>idx</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=n>line</span> <span class=o>=</span> <span class=n>line</span><span class=p>[:</span><span class=n>idx</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=n>exe_name</span><span class=p>)]</span>
            <span class=n>parts</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\\</span><span class=s2>&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
                <span class=n>parts</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\\</span><span class=s2>&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\\</span><span class=s2>&quot;</span><span class=p>)</span>

            <span class=n>last_part</span> <span class=o>=</span> <span class=n>parts</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
            <span class=n>found_valid</span> <span class=o>=</span> <span class=kc>False</span>
            <span class=n>final_parts</span> <span class=o>=</span> <span class=p>[]</span>
            <span class=k>for</span> <span class=n>part</span> <span class=ow>in</span> <span class=n>parts</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>found_valid</span><span class=p>:</span>
                    <span class=n>final_parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>part</span><span class=p>)</span>
                    <span class=k>continue</span>
                <span class=n>part</span> <span class=o>=</span> <span class=n>part</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=se>\\</span><span class=s2>&quot;</span>
                <span class=k>while</span> <span class=n>part</span><span class=p>:</span>
                    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>part</span><span class=p>):</span>
                        <span class=k>break</span>
                    <span class=n>part</span> <span class=o>=</span> <span class=n>part</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>

                <span class=k>if</span> <span class=n>part</span><span class=p>:</span>
                    <span class=n>found_valid</span> <span class=o>=</span> <span class=kc>True</span>
                    <span class=n>final_parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>part</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
            <span class=n>final_parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>last_part</span><span class=p>)</span>
            <span class=n>executable_path</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\\</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>final_parts</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>executable_path</span><span class=p>):</span>
                <span class=k>return</span> <span class=n>executable_path</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_install_windows</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>filepath</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Install windows AYON launcher.</span>

<span class=sd>        Args:</span>
<span class=sd>            filepath (str): Path to setup.exe file.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>install_root</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>executable</span><span class=p>))</span>

        <span class=c1># A file where installer may store log output</span>
        <span class=n>log_file</span> <span class=o>=</span> <span class=n>create_tmp_file</span><span class=p>(</span><span class=n>suffix</span><span class=o>=</span><span class=s2>&quot;ayon_install&quot;</span><span class=p>)</span>
        <span class=c1># A file where installer may store output directory</span>
        <span class=n>install_exe_tmp</span> <span class=o>=</span> <span class=n>create_tmp_file</span><span class=p>(</span><span class=n>suffix</span><span class=o>=</span><span class=s2>&quot;ayon_install_dir&quot;</span><span class=p>)</span>
        <span class=n>user_arg</span> <span class=o>=</span> <span class=s2>&quot;/CURRENTUSER&quot;</span>
        <span class=c1># Ask for admin permissions if user is not admin and</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>_has_write_permissions</span><span class=p>(</span><span class=n>install_root</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>HEADLESS_MODE_ENABLED</span><span class=p>:</span>
                <span class=k>raise</span> <span class=n>InstallerDistributionError</span><span class=p>((</span>
                    <span class=s2>&quot;Installation requires administration permissions, which&quot;</span>
                    <span class=s2>&quot; cannot be granted in headless mode.&quot;</span>
                <span class=p>))</span>
            <span class=n>user_arg</span> <span class=o>=</span> <span class=s2>&quot;/ALLUSERS&quot;</span>
        <span class=n>args</span> <span class=o>=</span> <span class=p>[</span>
            <span class=n>filepath</span><span class=p>,</span>
            <span class=n>user_arg</span><span class=p>,</span>
            <span class=s2>&quot;/NOCANCEL&quot;</span><span class=p>,</span>
            <span class=sa>f</span><span class=s2>&quot;/LOG=</span><span class=si>{</span><span class=n>log_file</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
            <span class=sa>f</span><span class=s2>&quot;/INSTALLROOT=</span><span class=si>{</span><span class=n>install_root</span><span class=si>}</span><span class=s2>&quot;</span>
        <span class=p>]</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>HEADLESS_MODE_ENABLED</span><span class=p>:</span>
            <span class=n>args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;/SILENT&quot;</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;/VERYSILENT&quot;</span><span class=p>)</span>

        <span class=n>env</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>items</span><span class=p>())</span>
        <span class=n>env</span><span class=p>[</span><span class=s2>&quot;AYON_INSTALL_EXE_OUTPUT&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>install_exe_tmp</span>

        <span class=n>code</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>call</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=n>env</span><span class=p>)</span>
        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>log_file</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>stream</span><span class=p>:</span>
            <span class=n>log_output</span> <span class=o>=</span> <span class=n>stream</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>install_exe_tmp</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>stream</span><span class=p>:</span>
            <span class=n>install_exe_path</span> <span class=o>=</span> <span class=n>stream</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
        <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>log_file</span><span class=p>)</span>
        <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>install_exe_tmp</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>code</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=n>log_output</span><span class=p>)</span>
            <span class=k>raise</span> <span class=n>InstallerDistributionError</span><span class=p>(</span>
                <span class=s2>&quot;Install process failed without known reason.&quot;</span>
                <span class=s2>&quot; Try to install AYON manually.&quot;</span>
            <span class=p>)</span>

        <span class=n>executable</span> <span class=o>=</span> <span class=n>install_exe_path</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=ow>or</span> <span class=kc>None</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>executable</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>executable</span><span class=p>):</span>
            <span class=n>executable</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_find_windows_executable</span><span class=p>(</span><span class=n>log_output</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_executable</span> <span class=o>=</span> <span class=n>executable</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_install_linux</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>filepath</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Install linux AYON launcher.</span>

<span class=sd>        Linux installations are just an archive file, so we attempt to unzip</span>
<span class=sd>            the new installation one level up of the one being run.</span>

<span class=sd>        Args:</span>
<span class=sd>            filepath (str): Path to a .tar.gz file.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>install_root</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>executable</span><span class=p>))</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;Installing AYON launcher </span><span class=si>{</span><span class=n>filepath</span><span class=si>}</span><span class=s2> into:</span><span class=se>\n</span><span class=si>{</span><span class=n>install_root</span><span class=si>}</span><span class=s2>&quot;</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>install_root</span><span class=p>):</span>
            <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>install_root</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=n>extract_archive_file</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=n>install_root</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
            <span class=k>raise</span> <span class=n>InstallerDistributionError</span><span class=p>(</span>
                <span class=s2>&quot;Install process failed without known reason.&quot;</span>
                <span class=s2>&quot; Try to install AYON manually.&quot;</span>
            <span class=p>)</span>

        <span class=n>installer_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>filepath</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;.tar.gz&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
        <span class=n>executable</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>install_root</span><span class=p>,</span> <span class=n>installer_dir</span><span class=p>,</span> <span class=s2>&quot;ayon&quot;</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Setting executable to </span><span class=si>{</span><span class=n>executable</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_executable</span> <span class=o>=</span> <span class=n>executable</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_install_macos</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>filepath</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Install macOS AYON launcher.</span>

<span class=sd>        Args:</span>
<span class=sd>            filepath (str): Path to a .dmg file.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=kn>import</span><span class=w> </span><span class=nn>plistlib</span>

        <span class=c1># Attach dmg file and read plist output (bytes)</span>
        <span class=n>stdout</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>check_output</span><span class=p>([</span>
            <span class=s2>&quot;hdiutil&quot;</span><span class=p>,</span> <span class=s2>&quot;attach&quot;</span><span class=p>,</span> <span class=n>filepath</span><span class=p>,</span> <span class=s2>&quot;-plist&quot;</span><span class=p>,</span> <span class=s2>&quot;-nobrowse&quot;</span>
        <span class=p>])</span>
        <span class=n>mounted_volumes</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=c1># Parse plist output and find mounted volume</span>
            <span class=n>attach_info</span> <span class=o>=</span> <span class=n>plistlib</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>stdout</span><span class=p>)</span>
            <span class=k>for</span> <span class=n>entity</span> <span class=ow>in</span> <span class=n>attach_info</span><span class=p>[</span><span class=s2>&quot;system-entities&quot;</span><span class=p>]:</span>
                <span class=n>mounted_volume</span> <span class=o>=</span> <span class=n>entity</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;mount-point&quot;</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>mounted_volume</span><span class=p>:</span>
                    <span class=n>mounted_volumes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>mounted_volume</span><span class=p>)</span>

            <span class=c1># We do expect there is only one .app in .dmg file</span>
            <span class=n>src_path</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=n>src_filename</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=k>for</span> <span class=n>mounted_volume</span> <span class=ow>in</span> <span class=n>mounted_volumes</span><span class=p>:</span>
                <span class=k>for</span> <span class=n>filename</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=n>mounted_volume</span><span class=p>):</span>
                    <span class=k>if</span> <span class=n>filename</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;.app&quot;</span><span class=p>):</span>
                        <span class=n>src_filename</span> <span class=o>=</span> <span class=n>filename</span>
                        <span class=n>src_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>mounted_volume</span><span class=p>,</span> <span class=n>src_filename</span><span class=p>)</span>
                        <span class=k>break</span>

            <span class=k>if</span> <span class=n>src_path</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=c1># Copy the .app file to /Applications</span>
                <span class=n>dst_dir</span> <span class=o>=</span> <span class=s2>&quot;/Applications&quot;</span>
                <span class=n>dst_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>dst_dir</span><span class=p>,</span> <span class=n>src_filename</span><span class=p>)</span>
                <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>([</span><span class=s2>&quot;cp&quot;</span><span class=p>,</span> <span class=s2>&quot;-rf&quot;</span><span class=p>,</span> <span class=n>src_path</span><span class=p>,</span> <span class=n>dst_dir</span><span class=p>])</span>

        <span class=k>finally</span><span class=p>:</span>
            <span class=c1># Detach mounted volume</span>
            <span class=k>for</span> <span class=n>mounted_volume</span> <span class=ow>in</span> <span class=n>mounted_volumes</span><span class=p>:</span>
                <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>([</span><span class=s2>&quot;hdiutil&quot;</span><span class=p>,</span> <span class=s2>&quot;detach&quot;</span><span class=p>,</span> <span class=n>mounted_volume</span><span class=p>])</span>

        <span class=c1># Find executable inside .app file and return its path</span>
        <span class=n>contents_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>dst_path</span><span class=p>,</span> <span class=s2>&quot;Contents&quot;</span><span class=p>)</span>
        <span class=c1># Load plist file and check for bundle executable</span>
        <span class=n>plist_filepath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>contents_dir</span><span class=p>,</span> <span class=s2>&quot;Info.plist&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>plistlib</span><span class=p>,</span> <span class=s2>&quot;load&quot;</span><span class=p>):</span>
            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>plist_filepath</span><span class=p>,</span> <span class=s2>&quot;rb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>stream</span><span class=p>:</span>
                <span class=n>parsed_plist</span> <span class=o>=</span> <span class=n>plistlib</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>stream</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>parsed_plist</span> <span class=o>=</span> <span class=n>plistlib</span><span class=o>.</span><span class=n>readPlist</span><span class=p>(</span><span class=n>plist_filepath</span><span class=p>)</span>
        <span class=n>executable_filename</span> <span class=o>=</span> <span class=n>parsed_plist</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;CFBundleExecutable&quot;</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_executable</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
            <span class=n>contents_dir</span><span class=p>,</span> <span class=s2>&quot;MacOS&quot;</span><span class=p>,</span> <span class=n>executable_filename</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_install_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>filepath</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Trigger installation installer file based on platform.&quot;&quot;&quot;</span>

        <span class=c1># TODO consider using platform name in target folder</span>
        <span class=c1>#  - for windows and linux</span>
        <span class=n>platform_name</span> <span class=o>=</span> <span class=n>platform</span><span class=o>.</span><span class=n>system</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>platform_name</span> <span class=o>==</span> <span class=s2>&quot;windows&quot;</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_install_windows</span><span class=p>(</span><span class=n>filepath</span><span class=p>)</span>
        <span class=k>elif</span> <span class=n>platform_name</span> <span class=o>==</span> <span class=s2>&quot;linux&quot;</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_install_linux</span><span class=p>(</span><span class=n>filepath</span><span class=p>)</span>
        <span class=k>elif</span> <span class=n>platform_name</span> <span class=o>==</span> <span class=s2>&quot;darwin&quot;</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_install_macos</span><span class=p>(</span><span class=n>filepath</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>InstallerDistributionError</span><span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot;Unsupported platform: </span><span class=si>{</span><span class=n>platform_name</span><span class=si>}</span><span class=s2>&quot;</span>
            <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_post_source_process</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>filepath</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>source_data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
        <span class=n>source_progress</span><span class=p>:</span> <span class=n>DistributeTransferProgress</span><span class=p>,</span>
        <span class=n>downloader</span><span class=p>:</span> <span class=n>SourceDownloader</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>],</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_installer_path</span> <span class=o>=</span> <span class=n>filepath</span>
        <span class=n>success</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>filepath</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_install_file</span><span class=p>(</span><span class=n>filepath</span><span class=p>)</span>
                <span class=n>success</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>message</span> <span class=o>=</span> <span class=s2>&quot;File was not downloaded&quot;</span>
                <span class=n>source_progress</span><span class=o>.</span><span class=n>set_failed</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>

        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
            <span class=n>message</span> <span class=o>=</span> <span class=s2>&quot;Installation failed&quot;</span>
            <span class=n>source_progress</span><span class=o>.</span><span class=n>set_failed</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>exc</span><span class=p>,</span> <span class=n>InstallerDistributionError</span><span class=p>):</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_installer_error</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>exc</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>item_label</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
                    <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span>
                <span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_installer_error</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=s2>&quot;Distribution of AYON launcher&quot;</span>
                    <span class=s2>&quot; failed with unexpected reason.&quot;</span>
                <span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATED</span> <span class=k>if</span> <span class=n>success</span> <span class=k>else</span> <span class=n>UpdateState</span><span class=o>.</span><span class=n>UPDATE_FAILED</span>
        <span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_used_source</span> <span class=o>=</span> <span class=n>source_data</span>
        <span class=k>if</span> <span class=n>success</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cleanup_on_fail</span><span class=p>:</span>
            <span class=n>downloader</span><span class=o>.</span><span class=n>cleanup</span><span class=p>(</span>
                <span class=n>source_data</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>download_dirpath</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>downloader_data</span>
            <span class=p>)</span>

        <span class=k>yield</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.InstallerDistributionItem.executable class="doc doc-heading"> <code class="highlight language-python"><span class=n>executable</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Path to distributed ayon executable.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Optional[str]: Path to executable path which was distributed.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.InstallerDistributionItem.installer_error class="doc doc-heading"> <code class="highlight language-python"><span class=n>installer_error</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Known installer error that happened during distribution.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Optional[str]: Message that will be shown to user and logged out.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=common.ayon_common.distribution.control.InstallerDistributionItem.installer_path class="doc doc-heading"> <code class="highlight language-python"><span class=n>installer_path</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Path to a distribution package/installer.</p> <p>This can be used as reference for user where to find downloaded installer on disk and distribute it manually.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Optional[str]: Path to installer.</p> </div> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div> </div> </div> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["navigation.sections", "navigation.path", "navigation.prune"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>